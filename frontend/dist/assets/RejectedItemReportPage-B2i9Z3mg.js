import{j as e,r as u,F as Fe}from"./index-C4O2RVGC.js";import{i as B}from"./inventoryService-Cfeh1TyB.js";import{l as ne}from"./libraryService-BC59J_DM.js";import{s as de}from"./skuService-CD47JNeC.js";import{o as Ye}from"./inventoryEvents-fOALNsvn.js";import{a as ye,f as g}from"./formatters-ptPrPoGe.js";import{C as je}from"./chevron-down-CuFOjVxo.js";import{S as _e}from"./send-CRvgA3Cm.js";import{P as ve}from"./package-CBqWQTbk.js";import{T as Je}from"./trash-2-BS2IYTwN.js";import{H as fe}from"./history-CYtwhdaJ.js";import{X as F}from"./x-ChutkFoY.js";import{A as Xe}from"./alert-circle-CHFujnlN.js";import{R as Ge}from"./refresh-cw-DwB-dIyH.js";import{D as We}from"./download-BnsO4lfA.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";const Ze=({report:s,isOpen:t,onToggle:h,onSendToVendor:x,onReceiveFromVendor:d,onScrap:o,onViewHistory:m,dropdownRef:y})=>e.jsxs("div",{className:"relative inline-block",ref:y,children:[e.jsxs("button",{onClick:h,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",title:"Actions",children:["Actions",e.jsx(je,{className:`w-4 h-4 ml-1 transition-transform ${t?"rotate-180":""}`})]}),t&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>x(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Send to Vendor"]}),e.jsxs("button",{onClick:()=>d(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Receive from Vendor"]}),e.jsxs("button",{onClick:()=>o(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Scrap"]}),e.jsxs("button",{onClick:()=>m(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"View History"]})]})})]}),De=s=>{const t=s.quantity||0,h=s.sentToVendor||0,x=s.receivedBack||0,d=s.scrapped||0,o=h+x+d;return t===0?{status:"Pending",color:"bg-yellow-100 text-yellow-800",description:"No action taken yet on rejected items"}:d===t&&h===0&&x===0?{status:"Scrapped",color:"bg-gray-100 text-gray-800",description:"All rejected items have been scrapped/written off"}:h===t&&x===0&&d===0?{status:"Sent to Vendor",color:"bg-purple-100 text-purple-800",description:"All rejected items have been sent back to vendor, awaiting return"}:x===t&&d===0?{status:"Received",color:"bg-green-100 text-green-800",description:"All rejected items received back and added to stock"}:h>0&&x===h&&d===0?{status:"Completed",color:"bg-green-100 text-green-800",description:"All sent items received back and added to stock"}:h>0&&x>0&&x<h?{status:"Partially Returned",color:"bg-orange-100 text-orange-800",description:"Some (but not all) sent items have been received back from vendor"}:o>0&&o<t?{status:"In Progress",color:"bg-blue-100 text-blue-800",description:"Some items sent to vendor OR some scrapped, but not all"}:{status:"Pending",color:"bg-yellow-100 text-yellow-800",description:"No action taken yet on rejected items"}},et=({report:s})=>{const t=De(s);return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.color}`,children:t.status})},tt=({reports:s,loading:t,openDropdownId:h,dropdownRefs:x,onToggleDropdown:d,onSendToVendor:o,onReceiveFromVendor:m,onScrap:y,onViewHistory:a})=>t?e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading rejected item reports..."})]})}):s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"p-12 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No rejected item reports found"})})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Report No."}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Inspection Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rejected Qty"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sent to Vendor"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Received Back"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scrapped"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Rejected"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(n=>{const R=n.sentToVendor||0,p=n.receivedBack||0,V=n.scrapped||0,Y=n.netRejected!==void 0?n.netRejected:n.quantity-R-p-V;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center",children:n.reportNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:ye(n.inspectionDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center",children:n.skuCode||`SKU-${n.skuId}`}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate text-center",children:n.itemName}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700 text-center max-w-xs truncate",children:n.reason||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 text-center font-bold",children:g(n.quantity)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:g(R)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:g(p)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:g(V)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 text-center font-bold",children:g(Y)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx(et,{report:n})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx(Ze,{report:n,isOpen:h===n.id,onToggle:()=>d(n.id),onSendToVendor:o,onReceiveFromVendor:m,onScrap:y,onViewHistory:a,dropdownRef:I=>{x.current[n.id]=I}})})]},n.id)})})]})})}),st=({report:s,isOpen:t,onToggle:h,onReceiveBack:x,onViewHistory:d,dropdownRef:o})=>e.jsxs("div",{className:"relative inline-block",ref:o,children:[e.jsxs("button",{onClick:h,className:"inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",title:"Actions",children:["Actions",e.jsx(je,{className:`w-4 h-4 ml-1 transition-transform ${t?"rotate-180":""}`})]}),t&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>x(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Receive Back"]}),e.jsxs("button",{onClick:()=>d(s),className:"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"View History"]})]})})]}),at=({reports:s,loading:t,openDropdownId:h,dropdownRefs:x,onToggleDropdown:d,onReceiveBack:o,onViewHistory:m})=>{if(t)return e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading short item reports..."})]})});if(s.length===0)return e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"p-12 text-center",children:e.jsx("p",{className:"text-gray-600",children:"No short item reports found"})})});const y=a=>{const n=(a==null?void 0:a.toLowerCase())||"pending",R={pending:{bg:"bg-yellow-100",text:"text-yellow-800"},"received-back":{bg:"bg-green-100",text:"text-green-800"},"partially-received":{bg:"bg-blue-100",text:"text-blue-800"},closed:{bg:"bg-gray-100",text:"text-gray-800"}},p=R[n]||R.pending;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${p.bg} ${p.text}`,children:a.replace(/-/g," ").replace(/\b\w/g,V=>V.toUpperCase())})};return e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice Received Date"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU Number"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Short Quantity"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Received Back"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Rejected"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(a=>{const n=a.receivedBack||0,R=a.netRejected!==void 0?a.netRejected:a.shortQuantity-n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center",children:a.invoiceNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:ye(a.invoiceReceivedDate)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center",children:a.skuCode||`SKU-${a.skuId}`}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate text-center",children:a.itemName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-orange-600 text-center font-bold",children:g(a.shortQuantity)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-center",children:g(n)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-orange-600 text-center font-bold",children:g(R)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:y(a.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx(st,{report:a,isOpen:h===a.id,onToggle:()=>d(a.id),onReceiveBack:o,onViewHistory:m,dropdownRef:p=>{x.current[a.id]=p}})})]},a.id)})})]})})})},rt=({report:s,formData:t,vendors:h,brands:x,processing:d,onClose:o,onFormChange:m,onSubmit:y})=>{s.quantity-(s.sentToVendor||0)-(s.receivedBack||0)-(s.scrapped||0);const a=s.quantity-(s.sentToVendor||0)-(s.receivedBack||0)-(s.scrapped||0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Send to Vendor"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",disabled:d,children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Item:"})," ",e.jsxs("span",{className:"text-gray-900",children:[s.itemName," (",s.skuCode||`SKU-${s.skuId}`,")"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.vendorId,onChange:n=>m({vendorId:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),h.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.brandId,onChange:n=>m({brandId:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0,children:[e.jsx("option",{value:"",children:"Select Brand"}),x.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejected Quantity"}),e.jsx("input",{type:"text",value:g(s.quantity),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Already Sent"}),e.jsx("input",{type:"text",value:g(s.sentToVendor||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Send Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"1",max:a,value:t.quantity,onChange:n=>m({quantity:parseInt(n.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",g(a)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Unit Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.unitPrice!==void 0?t.unitPrice:"",onChange:n=>m({unitPrice:parseFloat(n.target.value)||0}),placeholder:"Enter unit price",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the unit price for this item"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:t.date,onChange:n=>m({date:n.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Docket/Tracking"}),e.jsx("input",{type:"text",value:t.docketTracking,onChange:n=>m({docketTracking:n.target.value}),placeholder:"Enter docket or tracking number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transporter"}),e.jsx("input",{type:"text",value:t.transporter,onChange:n=>m({transporter:n.target.value}),placeholder:"Enter transporter name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:t.reason,onChange:n=>m({reason:n.target.value}),placeholder:"Quality defect, wrong specs, etc.",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:2,disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:t.remarks,onChange:n=>m({remarks:n.target.value}),placeholder:"Additional notes or comments",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,disabled:d})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:o,disabled:d,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:d||t.quantity<=0||!t.vendorId||!t.brandId||!t.reason||!t.date||!t.unitPrice||t.unitPrice<0,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":"Send to Vendor"})]})]})})})},nt=({report:s,formData:t,vendors:h,brands:x,processing:d,onClose:o,onFormChange:m,onSubmit:y})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Receive from Vendor"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",disabled:d,children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Item:"})," ",e.jsxs("span",{className:"text-gray-900",children:[s.itemName," (",s.skuCode||`SKU-${s.skuId}`,")"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.vendorId,onChange:a=>m({vendorId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),h.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.brandId,onChange:a=>m({brandId:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0,children:[e.jsx("option",{value:"",children:"Select Brand"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Originally Sent"}),e.jsx("input",{type:"text",value:g(s.sentToVendor||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Already Received"}),e.jsx("input",{type:"text",value:g(s.receivedBack||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Receive Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"1",max:s.sentToVendor||0,value:t.quantity,onChange:a=>m({quantity:parseInt(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",g(s.sentToVendor||0)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Short Item"}),e.jsx("input",{type:"number",min:"0",max:t.quantity||0,value:t.shortItem!==void 0?t.shortItem:"",onChange:a=>m({shortItem:parseInt(a.target.value)||0}),placeholder:"Enter short item quantity (optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Enter the quantity of short items (if any). Max: ",g(t.quantity||0)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:t.date,onChange:a=>m({date:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Condition ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"condition",value:"replaced",checked:t.condition==="replaced",onChange:a=>m({condition:a.target.value}),className:"mr-2",disabled:d}),e.jsx("span",{className:"text-sm text-gray-700",children:"Replaced"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"condition",value:"repaired",checked:t.condition==="repaired",onChange:a=>m({condition:a.target.value}),className:"mr-2",disabled:d}),e.jsx("span",{className:"text-sm text-gray-700",children:"Repaired"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"condition",value:"as-is",checked:t.condition==="as-is",onChange:a=>m({condition:a.target.value}),className:"mr-2",disabled:d}),e.jsx("span",{className:"text-sm text-gray-700",children:"As-is (accepted)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice/Challan"}),e.jsx("input",{type:"text",value:t.invoiceChallan,onChange:a=>m({invoiceChallan:a.target.value}),placeholder:"Enter invoice or challan number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:t.remarks,onChange:a=>m({remarks:a.target.value}),placeholder:"Additional notes or comments",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,disabled:d})]}),e.jsx("div",{className:"flex items-center p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Items will be automatically added to available stock"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:o,disabled:d,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:d||t.quantity<=0||!t.vendorId||!t.brandId||!t.date,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Processing...":"Receive & Add to Stock"})]})]})})}),dt=({report:s,formData:t,teams:h,processing:x,onClose:d,onFormChange:o,onSubmit:m})=>{const y=s.quantity-(s.sentToVendor||0)-(s.receivedBack||0)-(s.scrapped||0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Scrap Items"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600",disabled:x,children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Item:"})," ",e.jsxs("span",{className:"text-gray-900",children:[s.itemName," (",s.skuCode||`SKU-${s.skuId}`,")"]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejected Quantity"}),e.jsx("input",{type:"text",value:g(s.quantity),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Already Scrapped"}),e.jsx("input",{type:"text",value:g(s.scrapped||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Scrap Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"1",max:y,value:t.quantity,onChange:a=>o({quantity:parseInt(a.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:x,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",g(y)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:t.date,onChange:a=>o({date:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:x,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"scrapReason",value:"beyond-repair",checked:t.scrapReason==="beyond-repair",onChange:a=>o({scrapReason:a.target.value,scrapReasonOther:""}),className:"mr-2",disabled:x}),e.jsx("span",{className:"text-sm text-gray-700",children:"Beyond repair"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"scrapReason",value:"not-worth-return",checked:t.scrapReason==="not-worth-return",onChange:a=>o({scrapReason:a.target.value,scrapReasonOther:""}),className:"mr-2",disabled:x}),e.jsx("span",{className:"text-sm text-gray-700",children:"Not worth return cost"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"scrapReason",value:"expired-obsolete",checked:t.scrapReason==="expired-obsolete",onChange:a=>o({scrapReason:a.target.value,scrapReasonOther:""}),className:"mr-2",disabled:x}),e.jsx("span",{className:"text-sm text-gray-700",children:"Expired/obsolete"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"scrapReason",value:"other",checked:t.scrapReason==="other",onChange:a=>o({scrapReason:a.target.value}),className:"mr-2",disabled:x}),e.jsx("span",{className:"text-sm text-gray-700 mr-2",children:"Other:"}),t.scrapReason==="other"&&e.jsx("input",{type:"text",value:t.scrapReasonOther,onChange:a=>o({scrapReasonOther:a.target.value}),placeholder:"Specify reason",className:"flex-1 px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:x})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Approved By ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.approvedBy,onChange:a=>o({approvedBy:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",disabled:x,required:!0,children:[e.jsx("option",{value:"",children:"Select Team"}),h.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:t.remarks,onChange:a=>o({remarks:a.target.value}),placeholder:"Additional notes or comments",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",rows:3,disabled:x})]}),e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-yellow-800 flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-600 font-bold",children:"⚠️"}),"This action cannot be undone"]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:d,disabled:x,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:x||t.quantity<=0||!t.date||!t.approvedBy||t.scrapReason==="other"&&!t.scrapReasonOther.trim(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Processing...":"Confirm Scrap"})]})]})})})},lt=({report:s,onClose:t})=>{const h=s.netRejected!==void 0?s.netRejected:s.quantity-(s.sentToVendor||0)-(s.receivedBack||0)-(s.scrapped||0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transaction History"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Report:"})," ",s.reportNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Item:"})," ",s.itemName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Rejected Qty:"})," ",g(s.quantity)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Sent to Vendor:"})," ",g(s.sentToVendor||0)]})}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Received Back:"})," ",g(s.receivedBack||0)]})}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Scrapped:"})," ",g(s.scrapped||0)]})}),e.jsx("div",{className:"p-3 border border-gray-200 rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Net Rejected:"})," ",g(h)]})})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{onClick:t,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Close"})})]})})})},it=({report:s,formData:t,vendors:h,brands:x,teams:d,processing:o,onClose:m,onFormChange:y,onSubmit:a})=>{const R=s.shortQuantity-(s.receivedBack||0);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4",style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Receive Back"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",disabled:o,children:e.jsx(F,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Item:"})," ",e.jsxs("span",{className:"text-gray-900",children:[s.itemName," (",s.skuCode||`SKU-${s.skuId}`,")"]})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.vendorId,onChange:p=>y({vendorId:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),h.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.brandId,onChange:p=>y({brandId:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0,children:[e.jsx("option",{value:"",children:"Select Brand"}),x.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shorted Value"}),e.jsx("input",{type:"text",value:g(s.shortQuantity),className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700",readOnly:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Receive Shorted Quantity ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"1",max:R,value:t.quantity,onChange:p=>y({quantity:parseInt(p.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Max: ",g(R)]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:t.date,onChange:p=>y({date:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Invoice Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.invoiceChallan,onChange:p=>y({invoiceChallan:p.target.value}),placeholder:"Enter invoice number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Received By ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:t.receivedBy||"",onChange:p=>y({receivedBy:p.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,required:!0,children:[e.jsx("option",{value:"",children:"Select Team Member"}),d.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:m,disabled:o,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:a,disabled:o||t.quantity<=0||!t.vendorId||!t.brandId||!t.date||!t.invoiceChallan||!t.receivedBy,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Processing...":"Receive Back"})]})]})})})},qt=()=>{const[s,t]=u.useState("rejected"),[h,x]=u.useState(!1),[d,o]=u.useState([]),[m,y]=u.useState([]),[a,n]=u.useState([]),[R,p]=u.useState([]),[V,Y]=u.useState(!1),[I,ct]=u.useState(""),[M,ot]=u.useState(""),[$,xt]=u.useState(""),[H,A]=u.useState(null),le=u.useRef({}),[K,_]=u.useState(null),ie=u.useRef({}),[N,G]=u.useState(null),[k,W]=u.useState(null),[S,Z]=u.useState(null),[ce,oe]=u.useState(null),[C,D]=u.useState(null),[l,z]=u.useState({quantity:0,remarks:"",vendorId:"",brandId:"",date:new Date().toISOString().split("T")[0],docketTracking:"",transporter:"",reason:"",condition:"replaced",invoiceChallan:"",addToStock:!0,scrapReason:"beyond-repair",scrapReasonOther:"",approvedBy:"",unitPrice:void 0,shortItem:void 0}),[J,P]=u.useState(!1),[j,ee]=u.useState({quantity:0,remarks:"",vendorId:"",brandId:"",date:new Date().toISOString().split("T")[0],docketTracking:"",transporter:"",reason:"",condition:"replaced",invoiceChallan:"",addToStock:!0,receivedBy:""}),[te,Ne]=u.useState([]),[se,we]=u.useState([]),[xe,ke]=u.useState([]),Ie=async()=>{try{const[r,i,c]=await Promise.all([ne.getYourVendors(),ne.getYourBrands(),ne.getTeams()]);Ne(r.data||[]),we(i.data||[]),ke(c.data||[])}catch(r){console.error("Error loading vendors, brands, and teams:",r)}},T=u.useCallback(async()=>{try{x(!0);const r={};M&&(r.dateFrom=M),$&&(r.dateTo=$),I&&(r.search=I),console.log("[RejectedItemReportPage] Loading rejected item reports with params:",r);const i=await B.getRejectedItemReports(r);if(i.success){const c=i.data||[];console.log("[RejectedItemReportPage] Loaded rejected item reports:",c.length),o(c)}else console.warn("[RejectedItemReportPage] Response not successful:",i)}catch(r){console.error("Error loading rejected item reports:",r)}finally{x(!1)}},[M,$,I]),Q=u.useCallback(async()=>{try{Y(!0);const r={};M&&(r.dateFrom=M),$&&(r.dateTo=$),I&&(r.search=I),console.log("[RejectedItemReportPage] Loading short item reports with params:",r);const i=await B.getShortItemReports(r);if(i.success){const c=i.data||[];console.log("[RejectedItemReportPage] Loaded short item reports:",c.length),n(c)}else console.warn("[RejectedItemReportPage] Response not successful:",i)}catch(r){console.error("Error loading short item reports:",r)}finally{Y(!1)}},[M,$,I]);u.useEffect(()=>{T(),Q(),Ie()},[T,Q]);const ue=u.useRef(T),me=u.useRef(Q);u.useEffect(()=>{ue.current=T,me.current=Q},[T,Q]),u.useEffect(()=>Ye(()=>{console.log("[RejectedItemReportPage] Inventory updated event received, refreshing reports..."),setTimeout(()=>{ue.current(),me.current()},150)}),[]),u.useEffect(()=>{Re(),Se()},[d,a,I,M,$]),u.useEffect(()=>{const r=i=>{if(H!==null){const c=le.current[H];c&&!c.contains(i.target)&&A(null)}if(K!==null){const c=ie.current[K];c&&!c.contains(i.target)&&_(null)}};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[H,K]);const Re=()=>{let r=[...d];if(I){const i=I.toLowerCase();r=r.filter(c=>{var v,b,f,w;return((v=c.reportNumber)==null?void 0:v.toLowerCase().includes(i))||((b=c.skuCode)==null?void 0:b.toLowerCase().includes(i))||((f=c.itemName)==null?void 0:f.toLowerCase().includes(i))||((w=c.originalInvoiceNumber)==null?void 0:w.toLowerCase().includes(i))})}y(r)},Se=()=>{let r=[...a];if(I){const i=I.toLowerCase();r=r.filter(c=>{var v,b,f;return((v=c.invoiceNumber)==null?void 0:v.toLowerCase().includes(i))||((b=c.skuCode)==null?void 0:b.toLowerCase().includes(i))||((f=c.itemName)==null?void 0:f.toLowerCase().includes(i))})}p(r)},Ce=()=>{console.log("Export functionality to be implemented")},qe=r=>{_(K===r?null:r)},pe=()=>({quantity:0,remarks:"",vendorId:"",brandId:"",date:new Date().toISOString().split("T")[0],docketTracking:"",transporter:"",reason:"",condition:"replaced",invoiceChallan:"",addToStock:!0,receivedBy:""}),he=()=>{ee(pe())},Te=r=>{_(null);const i=r.shortQuantity-(r.receivedBack||0);ee({...pe(),quantity:Math.max(0,i),vendorId:r.vendorId||"",brandId:r.brandId||""}),D(r)},Be=async()=>{var i,c,v,b,f;if(!C)return;if(!j.vendorId){alert("Please select a vendor");return}if(!j.brandId){alert("Please select a brand");return}if(!j.date){alert("Please select a date");return}if(!j.invoiceChallan){alert("Please enter invoice number");return}if(!j.receivedBy){alert("Please select received by");return}if(j.quantity<=0){alert("Quantity must be greater than 0");return}const r=C.shortQuantity-(C.receivedBack||0);if(j.quantity>r){alert("Quantity exceeds available short quantity");return}try{P(!0);let w=.01;try{const q=await de.getById(C.skuId);q!=null&&q.success&&((i=q.data)!=null&&i.unitPrice)&&(w=q.data.unitPrice>0?q.data.unitPrice:.01)}catch(q){console.warn("Could not fetch SKU unit price, using 0.01:",q)}const U={invoiceDate:j.date,invoiceNumber:j.invoiceChallan,receivingDate:j.date,vendorId:parseInt(j.vendorId),brandId:parseInt(j.brandId),receivedBy:parseInt(j.receivedBy),documentType:"bill",status:"completed",remarks:j.remarks||`Short items received back. Original invoice: ${C.invoiceNumber}`,items:[{skuId:C.skuId,received:j.quantity,short:0,totalQuantity:j.quantity,unitPrice:w,totalValue:j.quantity*w}]};await B.addIncoming(U);const O=C.shortQuantity-j.quantity;await B.updateShortItem(C.incomingInventoryId,{itemId:C.incomingInventoryItemId,short:Math.max(0,O)}),await Q(),D(null),he(),alert("Short items received back successfully and added to stock")}catch(w){console.error("Error receiving back short items:",w),alert(((v=(c=w.response)==null?void 0:c.data)==null?void 0:v.error)||((f=(b=w.response)==null?void 0:b.data)==null?void 0:f.message)||"Failed to receive back short items")}finally{P(!1)}},Ve=r=>{_(null),console.log("View history for short item:",r),alert("History view functionality to be implemented")},Pe=r=>{A(H===r?null:r)},X=()=>({quantity:0,remarks:"",vendorId:"",brandId:"",date:new Date().toISOString().split("T")[0],docketTracking:"",transporter:"",reason:"",condition:"replaced",invoiceChallan:"",addToStock:!0,scrapReason:"beyond-repair",scrapReasonOther:"",approvedBy:"",unitPrice:void 0,shortItem:void 0}),L=()=>{z(X())},Qe=async r=>{var v;A(null);const i=r.quantity-(r.sentToVendor||0)-(r.receivedBack||0)-(r.scrapped||0);let c;try{const b=await de.getById(r.skuId);b!=null&&b.success&&((v=b.data)!=null&&v.unitPrice)&&(c=b.data.unitPrice)}catch(b){console.warn("Could not fetch SKU unit price for default:",b)}z({...X(),quantity:Math.max(0,i),vendorId:r.vendorId||"",brandId:r.brandId||"",unitPrice:c}),G(r)},Ee=r=>{A(null);const i=r.sentToVendor||0;z({...X(),quantity:Math.max(0,i),vendorId:r.vendorId||"",brandId:r.brandId||"",addToStock:!0}),W(r)},Me=r=>{A(null);const i=r.quantity-(r.sentToVendor||0)-(r.receivedBack||0)-(r.scrapped||0);z({...X(),quantity:Math.max(0,i)}),Z(r)},$e=r=>{A(null),oe(r)},ae=r=>{z(i=>({...i,...r}))},Oe=async()=>{var r,i,c,v;if(N){if(!l.vendorId){alert("Please select a vendor");return}if(!l.brandId){alert("Please select a brand");return}if(!l.reason){alert("Please enter a reason");return}if(!l.date){alert("Please select a date");return}if(l.quantity<=0){alert("Quantity must be greater than 0");return}if(l.quantity>N.quantity-(N.sentToVendor||0)-(N.receivedBack||0)-(N.scrapped||0)){alert("Quantity exceeds available rejected quantity");return}if(l.unitPrice===void 0||l.unitPrice===null||l.unitPrice<0){alert("Please enter a valid unit price (must be 0 or greater)");return}try{P(!0);const b=N.reportNumber||`REJ-${N.originalInvoiceNumber}-${Date.now()}`,f=l.unitPrice>0?l.unitPrice:.01,w={documentType:"delivery_challan",documentSubType:"replacement",deliveryChallanSubType:"to_vendor",invoiceChallanDate:l.date,invoiceChallanNumber:b,docketNumber:l.docketTracking||"",transportorName:l.transporter||"",destinationType:"vendor",destinationId:parseInt(l.vendorId),remarks:l.remarks||`Rejected items sent to vendor. Reason: ${l.reason}`,status:"completed",items:[{skuId:N.skuId,outgoingQuantity:l.quantity,unitPrice:f,totalValue:f*l.quantity}]};await B.addOutgoing(w);const U=(N.sentToVendor||0)+l.quantity,O=Math.max(0,N.quantity-U-(N.receivedBack||0)-(N.scrapped||0));await B.updateRejectedItemReport(N.id,{sentToVendor:U,netRejected:O}),await T(),G(null),L(),alert(`Items sent to vendor successfully. Report Number: ${b}`)}catch(b){console.error("Error sending to vendor:",b),alert(((i=(r=b.response)==null?void 0:r.data)==null?void 0:i.error)||((v=(c=b.response)==null?void 0:c.data)==null?void 0:v.message)||"Failed to send items to vendor")}finally{P(!1)}}},Ae=async()=>{var r,i,c,v,b;if(k){if(!l.vendorId){alert("Please select a vendor");return}if(!l.brandId){alert("Please select a brand");return}if(!l.date){alert("Please select a date");return}if(l.quantity<=0){alert("Quantity must be greater than 0");return}if(l.quantity>(k.sentToVendor||0)){alert("Quantity exceeds sent to vendor quantity");return}if(l.shortItem!==void 0&&l.shortItem>l.quantity){alert("Short item quantity cannot exceed receive quantity");return}try{P(!0);const f=(k.receivedBack||0)+l.quantity,w=Math.max(0,(k.sentToVendor||0)-l.quantity),U=Math.max(0,k.quantity-w-f-(k.scrapped||0));await B.updateRejectedItemReport(k.id,{sentToVendor:w,receivedBack:f,netRejected:U});const O=l.shortItem||0,q=l.quantity-O,be=l.quantity,Ke=l.invoiceChallan||`RECV-${k.reportNumber}-${Date.now()}`;let re=.01;try{const E=await de.getById(k.skuId);E!=null&&E.success&&((r=E.data)!=null&&r.unitPrice)&&(re=E.data.unitPrice>0?E.data.unitPrice:.01)}catch(E){console.warn("Could not fetch SKU unit price, using 0.01:",E)}const ze={invoiceDate:l.date,invoiceNumber:Ke,receivingDate:l.date,vendorId:parseInt(l.vendorId),brandId:parseInt(l.brandId),documentType:"bill",status:"completed",remarks:l.remarks||`Items received from vendor. Condition: ${l.condition}. ${k.reportNumber?`Report: ${k.reportNumber}`:""}`,items:[{skuId:k.skuId,received:q,short:O,totalQuantity:be,unitPrice:re,totalValue:be*re}]};await B.addIncoming(ze),await T(),await Q(),W(null),L();const ge=["added to available stock"];O>0&&ge.push("short item recorded"),alert(`Items received from vendor successfully and ${ge.join(", ")}`)}catch(f){console.error("Error receiving from vendor:",f),alert(((c=(i=f.response)==null?void 0:i.data)==null?void 0:c.error)||((b=(v=f.response)==null?void 0:v.data)==null?void 0:b.message)||"Failed to receive items from vendor")}finally{P(!1)}}},Le=async()=>{var r,i;if(S){if(!l.date){alert("Please select a date");return}if(l.quantity<=0){alert("Quantity must be greater than 0");return}if(l.quantity>S.quantity-(S.sentToVendor||0)-(S.receivedBack||0)-(S.scrapped||0)){alert("Quantity exceeds available rejected quantity");return}if(l.scrapReason==="other"&&!l.scrapReasonOther.trim()){alert("Please specify the reason for scrapping");return}if(!l.approvedBy){alert("Please select who approved this scrap action");return}try{P(!0);const c=(S.scrapped||0)+l.quantity,v=Math.max(0,S.quantity-(S.sentToVendor||0)-(S.receivedBack||0)-c);await B.updateRejectedItemReport(S.id,{scrapped:c,netRejected:v}),await T(),Z(null),L(),alert("Items marked as scrapped successfully")}catch(c){console.error("Error scrapping items:",c),alert(((i=(r=c.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to scrap items")}finally{P(!1)}}},Ue=()=>d.length,He=()=>a.length;return e.jsxs("div",{className:"p-6 space-y-[30px] w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-[18px]",children:e.jsxs("div",{className:"space-y-[6px]",children:[e.jsx("h1",{className:"text-[27px] font-black text-slate-900 tracking-tight",children:"Rejected & Short Items"}),e.jsx("p",{className:"text-[13.5px] text-slate-500 font-medium",children:"Manage rejected items and short shipments tracking."})]})}),e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-sm p-[6px] flex items-center justify-between gap-[6px]",children:[e.jsxs("div",{className:"flex gap-[6px]",children:[e.jsxs("button",{onClick:()=>t("rejected"),className:`flex items-center gap-[9px] px-[18px] py-[9px] rounded-xl transition-all ${s==="rejected"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:[e.jsx(Xe,{className:`w-[15px] h-[15px] ${s==="rejected"?"text-white":"text-slate-400"}`}),e.jsx("span",{className:`font-black text-[9.75px] uppercase tracking-wider ${s==="rejected"?"text-white":"text-slate-600"}`,children:"Rejected Items"}),e.jsx("span",{className:`px-[6px] py-[3px] rounded-full text-[10.5px] font-medium ${s==="rejected"?"bg-orange-100 text-orange-600":"bg-gray-200 text-gray-600"}`,children:Ue()})]}),e.jsxs("button",{onClick:()=>t("short"),className:`flex items-center gap-[9px] px-[18px] py-[12px] rounded-lg border-2 transition-all ${s==="short"?"bg-white border-orange-500 shadow-md":"bg-gray-100 border-gray-300 hover:bg-gray-200"}`,children:[e.jsx("div",{className:`p-[6px] rounded-full ${s==="short"?"bg-orange-100":"bg-gray-200"}`,children:e.jsx(Fe,{className:`w-[15px] h-[15px] ${s==="short"?"text-orange-600":"text-gray-600"}`})}),e.jsx("span",{className:`font-medium text-[10.5px] ${s==="short"?"text-orange-600":"text-gray-600"}`,children:"Short Shipments"}),e.jsx("span",{className:`px-[6px] py-[3px] rounded-full text-[10.5px] font-medium ${s==="short"?"bg-orange-100 text-orange-600":"bg-gray-200 text-gray-600"}`,children:He()})]})]}),e.jsxs("div",{className:"flex items-center gap-[9px]",children:[e.jsxs("button",{onClick:()=>{s==="rejected"?T():Q()},disabled:s==="rejected"?h:V,className:"px-3 py-[6px] rounded-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50 text-[10.5px]",children:[e.jsx(Ge,{className:`w-3 h-3 inline mr-[6px] ${(s==="rejected"?h:V)?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:Ce,className:"px-3 py-[6px] rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors text-[10.5px]",children:[e.jsx(We,{className:"w-3 h-3 inline mr-[6px]"}),"Export"]})]})]}),s==="rejected"?e.jsx(tt,{reports:m,loading:h,openDropdownId:H,dropdownRefs:le,onToggleDropdown:Pe,onSendToVendor:Qe,onReceiveFromVendor:Ee,onScrap:Me,onViewHistory:$e}):e.jsx(at,{reports:R,loading:V,openDropdownId:K,dropdownRefs:ie,onToggleDropdown:qe,onReceiveBack:Te,onViewHistory:Ve}),N&&e.jsx(rt,{report:N,formData:l,vendors:te,brands:se,processing:J,onClose:()=>{G(null),L()},onFormChange:ae,onSubmit:Oe}),k&&e.jsx(nt,{report:k,formData:l,vendors:te,brands:se,processing:J,onClose:()=>{W(null),L()},onFormChange:ae,onSubmit:Ae}),S&&e.jsx(dt,{report:S,formData:l,teams:xe,processing:J,onClose:()=>{Z(null),L()},onFormChange:ae,onSubmit:Le}),ce&&e.jsx(lt,{report:ce,onClose:()=>oe(null)}),C&&e.jsx(it,{report:C,formData:j,vendors:te,brands:se,teams:xe,processing:J,onClose:()=>{D(null),he()},onFormChange:r=>ee(i=>({...i,...r})),onSubmit:Be})]})};export{qt as default};
