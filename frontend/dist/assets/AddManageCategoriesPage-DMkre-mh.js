import{c as Xe,u as Ge,b as He,r as m,j as r}from"./index-C4O2RVGC.js";import{l as x}from"./libraryService-BC59J_DM.js";import{e as F}from"./categoriesEvents-i2FsXa12.js";import{A as Qe}from"./arrow-left-DX9oxssc.js";import{S as te}from"./save-jeta1nOA.js";import{X as Ve}from"./x-ChutkFoY.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=Xe("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function h(b){return R(b).trim().replace(/\s+/g," ")}function R(b){return(b??"").toUpperCase().replace(/[^A-Z0-9 ]/g,"").slice(0,25)}function se(b){return b.split(",").map(I=>h(I)).filter(Boolean)}function tt(){return`${Date.now()}-${Math.random().toString(36).slice(2)}`}function ae({tag:b,editable:I,onChange:z,onRemove:B}){return r.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-sm",children:[I?r.jsx("input",{value:b.name,onChange:f=>z(R(f.target.value)),className:"bg-transparent outline-none w-44"}):r.jsx("span",{className:"max-w-[220px] truncate",children:b.name}),r.jsx("button",{type:"button",onClick:B,className:"text-gray-500 hover:text-gray-900","aria-label":"Remove",title:"Remove",children:r.jsx(Ve,{className:"w-4 h-4"})})]})}function dt(){const b=Ge(),I=He(),[z,B]=m.useState([]),f=e=>{const t=tt();B(s=>[...s,{...e,id:t}]),window.setTimeout(()=>{B(s=>s.filter(o=>o.id!==t))},3500)},[ge,g]=m.useState(!1),[v,ye]=m.useState([]),[A,U]=m.useState(null),[p,S]=m.useState([]),[j,Z]=m.useState(""),[q,X]=m.useState(!1),[he,pe]=m.useState([]),[C,O]=m.useState(1),[re,oe]=m.useState([]),[J,D]=m.useState({}),[ie,G]=m.useState({}),[xe,H]=m.useState({}),[be,we]=m.useState({}),[Ne,ve]=m.useState([]),[W,P]=m.useState({}),[ne,Q]=m.useState({}),[Se,V]=m.useState({}),[je,Ce]=m.useState({}),k=e=>re.filter(t=>t.productCategoryId===e),w=()=>p.filter(e=>!e.isDeleted),De=m.useRef(null),le=m.useRef(I.state||null),E=m.useRef(null),[Pe,T]=m.useState(!1),[ke,Y]=m.useState({}),[Ee,$]=m.useState({}),ce=async()=>{const e=await x.getYourProductCategories();ye(e.data||[])},M=async e=>{const s=(await x.getYourItemCategories(e)).data||[];oe(o=>[...o.filter(i=>i.productCategoryId!==e),...s])},K=async e=>{const s=(await x.getYourSubCategories(e)).data||[];ve(o=>[...o.filter(i=>i.itemCategoryId!==e),...s])};m.useEffect(()=>{g(!0),ce().catch(e=>{console.error(e),f({type:"error",title:"Failed to load product categories"})}).finally(()=>g(!1))},[]),m.useEffect(()=>{const e=le.current;if(!(e!=null&&e.fromCategoryMaster)||!v.length)return;const t=Number(e.productCategoryId)||null,s=Number(e.itemCategoryId)||null;if(t){const o=v.find(a=>a.id===t);o&&(U(o),O(2))}s&&O(3),le.current=null},[v]),m.useEffect(()=>{if(C!==2)return;const e=w();e.length!==0&&(g(!0),Promise.all(e.filter(t=>t.id).map(t=>M(t.id))).catch(t=>{console.error(t),f({type:"error",title:"Failed to load item categories"})}).finally(()=>g(!1)))},[C,p]),m.useEffect(()=>{if(C!==3)return;const e=w(),t=[];for(const s of e)if(s.id){const o=k(s.id);t.push(...o.map(a=>a.id))}t.length!==0&&(g(!0),Promise.all(t.map(s=>K(s))).catch(s=>{console.error(s),f({type:"error",title:"Failed to load sub-categories"})}).finally(()=>g(!1)))},[C,re]);const ee=e=>{U(e)},Ie=e=>{S(t=>{const s=t.find(a=>a.id===e.id);if(s){const a=t.map(i=>i.id===e.id?{...i,isDeleted:!i.isDeleted}:i);if((A==null?void 0:A.id)===e.id&&!s.isDeleted){const i=a.filter(n=>!n.isDeleted&&n.id);if(i.length>0&&i[0].id){const n=v.find(l=>l.id===i[0].id);n&&ee(n)}else U(null)}return a}const o=[...t,{id:e.id,name:e.name,originalName:e.name}];return A||ee(e),o})},Le=()=>{const e=se(j);e.length!==0&&(S(t=>{const s=[...t];for(const o of e){if(s.some(n=>!n.isDeleted&&n.name.toLowerCase()===o.toLowerCase()))continue;const i=v.find(n=>n.name.toLowerCase()===o.toLowerCase());i?(s.push({id:i.id,name:i.name,originalName:i.name}),A||ee(i)):s.push({name:o,isNew:!0})}return s}),Z(""))},Fe=()=>{pe(JSON.parse(JSON.stringify(p))),X(!0)},Ae=()=>{S(he),X(!1)},Te=async()=>{const e=p.filter(s=>!s.isDeleted).map(s=>h(s.name));if(e.some(s=>!s)){f({type:"error",title:"Product category name cannot be empty"});return}const t=e.find((s,o)=>e.findIndex(a=>a.toLowerCase()===s.toLowerCase())!==o);if(t){f({type:"error",title:`Duplicate product category: "${t}"`});return}g(!0);try{for(const i of p.filter(n=>!n.isDeleted&&n.isNew))await x.createYourProductCategory({name:h(i.name)});for(const i of p.filter(n=>!n.isDeleted&&n.id&&n.originalName&&h(n.name)!==h(n.originalName)))await x.updateYourProductCategory(i.id,{name:h(i.name)});await ce();const o=(await x.getYourProductCategories()).data||[],a=p.map(i=>{if(i.isDeleted)return i;if(i.isNew){const n=o.find(l=>l.name.toLowerCase()===h(i.name).toLowerCase());if(n)return{id:n.id,name:n.name,originalName:n.name}}return i});return S(a),X(!1),f({type:"success",title:"Product categories saved"}),F(),a}catch(s){f({type:"error",title:"Failed to save product categories",message:s==null?void 0:s.message});return}finally{g(!1)}},Ye=async()=>{const e=await Te();if(!e)return;const t=e.filter(s=>!s.isDeleted&&s.id);if(t.length>0){g(!0);try{await Promise.all(t.map(s=>M(s.id)))}catch(s){console.error("Error loading items:",s),f({type:"error",title:"Failed to load item categories"})}finally{g(!1)}O(2),setTimeout(()=>{E.current&&E.current.scrollTo({left:E.current.clientWidth,behavior:"smooth"})},100)}},$e=async()=>{await me();const e=w();g(!0);try{await Promise.all(e.filter(s=>s.id).map(s=>M(s.id)));const t=[];for(const s of e)if(s.id){const o=k(s.id);t.push(...o.map(a=>a.id))}t.length>0&&await Promise.all(t.map(s=>K(s)))}catch(t){console.error("Error loading data:",t)}finally{g(!1)}O(3),setTimeout(()=>{E.current&&E.current.scrollTo({left:E.current.clientWidth*2,behavior:"smooth"})},100)},Me=e=>{const t=se(ie[e]||"");if(t.length===0)return;const s=k(e);D(o=>{const i=[...o[e]||[]];for(const n of t){if(i.some(c=>!c.isDeleted&&c.name.toLowerCase()===n.toLowerCase()))continue;const d=s.find(c=>c.name.toLowerCase()===n.toLowerCase());d?i.push({id:d.id,name:d.name,originalName:d.name}):i.push({name:n,isNew:!0})}return{...o,[e]:i}}),G(o=>({...o,[e]:""}))},Re=(e,t)=>{D(s=>{const o=s[t]||[];return o.find(i=>i.id===e.id)?{...s,[t]:o.map(i=>i.id===e.id?{...i,isDeleted:!i.isDeleted}:i)}:{...s,[t]:[...o,{id:e.id,name:e.name,originalName:e.name}]}})},ze=e=>{we(t=>({...t,[e]:JSON.parse(JSON.stringify(J[e]||[]))})),H(t=>({...t,[e]:!0}))},Be=e=>{D(t=>({...t,[e]:be[e]||[]})),H(t=>({...t,[e]:!1}))},Oe=async e=>{const t=J[e]||[],s=t.filter(a=>!a.isDeleted).map(a=>h(a.name));if(s.some(a=>!a)){f({type:"error",title:"Item category name cannot be empty"});return}const o=s.find((a,i)=>s.findIndex(n=>n.toLowerCase()===a.toLowerCase())!==i);if(o){f({type:"error",title:`Duplicate item category: "${o}"`});return}g(!0);try{for(const a of t.filter(i=>i.isDeleted&&i.id))await x.deleteYourItemCategory(a.id);for(const a of t.filter(i=>!i.isDeleted&&i.isNew))await x.createYourItemCategory({name:h(a.name),productCategoryId:e});for(const a of t.filter(i=>!i.isDeleted&&i.id&&i.originalName&&h(i.name)!==h(i.originalName)))await x.updateYourItemCategory(a.id,{name:h(a.name),productCategoryId:e});await M(e),D(a=>({...a,[e]:[]})),H(a=>({...a,[e]:!1})),f({type:"success",title:"Item categories saved"}),F()}catch(a){f({type:"error",title:"Failed to save item categories",message:a==null?void 0:a.message})}finally{g(!1)}},de=async(e,t,s)=>{if(t.id){g(!0);try{await x.deleteYourItemCategory(t.id),await M(e),D(o=>({...o,[e]:(o[e]||[]).filter((a,i)=>i!==s)})),f({type:"success",title:"Item category deleted"}),F()}catch(o){f({type:"error",title:"Failed to delete item category",message:o==null?void 0:o.message})}finally{g(!1)}}else D(o=>({...o,[e]:(o[e]||[]).filter((a,i)=>i!==s)}))},me=async()=>{var t;const e=w();for(const s of e)s.id&&((t=J[s.id])==null?void 0:t.length)>0&&await Oe(s.id)},ue=e=>Ne.filter(t=>t.itemCategoryId===e),N=(e,t)=>`${e}-${t}`,Je=(e,t)=>{const s=N(e,t),o=se(ne[s]||"");if(o.length===0)return;const a=ue(t);P(i=>{const l=[...i[s]||[]];for(const d of o){if(l.some(y=>!y.isDeleted&&y.name.toLowerCase()===d.toLowerCase()))continue;const u=a.find(y=>y.name.toLowerCase()===d.toLowerCase());u?l.push({id:u.id,name:u.name,originalName:u.name}):l.push({name:d,isNew:!0})}return{...i,[s]:l}}),Q(i=>({...i,[s]:""}))},We=(e,t,s)=>{const o=N(t,s);P(a=>{const i=a[o]||[];return i.find(l=>l.id===e.id)?{...a,[o]:i.map(l=>l.id===e.id?{...l,isDeleted:!l.isDeleted}:l)}:{...a,[o]:[...i,{id:e.id,name:e.name,originalName:e.name}]}})},Ke=(e,t)=>{const s=N(e,t);Ce(o=>({...o,[s]:JSON.parse(JSON.stringify(W[s]||[]))})),V(o=>({...o,[s]:!0}))},_e=(e,t)=>{const s=N(e,t);P(o=>({...o,[s]:je[s]||[]})),V(o=>({...o,[s]:!1}))},Ue=async(e,t)=>{const s=N(e,t),o=W[s]||[],a=o.filter(n=>!n.isDeleted).map(n=>h(n.name));if(a.some(n=>!n)){f({type:"error",title:"Sub-category name cannot be empty"});return}const i=a.find((n,l)=>a.findIndex(d=>d.toLowerCase()===n.toLowerCase())!==l);if(i){f({type:"error",title:`Duplicate sub-category: "${i}"`});return}g(!0);try{for(const n of o.filter(l=>l.isDeleted&&l.id))await x.deleteYourSubCategory(n.id);for(const n of o.filter(l=>!l.isDeleted&&l.isNew))await x.createYourSubCategory({name:h(n.name),itemCategoryId:t});for(const n of o.filter(l=>!l.isDeleted&&l.id&&l.originalName&&h(l.name)!==h(l.originalName)))await x.updateYourSubCategory(n.id,{name:h(n.name),itemCategoryId:t});await K(t),P(n=>({...n,[s]:[]})),V(n=>({...n,[s]:!1})),f({type:"success",title:"Sub-categories saved"}),F()}catch(n){f({type:"error",title:"Failed to save sub-categories",message:n==null?void 0:n.message})}finally{g(!1)}},fe=async(e,t,s,o)=>{const a=N(e,t);if(s.id){g(!0);try{await x.deleteYourSubCategory(s.id),await K(t),P(i=>({...i,[a]:(i[a]||[]).filter((n,l)=>l!==o)})),f({type:"success",title:"Sub-category deleted"}),F()}catch(i){f({type:"error",title:"Failed to delete sub-category",message:i==null?void 0:i.message})}finally{g(!1)}}else P(i=>({...i,[a]:(i[a]||[]).filter((n,l)=>l!==o)}))},Ze=async()=>{const e=w();if(e.length===0){f({type:"error",title:"Select at least one Product Category first"});return}g(!0);try{await me();const t=e.filter(a=>a.id).map(a=>x.getYourItemCategories(a.id)),s=await Promise.all(t),o=[];s.forEach(a=>{o.push(...a.data||[])}),oe(o);for(const a of e){if(!a.id)continue;const i=k(a.id);for(const n of i){const l=N(a.id,n.id),d=W[l]||[];(d.filter(c=>!c.isDeleted).length>0||d.some(c=>c.isDeleted))&&await Ue(a.id,n.id)}}f({type:"success",title:"All changes saved"}),F(),b("/app/library")}catch(t){f({type:"error",title:"Save All failed",message:t==null?void 0:t.message})}finally{g(!1)}};return r.jsxs("div",{className:"p-8 space-y-10 w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[r.jsx("style",{children:`
        .wizard-scroll-container::-webkit-scrollbar {
          display: none;
        }
      `}),r.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:z.map(e=>r.jsxs("div",{className:`w-80 rounded-2xl border px-4 py-3 shadow-lg bg-white ${e.type==="success"?"border-emerald-200":e.type==="error"?"border-rose-200":"border-slate-200"}`,children:[r.jsx("div",{className:"font-black text-slate-900",children:e.title}),e.message&&r.jsx("div",{className:"text-sm text-slate-600 mt-0.5 font-medium",children:e.message})]},e.id))}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("button",{type:"button",onClick:()=>b("/app/library"),className:"text-slate-600 hover:text-slate-900 transition-colors",children:r.jsx(Qe,{className:"w-6 h-6"})}),r.jsx("h1",{className:"text-4xl font-black text-slate-900 tracking-tight",children:"Add / Manage Categories"})]}),r.jsxs("div",{className:"text-base text-slate-500 font-medium flex items-center gap-2",children:[r.jsx("span",{className:C===1?"font-black text-indigo-600":"",children:"Product Category"}),r.jsx("span",{children:"→"}),r.jsx("span",{className:C===2?"font-black text-indigo-600":"",children:"Item Category"}),r.jsx("span",{children:"→"}),r.jsx("span",{className:C===3?"font-black text-indigo-600":"",children:"Sub-Category"})]})]}),ge&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Working..."]})]}),r.jsx("div",{ref:E,className:"wizard-scroll-container overflow-x-auto overflow-y-hidden scroll-smooth snap-x snap-mandatory",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:r.jsxs("div",{className:"flex",style:{width:"300%"},children:[r.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:r.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-4 mr-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"1) Product Category"}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Type and press Enter (or use commas) to add. Suggestions will appear as you type."})]}),p.filter(e=>!e.isDeleted).length>0&&r.jsxs("div",{className:"text-xs text-gray-500",children:["Selected: ",r.jsx("span",{className:"font-semibold text-gray-900",children:p.filter(e=>!e.isDeleted).map(e=>e.name).join(", ")})]})]}),r.jsxs("div",{className:"mt-4",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Product Category"}),r.jsxs("div",{className:"mt-1 relative autocomplete-container",children:[r.jsx("div",{className:"border border-gray-300 rounded-lg px-3 py-2",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.filter(e=>!e.isDeleted).map((e,t)=>r.jsx(ae,{tag:e,editable:q,onChange:s=>S(o=>o.map((a,i)=>i===t?{...a,name:s}:a)),onRemove:()=>S(s=>s.map((o,a)=>a===t?{...o,isDeleted:!0}:o))},`${e.id??"new"}-${t}`)),r.jsx("input",{ref:De,value:j,onChange:e=>{Z(R(e.target.value)),T(e.target.value.length>0)},onFocus:()=>{j.length>0&&T(!0)},onKeyDown:e=>{var t;if((e.key==="Enter"||e.key===",")&&(e.preventDefault(),Le(),T(!1)),e.key==="Backspace"&&j===""&&p.length>0){const s=(t=p.map((o,a)=>({t:o,i:a})).filter(({t:o})=>!o.isDeleted).slice(-1)[0])==null?void 0:t.i;s!==void 0&&S(o=>o.map((a,i)=>i===s?{...a,isDeleted:!0}:a))}e.key==="Escape"&&T(!1)},placeholder:"Type product category and press Enter…",className:"flex-1 min-w-[220px] outline-none"})]})}),Pe&&j.length>0&&r.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[v.filter(e=>{const t=j.toLowerCase();return e.name.toLowerCase().includes(t)&&!p.some(s=>s.id===e.id&&!s.isDeleted)}).slice(0,10).map(e=>r.jsx("div",{onClick:()=>{Ie(e),Z(""),T(!1)},className:"px-3 py-2 text-sm hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:r.jsx("div",{className:"font-medium",children:e.name})},e.id)),v.filter(e=>{const t=j.toLowerCase();return e.name.toLowerCase().includes(t)&&!p.some(s=>s.id===e.id&&!s.isDeleted)}).length===0&&r.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No matching categories found"})]})]})]}),r.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>q?Ae():Fe(),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm",children:[r.jsx(et,{className:"w-4 h-4"}),q?"Cancel":"Edit"]}),r.jsxs("button",{type:"button",onClick:Ye,disabled:p.filter(e=>!e.isDeleted).length===0,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black disabled:opacity-50",children:[r.jsx(te,{className:"w-4 h-4"}),"Save & Next"]})]})]})}),r.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:r.jsxs("div",{className:"space-y-4 mr-4",children:[w().map(e=>{const t=e.id;if(!t)return null;const s=k(t),o=J[t]||[],a=ie[t]||"",i=xe[t]||!1;return r.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Product Category: ",e.name]})}),r.jsxs("div",{className:"mb-4",children:[r.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Add Item Category"}),r.jsxs("div",{className:"relative autocomplete-container",children:[r.jsx("div",{className:"border border-gray-300 rounded-lg px-3 py-2",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.filter(n=>!n.isDeleted).map((n,l)=>r.jsx(ae,{tag:n,editable:i,onChange:d=>D(c=>({...c,[t]:(c[t]||[]).map((u,y)=>y===l?{...u,name:d}:u)})),onRemove:()=>de(t,n,l)},`${n.id??"new"}-${l}`)),r.jsx("input",{value:a,onChange:n=>{G(l=>({...l,[t]:R(n.target.value)})),Y(l=>({...l,[t]:n.target.value.length>0}))},onFocus:()=>{a.length>0&&Y(n=>({...n,[t]:!0}))},onKeyDown:n=>{var l;if((n.key==="Enter"||n.key===",")&&(n.preventDefault(),Me(t),Y(d=>({...d,[t]:!1}))),n.key==="Backspace"&&a===""&&o.length>0){const d=(l=o.map((c,u)=>({t:c,i:u})).filter(({t:c})=>!c.isDeleted).slice(-1)[0])==null?void 0:l.i;d!==void 0&&de(t,o[d],d)}n.key==="Escape"&&Y(d=>({...d,[t]:!1}))},placeholder:"Item category name (Press Enter to add)",className:"flex-1 min-w-[220px] outline-none"})]})}),ke[t]&&a.length>0&&r.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[s.filter(n=>{const l=a.toLowerCase();return n.name.toLowerCase().includes(l)&&!o.some(d=>d.id===n.id&&!d.isDeleted)}).slice(0,10).map(n=>r.jsx("div",{onClick:()=>{Re(n,t),G(l=>({...l,[t]:""})),Y(l=>({...l,[t]:!1}))},className:"px-3 py-2 text-sm hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:r.jsx("div",{className:"font-medium",children:n.name})},n.id)),s.filter(n=>{const l=a.toLowerCase();return n.name.toLowerCase().includes(l)&&!o.some(d=>d.id===n.id&&!d.isDeleted)}).length===0&&r.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No matching categories found"})]})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{type:"button",onClick:()=>i?Be(t):ze(t),className:"px-4 py-2 rounded-lg border border-gray-300 text-sm hover:bg-gray-50",children:i?"Cancel":"Edit"})})]},t)}),w().length===0&&r.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:r.jsx("div",{className:"text-sm text-gray-500",children:"Select Product Categories in Step 1 first."})}),r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsxs("button",{type:"button",onClick:$e,disabled:w().length===0,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black disabled:opacity-50",children:[r.jsx(te,{className:"w-4 h-4"}),"Save All and Next"]})})]})}),r.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:r.jsxs("div",{className:"space-y-4",children:[w().map(e=>{const t=e.id;return t?k(t).map(o=>{const a=N(t,o.id),i=W[a]||[],n=ne[a]||"",l=Se[a]||!1,d=ue(o.id);return r.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"text-sm font-medium text-gray-700 mb-1",children:["Item Category: ",o.name]}),r.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Product Category: ",e.name]})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Add Sub-Category"}),r.jsxs("div",{className:"relative autocomplete-container",children:[r.jsx("div",{className:"border border-gray-300 rounded-lg px-3 py-2",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.filter(c=>!c.isDeleted).map((c,u)=>r.jsx(ae,{tag:c,editable:l,onChange:y=>P(L=>({...L,[a]:(L[a]||[]).map((_,qe)=>qe===u?{..._,name:y}:_)})),onRemove:()=>fe(t,o.id,c,u)},`${c.id??"new"}-${u}`)),r.jsx("input",{value:n,onChange:c=>{Q(u=>({...u,[a]:R(c.target.value)})),$(u=>({...u,[a]:c.target.value.length>0}))},onFocus:()=>{n.length>0&&$(c=>({...c,[a]:!0}))},onKeyDown:c=>{var u;if((c.key==="Enter"||c.key===",")&&(c.preventDefault(),Je(t,o.id),$(y=>({...y,[a]:!1}))),c.key==="Backspace"&&n===""&&i.length>0){const y=(u=i.map((L,_)=>({t:L,i:_})).filter(({t:L})=>!L.isDeleted).slice(-1)[0])==null?void 0:u.i;y!==void 0&&fe(t,o.id,i[y],y)}c.key==="Escape"&&$(y=>({...y,[a]:!1}))},placeholder:"Sub-category name (Press Enter to add)",className:"flex-1 min-w-[220px] outline-none"})]})}),Ee[a]&&n.length>0&&r.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[d.filter(c=>{const u=n.toLowerCase();return c.name.toLowerCase().includes(u)&&!i.some(y=>y.id===c.id&&!y.isDeleted)}).slice(0,10).map(c=>r.jsx("div",{onClick:()=>{We(c,t,o.id),Q(u=>({...u,[a]:""})),$(u=>({...u,[a]:!1}))},className:"px-3 py-2 text-sm hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:r.jsx("div",{className:"font-medium",children:c.name})},c.id)),d.filter(c=>{const u=n.toLowerCase();return c.name.toLowerCase().includes(u)&&!i.some(y=>y.id===c.id&&!y.isDeleted)}).length===0&&r.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"No matching categories found"})]})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{type:"button",onClick:()=>l?_e(t,o.id):Ke(t,o.id),className:"px-4 py-2 rounded-lg border border-gray-300 text-sm hover:bg-gray-50",children:l?"Cancel":"Edit"})})]},a)}):null}),(()=>{const e=w(),t=e.some(s=>s.id&&k(s.id).length>0);return e.length===0?r.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:r.jsx("div",{className:"text-sm text-gray-500",children:"Select Product Categories in Step 1 first."})}):t?r.jsx("div",{className:"mt-4 flex justify-end",children:r.jsxs("button",{type:"button",onClick:Ze,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black",children:[r.jsx(te,{className:"w-4 h-4"}),"Save All and Next"]})}):r.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:r.jsx("div",{className:"text-sm text-gray-500",children:"Save item categories in Step 2 first."})})})()]})})]})})]})}export{dt as default};
