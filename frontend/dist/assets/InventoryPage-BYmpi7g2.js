import{j as e,u as Rt,r as l}from"./index-C4O2RVGC.js";import{i as se}from"./inventoryService-Cfeh1TyB.js";import{l as Le}from"./libraryService-BC59J_DM.js";import{s as Jt}from"./skuService-CD47JNeC.js";import{f as z,a as ae,b as ge,g as ve}from"./formatters-ptPrPoGe.js";import{e as es,a as ts}from"./reportExporter-Cvu8XiLW.js";import{C as ss}from"./calendar-CfIpioxc.js";import{C as ie}from"./chevron-down-CuFOjVxo.js";import{D as lt}from"./download-BnsO4lfA.js";import{S as Ft}from"./search-Cs94nLwN.js";import{C as it}from"./chevron-up-TgpC2_zN.js";import{E as ct}from"./eye-C7eBhAd0.js";import{T as as}from"./trash-2-BS2IYTwN.js";import{H as ns}from"./history-CYtwhdaJ.js";import{E as _t}from"./jspdf.es.min-C18Sz01g.js";import{S as rs}from"./save-jeta1nOA.js";import{X as dt}from"./x-ChutkFoY.js";import{o as os}from"./categoriesEvents-i2FsXa12.js";import{o as ls}from"./inventoryEvents-fOALNsvn.js";import{A as et,a as tt}from"./arrow-up-6VcWNP--.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";const xt=({datePreset:t,customDateFrom:o,customDateTo:V,showCustomDatePicker:T,onDatePresetChange:A,onCustomDateFromChange:U,onCustomDateToChange:Q,onClear:c})=>{const k=x=>{A(x),x==="custom"||c()};return e.jsx("div",{className:"border-t border-slate-100 pt-3",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ss,{className:"w-[15px] h-[15px] text-slate-500"}),e.jsx("span",{className:"text-[14.625px] font-medium leading-[1.4] text-slate-700",children:"Filter by Date:"})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:t,onChange:x=>k(x.target.value),className:"appearance-none bg-white border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full min-w-[135px]",children:[e.jsx("option",{value:"",children:"All Dates"}),e.jsx("option",{value:"1month",children:"1 Month"}),e.jsx("option",{value:"3months",children:"3 Months"}),e.jsx("option",{value:"6months",children:"6 Months"}),e.jsx("option",{value:"1year",children:"1 Year"}),e.jsx("option",{value:"thisFinancialYear",children:"This Financial Year"}),e.jsx("option",{value:"previousFinancialYear",children:"Previous Financial Year"}),e.jsx("option",{value:"custom",children:"Custom Date Range"})]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),T&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"date",value:o,onChange:x=>U(x.target.value),className:"bg-slate-50 border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-800 px-[15px] py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all",placeholder:"From Date"}),e.jsx("span",{className:"text-[14.625px] font-medium text-slate-500",children:"to"}),e.jsx("input",{type:"date",value:V,onChange:x=>Q(x.target.value),className:"bg-slate-50 border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-800 px-[15px] py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all",placeholder:"To Date"}),e.jsx("button",{onClick:c,className:"text-[14.625px] font-black text-indigo-600 uppercase tracking-[0.1em] hover:text-indigo-700 hover:underline px-3 py-[6px] transition-all whitespace-nowrap",children:"Clear"})]})]})})},is=({search:t,productCategory:o,itemCategory:V,subCategory:T,brand:A,stockStatus:U,datePreset:Q,customDateFrom:c,customDateTo:k,showCustomDatePicker:x,productCategories:m,itemCategories:S,subCategories:K,brands:Z,onSearchChange:v,onProductCategoryChange:u,onItemCategoryChange:F,onSubCategoryChange:f,onBrandChange:p,onStockStatusChange:D,onDatePresetChange:a,onCustomDateFromChange:d,onCustomDateToChange:$,onClearDateFilter:I,showExportDropdown:L=!1,onExportDropdownToggle:w,onExportPDF:R,onExportExcel:P,onExportCSV:r,exportDropdownRef:W,loading:q=!1})=>e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-sm p-[18px] space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap lg:flex-nowrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[210px] relative group",children:e.jsx("input",{type:"text",placeholder:"SEARCH SKU ID, ITEM NAME, MODEL NUMBER, HSN CODE, VENDOR, BRAND...",value:t,onChange:g=>v(g.target.value),className:"w-full bg-slate-50 border border-slate-100 text-[11.7px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[11.7px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 pl-3 pr-3 py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})}),e.jsxs("div",{className:"w-full sm:w-auto lg:w-36 relative group",children:[e.jsxs("select",{value:o,onChange:g=>u(g.target.value),className:"appearance-none bg-white border border-slate-200 text-[11.7px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full disabled:bg-slate-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"All Product Categories"}),m.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"w-full sm:w-auto lg:w-36 relative group",children:[e.jsxs("select",{value:V,onChange:g=>F(g.target.value),disabled:!o,className:"appearance-none bg-white border border-slate-200 text-[11.7px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full disabled:bg-slate-100 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:"All Item Categories"}),S.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"w-full sm:w-auto lg:w-30 relative group",children:[e.jsxs("select",{value:A,onChange:g=>p(g.target.value),className:"appearance-none bg-white border border-slate-200 text-[11.7px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full",children:[e.jsx("option",{value:"",children:"All Brands"}),Z.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"w-full sm:w-auto lg:w-30 relative group",children:[e.jsxs("select",{value:U,onChange:g=>D(g.target.value),className:"appearance-none bg-white border border-slate-200 text-[11.7px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full",children:[e.jsx("option",{value:"all",children:"All Stock Status"}),e.jsx("option",{value:"out_of_stock",children:"Out of Stock"}),e.jsx("option",{value:"low_stock",children:"Low Stock"}),e.jsx("option",{value:"in_stock",children:"In Stock"})]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),w&&e.jsxs("div",{className:"relative w-full sm:w-auto",ref:W,children:[e.jsxs("button",{onClick:w,className:"w-full sm:w-auto px-[18px] py-[9px] bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 flex items-center justify-center gap-[6px] text-[11.7px] font-medium whitespace-nowrap transition-all shadow-sm hover:shadow-md",children:[e.jsx(lt,{className:"w-3 h-3"}),"Export",e.jsx(ie,{className:`w-3 h-3 transition-transform ${L?"rotate-180":""}`})]}),L&&e.jsxs("div",{className:"absolute right-0 mt-[3px] w-[120px] bg-white border border-slate-200 rounded-xl shadow-lg z-50 overflow-hidden",children:[e.jsx("button",{onClick:R,disabled:q,className:"w-full px-3 py-[9px] text-left text-[11.7px] font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-50 transition-colors",children:"PDF"}),e.jsx("button",{onClick:P,disabled:q,className:"w-full px-3 py-[9px] text-left text-[11.7px] font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-50 transition-colors",children:"XLSX"}),e.jsx("button",{onClick:r,disabled:q,className:"w-full px-3 py-[9px] text-left text-[11.7px] font-medium text-slate-700 hover:bg-slate-50 disabled:opacity-50 transition-colors",children:"CSV"})]})]})]}),e.jsx(xt,{datePreset:Q,customDateFrom:c,customDateTo:k,showCustomDatePicker:x,onDatePresetChange:a,onCustomDateFromChange:d,onCustomDateToChange:$,onClear:I})]}),cs=({search:t,vendor:o,status:V,datePreset:T,customDateFrom:A,customDateTo:U,showCustomDatePicker:Q,vendors:c,onSearchChange:k,onVendorChange:x,onStatusChange:m,onDatePresetChange:S,onCustomDateFromChange:K,onCustomDateToChange:Z,onClearDateFilter:v})=>e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-sm p-[18px] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[210px] relative group",children:[e.jsx(Ft,{size:15,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"SEARCH INVOICE, ITEM, SKU...",value:t,onChange:u=>k(u.target.value),className:"w-full bg-slate-50 border border-slate-100 text-[14.625px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[14.625px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 pl-9 pr-3 py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:o,onChange:u=>x(u.target.value),className:"appearance-none bg-white border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full min-w-[135px]",children:[e.jsx("option",{value:"",children:"All Vendors"}),c.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:V,onChange:u=>m(u.target.value),className:"appearance-none bg-white border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full min-w-[135px]",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]})]}),e.jsx(xt,{datePreset:T,customDateFrom:A,customDateTo:U,showCustomDatePicker:Q,onDatePresetChange:S,onCustomDateFromChange:K,onCustomDateToChange:Z,onClear:v})]}),ds=({destination:t,status:o,datePreset:V,customDateFrom:T,customDateTo:A,showCustomDatePicker:U,customers:Q,vendors:c,onDestinationChange:k,onStatusChange:x,onDatePresetChange:m,onCustomDateFromChange:S,onCustomDateToChange:K,onClearDateFilter:Z})=>e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-sm p-[18px] space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[210px] relative group",children:e.jsx("input",{type:"text",value:t,onChange:v=>k(v.target.value),placeholder:"SEARCH CUSTOMER/VENDOR",className:"w-full bg-slate-50 border border-slate-100 text-[14.625px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[14.625px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 pl-3 pr-3 py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:o,onChange:v=>x(v.target.value),className:"appearance-none bg-white border border-slate-200 text-[14.625px] font-medium leading-[1.4] text-slate-700 px-[15px] py-[9px] pr-9 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all cursor-pointer hover:bg-slate-50 w-full min-w-[135px]",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsx(ie,{size:14,className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none group-focus-within:text-indigo-500 transition-colors"})]})]}),e.jsx(xt,{datePreset:V,customDateFrom:T,customDateTo:A,showCustomDatePicker:U,onDatePresetChange:m,onCustomDateFromChange:S,onCustomDateToChange:K,onClear:Z})]}),xs=({item:t,isExpanded:o,onToggle:V,onDelete:T})=>{const A=Rt(),U=(Q,c)=>{const k=t.minStockLevel??c;return Q===0?"text-red-600 font-semibold":Q<=k?"text-yellow-600 font-semibold":"text-green-600 font-semibold"};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"group hover:bg-slate-50/40 transition-all min-h-[56px]",children:[e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("button",{onClick:V,className:"text-slate-400 hover:text-indigo-600 transition-colors",children:o?e.jsx(it,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"inline-block text-[11.7px] font-normal leading-[1.4] text-indigo-600 bg-indigo-50/50 px-3 py-[6px] rounded-xl border border-indigo-100/50",children:t.skuId})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.productCategory})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.itemCategory})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.subCategory||"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[12.6px] font-semibold leading-[1.4] text-slate-900 block group-hover:text-indigo-600 transition-colors",children:t.itemName})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-semibold leading-[1.4] tracking-[0.05em] uppercase text-slate-700",children:t.brand})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.vendor})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"inline-block text-[11.7px] font-normal leading-[1.4] text-slate-500 bg-slate-100/50 px-[9px] py-[3px] rounded-lg",children:t.model||"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.hsnSacCode||"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:`text-[13.5px] font-semibold leading-[1.3] ${U(t.currentStock,t.minStockLevel??t.minStock)}`,children:z(t.currentStock)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>A(`/app/sku/${t.id}`),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"View",children:e.jsx(ct,{className:"w-4 h-4"})}),T&&e.jsx("button",{onClick:T,className:"p-2 text-rose-600 hover:bg-rose-50 rounded-lg transition-colors",title:"Delete",children:e.jsx(as,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(`/app/inventory/${t.id}/history`),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"History",children:e.jsx(ns,{className:"w-4 h-4"})})]})})]}),o&&e.jsx("tr",{className:"bg-slate-50/30",children:e.jsx("td",{colSpan:12,className:"px-[30px] py-[18px]",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Item Details:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.itemDetails||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Vendor Item Code:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.vendorItemCode||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Rating/Size:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.ratingSize||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Model:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.model||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Series:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.series||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"HSN/SAC Code:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.hsnSacCode||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Unit:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.unit})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Minimum Stock Level:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.minStock||"-"})]}),(t.material||t.color||t.weight)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Material:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.material||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Color:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.color||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Weight:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.weight?`${t.weight} Kg`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Dimensions:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.length&&t.width&&t.height?`${t.length} × ${t.width} × ${t.height} cm`:"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Last Updated:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:ae(t.lastUpdated)})]})]})})})]})},ms=({inventory:t,loading:o,expandedRows:V,onToggleRow:T,onDeleteItem:A,sortBy:U,sortOrder:Q,onSort:c,SortIcon:k})=>e.jsx("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-center mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/70 border-b border-slate-100",children:[e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center w-[30px]"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"SKU ID"}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("productCategory"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Product Category",k&&e.jsx(k,{field:"productCategory"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("itemCategory"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Item Category",k&&e.jsx(k,{field:"itemCategory"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("subCategory"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Sub Category",k&&e.jsx(k,{field:"subCategory"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("itemName"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Item Name",k&&e.jsx(k,{field:"itemName"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("brand"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Brand",k&&e.jsx(k,{field:"brand"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("vendor"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Vendor",k&&e.jsx(k,{field:"vendor"})]})}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Model Number"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"HSN Code"}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${c?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>c&&c("currentStock"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Current Stock",k&&e.jsx(k,{field:"currentStock"})]})}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"px-10 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"px-10 py-12 text-center text-slate-500 font-medium",children:"No inventory items found"})}):t.map(x=>e.jsx(xs,{item:x,isExpanded:V.has(x.id),onToggle:()=>T(x.id),onDelete:A?()=>A(x.id):void 0},x.id))})]})})}),ps=({record:t,items:o,onItemsUpdate:V})=>{const[T,A]=l.useState({}),[U,Q]=l.useState({}),[c,k]=l.useState({}),[x,m]=l.useState({}),[S,K]=l.useState(!1),Z=async(v,u)=>{var $,I,L,w,R;if(u<=0){alert("Please enter a quantity greater than 0");return}const F=v.itemId||v.item_id||v.id;if(!F){alert("Item ID not found");return}const f=`${t.id}-${F}`,p=(($=c[f])==null?void 0:$.trim())||"";if(!p){alert("Reason is required (max 30 characters)");return}if(p.length>30){alert("Reason must be maximum 30 characters");return}const D=v.received||0,a=v.rejected||0,d=a+u;if(d>D){const P=D-a;alert(`Cannot move ${u}. Total rejected (${a} + ${u} = ${d}) would exceed received quantity (${D}). Maximum you can move is ${P}.`);return}if(confirm(`Move ${u} from received to rejected (defective items)? This will reduce stock by ${u}.`))try{K(!0);const P=U[f]||new Date().toISOString().split("T")[0],r=await se.moveReceivedToRejected(t.id,F,u,P,p);r!=null&&r.warning&&(console.warn("[IncomingRecordItems] Backend warning:",r.warning),alert(`Warning: ${r.warning}`)),(r==null?void 0:r.reportCreated)===!1&&(console.error("[IncomingRecordItems] Report creation failed"),alert("Items moved to rejected, but report creation failed. Please check the rejected items page manually.")),await se.getIncomingItems(t.id),V(),A(W=>{const q={...W};return delete q[f],q}),Q(W=>{const q={...W};return delete q[f],q}),k(W=>{const q={...W};return delete q[f],q}),m(W=>({...W,[`${t.id}-${F}`]:!0})),alert(`Successfully moved ${u} to rejected. Stock reduced by ${u}.`)}catch(P){console.error("Error moving to rejected:",P),alert(((L=(I=P.response)==null?void 0:I.data)==null?void 0:L.error)||((R=(w=P.response)==null?void 0:w.data)==null?void 0:R.message)||"Failed to move to rejected")}finally{K(!1)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Item Details with Invoice Information"}),o&&o.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Rejected Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Short Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Received Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Invoice Number"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:o.map(v=>{var d;const u=v.itemId||v.item_id||v.id||0,F=v.itemName||v.item_name||"-",f=v.skuCode||v.sku_code||v.skuId||v.sku_id||"-",p=v.received||0,D=v.short||0,a=v.rejected||0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-3 text-gray-900 border-r border-gray-200",children:F}),e.jsx("td",{className:"px-3 py-3 text-gray-700 font-mono text-xs border-r border-gray-200",children:f}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-red-700 font-semibold",children:["Rejected Quantity: ",z(a)]}),p>0&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"1",max:p-a,value:T[`${t.id}-${u}`]||"",onChange:$=>{const I=parseInt($.target.value)||0,L=p-a;I>=0&&I<=L&&A(w=>({...w,[`${t.id}-${u}`]:I}))},onBlur:$=>{const I=parseInt($.target.value)||0,L=p-a;I>L?A(w=>({...w,[`${t.id}-${u}`]:L})):I<0&&A(w=>({...w,[`${t.id}-${u}`]:0}))},placeholder:"Qty",className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",title:`Max: ${p-a} (Received: ${p} - Already Rejected: ${a})`}),e.jsx("input",{type:"date",value:U[`${t.id}-${u}`]||new Date().toISOString().split("T")[0],onChange:$=>{Q(I=>({...I,[`${t.id}-${u}`]:$.target.value}))},className:"w-32 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",title:"Inspection Date"}),e.jsx("input",{type:"text",maxLength:30,value:c[`${t.id}-${u}`]||"",onChange:$=>{const I=$.target.value.substring(0,30);k(L=>({...L,[`${t.id}-${u}`]:I}))},placeholder:"Reason (required, max 30)",className:"w-40 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",title:"Reason for rejection (required, max 30 characters)",required:!0}),e.jsx("button",{onClick:()=>Z(v,T[`${t.id}-${u}`]||0),disabled:S||!T[`${t.id}-${u}`]||!((d=c[`${t.id}-${u}`])!=null&&d.trim()),className:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50",title:"Move Received to Rejected",children:"Move to Rejected"})]})]}),x[`${t.id}-${u}`]&&a>0&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"Rejected Items Details:"}),e.jsx("div",{className:"space-y-1 text-red-700",children:e.jsxs("div",{children:["Quantity: ",z(a)]})})]})]})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("span",{className:"text-orange-700 font-semibold",children:["Short Quantity: ",z(D)]})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200 bg-gray-50",children:e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"text-green-700 font-semibold",children:["Received Quantity: ",z(p)]})})})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t.invoiceNumber})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-700",children:ae(t.invoiceDate)})]})})]},u)})})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-blue-500 rounded"}),e.jsx("span",{children:"Invoice and Date are linked to the rejected/short quantities above"})]})]}):e.jsx("div",{className:"text-center text-gray-500 text-sm py-4",children:"Loading items..."})]})},us=({record:t,item:o,itemKey:V,isExpanded:T,onToggle:A,onEditRejectedShort:U,onItemsUpdate:Q})=>{Rt();const[c,k]=l.useState(!1),[x,m]=l.useState(o.rejected||0),[S,K]=l.useState(o.short||0),[Z,v]=l.useState(!1),[u,F]=l.useState(!1),f=l.useRef(null),p=o.itemName||o.item_name||"N/A",D=o.skuCode||o.sku_code||o.skuId||o.sku_id||"-",a=o.received||0,d=o.rejected||0,$=o.short||0,I=o.totalQuantity||o.total_quantity||0,L=I-a,w=Math.max(0,L-$),R=c?(()=>{const g=I-a,H=Math.max(0,g-S);return x>0?a-x+H:a+H})():d>0?a-d+w:a+w;l.useEffect(()=>{c||(m(d),K($))},[d,$,c]);const P=()=>{T||A()},r=()=>{m(d),K($),k(!1)},W=async()=>{var g,H,y,oe;try{F(!0);const M=await se.getIncomingById(t.id);if(!M.success||!M.data){alert("Failed to fetch invoice data");return}const E=M.data;let re=E.items||[];re.length===0&&(re=(await se.getIncomingItems(t.id)).data||[]);const i=new _t({orientation:"portrait",unit:"mm",format:"a4"}),ce=210,be=297,X=15,we=ce-X*2;let C=X;const de=Y=>C+Y>be-X?(i.addPage(),C=X,!0):!1,pe=(Y,fe,ye,De,Ee=10,Ie="normal",Ne="left")=>{i.setFontSize(Ee),i.setFont("helvetica",Ie);const Ae=i.splitTextToSize(Y,De);return i.text(Ae,fe,ye,{align:Ne}),Ae.length*(Ee*.35)};i.setFontSize(24),i.setFont("helvetica","bold"),i.text("INVOICE",ce/2,C,{align:"center"}),C+=12,i.setFontSize(10),i.setFont("helvetica","normal");const te=E.invoiceNumber||E.invoice_number||t.invoiceNumber||`INV-${t.id}`,xe=ae(E.invoiceDate||E.invoice_date||t.invoiceDate),ue=ae(E.receivingDate||E.receiving_date||t.receivingDate),Ce=E.vendorName||E.vendor_name||t.vendorName,ee=E.brandName||E.brand_name||t.brandName,Me=E.receivedByName||E.received_by_name||t.receivedByName||"N/A",Fe=E.docketNumber||E.docket_number,_e=E.transportorName||E.transportor_name,me=X,O=X+we/2+5;let B=C,he=C;i.setFont("helvetica","normal"),i.setFontSize(10),i.text(`Invoice Number: ${te}`,me,B),B+=6,i.text(`Invoice Date: ${xe}`,me,B),B+=6,i.text(`Receiving Date: ${ue}`,me,B),B+=6,i.text(`Vendor: ${Ce}`,me,B),B+=6,i.text(`Brand: ${ee}`,me,B),B+=6,i.text(`Received By: ${Me}`,me,B),B+=6,Fe&&(i.text(`Docket Number: ${Fe}`,O,he),he+=6),_e&&(i.text(`Transporter: ${_e}`,O,he),he+=6),C=Math.max(B,he)+8,de(20),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("ITEMS",X,C),C+=8,i.setFontSize(9),i.setFont("helvetica","bold");const le=[12,60,18,18,18,18,28],Te=["S.No","Item Name / SKU","Total Qty","Received","Short","Rejected","Total Value"];let G=X;Te.forEach((Y,fe)=>{i.text(Y,G,C),G+=le[fe]}),C+=5,i.setLineWidth(.5),i.line(X,C-2,ce-X,C-2),C+=4,i.setFontSize(9),i.setFont("helvetica","normal"),re.forEach((Y,fe)=>{de(12);const ye=Y.item_name||Y.itemName||"N/A",De=Y.sku_code||Y.skuCode||Y.sku_id||"N/A",Ee=Y.total_quantity||Y.totalQuantity||0,Ie=Y.received||0,Ne=Y.short||0,Ae=Y.rejected||0,Pe=parseFloat(Y.total_value||Y.totalValue||0)||0;G=X,i.text(String(fe+1),G,C),G+=le[0];const Be=i.splitTextToSize(ye,le[1]-2);i.text(Be,G,C),i.setFontSize(8),i.setFont("helvetica","italic"),i.text(`SKU: ${De}`,G,C+Be.length*4+2),i.setFontSize(9),i.setFont("helvetica","normal"),G+=le[1],i.text(String(Ee),G,C),G+=le[2],i.text(String(Ie),G,C),G+=le[3],i.text(String(Ne),G,C),G+=le[4],i.text(String(Ae),G,C),G+=le[5],i.setFont("helvetica","bold"),i.setFontSize(10);const Re=`₹${Pe.toFixed(2)}`;i.text(Re,G,C),i.setFont("helvetica","normal"),i.setFontSize(9),C+=Math.max(8,Be.length*4+4)}),C+=8,de(35),i.setFontSize(12),i.setFont("helvetica","bold"),i.text("SUMMARY",X,C),C+=10,i.setFontSize(10),i.setFont("helvetica","normal");const ze=E.totalQuantity||E.total_quantity||t.totalQuantity||0,ke=E.received||t.received||0,$e=E.short||t.short||0,Oe=E.rejected||t.rejected||0,Se=parseFloat(E.totalValue||E.total_value||t.totalValue||0)||0;i.text(`Total Quantity: ${ze}`,X,C),C+=7,i.text(`Total Received: ${ke}`,X,C),C+=7,i.text(`Total Short: ${$e}`,X,C),C+=7,i.text(`Total Rejected: ${Oe}`,X,C),C+=7,i.setFont("helvetica","bold"),i.setFontSize(11),i.text(`Total Value: ₹${Se.toFixed(2)}`,X,C),C+=10,i.setFont("helvetica","normal"),i.setFontSize(8),i.setTextColor(128,128,128),i.text(`Generated on: ${new Date().toLocaleString()}`,X,be-10),i.setTextColor(0,0,0);const He=te.replace(/[^a-zA-Z0-9]/g,"_");i.save(`Invoice_${He}_${new Date().toISOString().split("T")[0]}.pdf`)}catch(M){console.error("Error downloading invoice:",M),alert(((H=(g=M.response)==null?void 0:g.data)==null?void 0:H.error)||((oe=(y=M.response)==null?void 0:y.data)==null?void 0:oe.message)||"Failed to download invoice")}finally{F(!1)}},q=async()=>{var g,H,y,oe;try{if(v(!0),x>a){alert(`Rejected quantity cannot exceed received quantity (${a})`),v(!1);return}const M=I-a,E=Math.max(0,M-S),re=x>0?a-x+E:a+E;if(re<0){alert(`Invalid quantities: Available (${re}) cannot be negative. Received: ${a}, Rejected: ${x}, Arrived Short: ${E}`),v(!1);return}const i=o.itemId||o.item_id||o.id;if(!i){alert("Item ID not found"),v(!1);return}await se.updateRejectedShort(t.id,{itemId:i,rejected:x,short:S}),k(!1),await Q(t.id),alert("Quantities updated successfully")}catch(M){console.error("Error updating quantities:",M),alert(((H=(g=M.response)==null?void 0:g.data)==null?void 0:H.error)||((oe=(y=M.response)==null?void 0:y.data)==null?void 0:oe.message)||"Failed to update quantities")}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"group hover:bg-slate-50/40 transition-all min-h-[56px]",children:[e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("button",{onClick:A,className:"text-slate-400 hover:text-indigo-600 transition-colors",children:T?e.jsx(it,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-medium leading-[1.4] text-slate-900",children:t.invoiceNumber})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:ae(t.invoiceDate)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:ae(t.receivingDate)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[12.6px] font-semibold leading-[1.4] text-slate-900 block group-hover:text-indigo-600 transition-colors max-w-xs truncate mx-auto",title:p,children:p})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"inline-block text-[11.7px] font-normal leading-[1.4] text-indigo-600 bg-indigo-50/50 px-3 py-[6px] rounded-xl border border-indigo-100/50",children:D})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.vendorName})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[13.5px] font-semibold leading-[1.3] text-slate-900",children:z(I)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:c?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[9px] font-medium text-emerald-700",children:"Accepted:"}),e.jsx("span",{className:"text-[11.7px] font-semibold text-emerald-700",children:z(R)})]}),e.jsx("span",{className:"text-slate-400",children:"|"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[9px] font-medium text-rose-700",children:"Rejected:"}),e.jsx("input",{type:"number",min:"0",max:Math.min(a,I-S),value:x,onChange:g=>{const H=parseInt(g.target.value)||0,y=a;H>=0&&H<=y&&m(H)},onBlur:g=>{const H=parseInt(g.target.value)||0,y=a;H>y?m(y):H<0&&m(0)},className:"w-20 px-2 py-1 text-[11.7px] border border-rose-300 rounded-lg text-rose-700 font-semibold focus:ring-2 focus:ring-rose-500 mx-auto",title:`Max: ${a} (Received: ${a})`})]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 relative",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-[13.5px] font-semibold leading-[1.3] text-emerald-700",children:z(R)})}),e.jsx("span",{className:"text-slate-400",children:"|"}),e.jsx("div",{className:"flex items-center gap-1 relative",ref:f,children:e.jsx("button",{onClick:P,className:"text-[13.5px] font-semibold leading-[1.3] text-rose-700 hover:text-rose-800 hover:bg-rose-50 px-2 py-1 rounded-lg transition-colors cursor-pointer",title:"View Item Details",children:z(d)})})]})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:c?e.jsx("input",{type:"number",min:"0",max:I-x,value:S,onChange:g=>{const H=parseInt(g.target.value)||0;H>=0&&K(H)},onBlur:g=>{(parseInt(g.target.value)||0)<0&&K(0)},className:"w-20 px-2 py-1 text-[11.7px] border border-yellow-300 rounded-lg text-yellow-700 font-semibold focus:ring-2 focus:ring-yellow-500 mx-auto",title:"Short quantity (items not yet received). When items arrive, reduce short to update stock."}):e.jsx("span",{className:"text-[13.5px] font-semibold leading-[1.3] text-yellow-700",children:z($)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:c?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:q,disabled:Z,className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors disabled:opacity-50",title:"Save",children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:r,disabled:Z,className:"p-2 text-rose-600 hover:bg-rose-50 rounded-lg transition-colors disabled:opacity-50",title:"Cancel",children:e.jsx(dt,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>U(t,o),className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"Edit Item",children:e.jsx(ct,{className:"w-4 h-4"})}),e.jsx("button",{onClick:W,disabled:u,className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors disabled:opacity-50",title:"Download Invoice",children:e.jsx(lt,{className:"w-4 h-4"})})]})})]}),T&&e.jsx("tr",{className:"bg-slate-50/30",children:e.jsx("td",{colSpan:11,className:"px-[30px] py-[18px]",children:e.jsx(ps,{record:t,items:[o],onItemsUpdate:Q})})})]})},gs=({records:t,loading:o,expandedRows:V,recordItems:T,onToggleRow:A,onEditRejectedShort:U,onItemsUpdate:Q,sortBy:c,sortOrder:k,onSort:x,SortIcon:m,search:S})=>{const[K,Z]=l.useState(""),v=S!==void 0?S:K,u=l.useMemo(()=>{const F=[];if(t.forEach(f=>{const p=T[f.id]||[];p.length>0?p.forEach(D=>{const a=D.itemId||D.item_id||D.id||0;F.push({record:f,item:D,itemKey:`${f.id}-${a}`})}):F.push({record:f,item:{id:0,itemName:"Loading...",received:f.received||0,short:f.short||0,rejected:f.rejected||0,totalQuantity:f.totalQuantity||0},itemKey:`${f.id}-0`})}),c&&k&&F.length>0&&F.sort((f,p)=>{let D,a;switch(c){case"invoiceDate":D=new Date(f.record.invoiceDate||f.record.invoice_date||0).getTime(),a=new Date(p.record.invoiceDate||p.record.invoice_date||0).getTime();break;case"receivingDate":D=new Date(f.record.receivingDate||f.record.receiving_date||0).getTime(),a=new Date(p.record.receivingDate||p.record.receiving_date||0).getTime();break;case"itemName":D=(f.item.itemName||f.item.item_name||"").toLowerCase(),a=(p.item.itemName||p.item.item_name||"").toLowerCase();break;case"vendor":D=(f.record.vendorName||f.record.vendor_name||"").toLowerCase(),a=(p.record.vendorName||p.record.vendor_name||"").toLowerCase();break;case"totalQuantity":D=f.item.totalQuantity||f.item.total_quantity||0,a=p.item.totalQuantity||p.item.total_quantity||0;break;case"available":const d=f.item.received||0,$=f.item.rejected||0,L=(f.item.totalQuantity||f.item.total_quantity||0)-d,w=Math.max(0,L-(f.item.short||0));D=$>0?d-$+w:d+w;const R=p.item.received||0,P=p.item.rejected||0,W=(p.item.totalQuantity||p.item.total_quantity||0)-R,q=Math.max(0,W-(p.item.short||0));a=P>0?R-P+q:R+q;break;case"rejected":D=f.item.rejected||0,a=p.item.rejected||0;break;case"short":D=f.item.short||0,a=p.item.short||0;break;default:return 0}return typeof D=="string"&&typeof a=="string"?k==="asc"?D.localeCompare(a):a.localeCompare(D):k==="asc"?D-a:a-D}),v.trim()){const f=v.toLowerCase().trim();return F.filter(p=>{var P,r;const D=(p.record.invoiceNumber||p.record.invoice_number||"").toLowerCase(),a=(p.record.invoiceDate||p.record.invoice_date||"").toLowerCase(),d=(p.record.receivingDate||p.record.receiving_date||"").toLowerCase(),$=(p.item.itemName||p.item.item_name||"").toLowerCase(),I=(((P=p.item.skuId)==null?void 0:P.toString())||((r=p.item.sku_id)==null?void 0:r.toString())||p.item.skuCode||p.item.sku_code||"").toLowerCase(),L=(p.record.vendorName||p.record.vendor_name||"").toLowerCase(),w=(p.record.brandName||p.record.brand_name||"").toLowerCase(),R=(p.item.challanNumber||p.item.challan_number||"").toLowerCase();return D.includes(f)||a.includes(f)||d.includes(f)||$.includes(f)||I.includes(f)||L.includes(f)||w.includes(f)||R.includes(f)})}return F},[t,T,c,k,v]);return e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-lg overflow-hidden",children:[S===void 0&&e.jsx("div",{className:"p-[18px] border-b border-slate-100",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ft,{size:15,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"SEARCH BY INVOICE NUMBER, ITEM NAME, SKU ID, VENDOR, BRAND...",value:K,onChange:F=>Z(F.target.value),className:"w-full bg-slate-50 border border-slate-100 text-[11.7px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[11.7px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 pl-9 pr-3 py-[9px] rounded-[1.125rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-center mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/70 border-b border-slate-100",children:[e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center w-9"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Invoice Number"}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("invoiceDate"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Invoice Date",m&&e.jsx(m,{field:"invoiceDate"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("receivingDate"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Receiving Date",m&&e.jsx(m,{field:"receivingDate"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("itemName"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Item Name",m&&e.jsx(m,{field:"itemName"})]})}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"SKU ID"}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("vendor"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Vendor",m&&e.jsx(m,{field:"vendor"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("totalQuantity"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Total Quantity",m&&e.jsx(m,{field:"totalQuantity"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("available"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Available | Rejected",m&&e.jsx(m,{field:"available"})]})}),e.jsx("th",{className:`px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center ${x?"cursor-pointer hover:bg-slate-100 select-none":""}`,onClick:()=>x&&x("short"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Short",m&&e.jsx(m,{field:"short"})]})}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-10 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})})})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-10 py-12 text-center text-slate-500 font-medium",children:"No incoming inventory records found"})}):u.map(F=>e.jsx(us,{record:F.record,item:F.item,itemKey:F.itemKey,isExpanded:V.has(F.itemKey),onToggle:()=>A(F.itemKey),onEditRejectedShort:U,onItemsUpdate:Q},F.itemKey))})]})})]})},hs=({record:t,item:o,itemKey:V,isExpanded:T,onToggle:A,onViewDetails:U,onDownloadInvoice:Q,downloading:c=!1})=>{const k=o.itemName||o.item_name||"N/A",x=o.skuCode||o.sku_code||String(o.skuId||o.sku_id||"-"),m=o.outgoingQuantity||o.outgoing_quantity||0,S=o.rejectedQuantity||o.rejected_quantity||0,K=o.unitPrice||o.unit_price||0,Z=o.totalValue||o.total_value||0,v=()=>{var F;let u="";return t.documentType==="sales_invoice"?(u="Sales Invoice",t.documentSubType==="to_customer"&&(u+=" - To Customer"),t.documentSubType==="to_vendor"&&(u+=" - To Vendor",t.vendorSubType==="replacement"&&(u+=" (Replacement)"),t.vendorSubType==="rejected"&&(u+=" (Rejected)"))):t.documentType==="delivery_challan"?(u="Delivery Challan",t.documentSubType==="sample"&&(u+=" - Sample"),t.documentSubType==="replacement"&&(u+=" - Replacement",t.deliveryChallanSubType==="to_customer"&&(u+=" (To Customer)"),t.deliveryChallanSubType==="to_vendor"&&(u+=" (To Vendor)"))):t.documentType==="transfer_note"?u="Transfer Note":u=((F=t.documentType)==null?void 0:F.replace(/_/g," "))||"-",u};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"group hover:bg-slate-50/40 transition-all min-h-[56px]",children:[e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("button",{onClick:A,className:"text-slate-400 hover:text-indigo-600 transition-colors",children:T?e.jsx(it,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-medium leading-[1.4] text-slate-900",children:t.invoiceChallanNumber||t.docketNumber||"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.invoiceChallanDate?ae(t.invoiceChallanDate):"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500 capitalize",children:v()})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[12.6px] font-semibold leading-[1.4] text-slate-900 block group-hover:text-indigo-600 transition-colors",children:k})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"inline-block text-[11.7px] font-normal leading-[1.4] text-indigo-600 bg-indigo-50/50 px-3 py-[6px] rounded-xl border border-indigo-100/50",children:x})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[11.7px] font-normal leading-[1.4] text-slate-500",children:t.destinationName||"-"})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[13.5px] font-semibold leading-[1.3] text-slate-900",children:z(m)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsx("span",{className:"text-[13.5px] font-semibold leading-[1.3] text-slate-900",children:ge(Z)})}),e.jsx("td",{className:"px-[30px] py-6 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:U,className:"p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors disabled:opacity-50",title:"View Details",disabled:!U,children:e.jsx(ct,{className:"w-4 h-4"})}),e.jsx("button",{onClick:Q,className:"p-2 text-emerald-600 hover:bg-emerald-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Download Invoice",disabled:!Q||c,children:e.jsx(lt,{className:`w-4 h-4 ${c?"animate-pulse":""}`})})]})})]}),T&&e.jsx("tr",{className:"bg-slate-50/30",children:e.jsx("td",{colSpan:10,className:"px-[30px] py-[18px]",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Docket Number:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.docketNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Transportor:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.transportorName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Dispatched By:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.dispatchedByName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Unit Price:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:ge(K)})]}),S>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Rejected Quantity:"}),e.jsx("p",{className:"text-[10.5px] text-rose-600 mt-1 font-semibold",children:z(S)})]}),t.remarks&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-wide",children:"Remarks:"}),e.jsx("p",{className:"text-[10.5px] text-slate-900 mt-1 font-medium",children:t.remarks})]})]})})})]})},fs=({records:t,loading:o,expandedRows:V,recordItems:T,onToggleRow:A})=>{var D;const[U,Q]=l.useState(!1),[c,k]=l.useState(null),[x,m]=l.useState([]),[S,K]=l.useState(!1),[Z,v]=l.useState(!1),u=async a=>{try{K(!0);const d=await se.getOutgoingById(a);d!=null&&d.success&&d.data?(k(d.data),m(d.data.items||[]),Q(!0)):d!=null&&d.data?(k(d.data),m(d.data.items||[]),Q(!0)):alert("Failed to load record details")}catch(d){console.error("Error loading record details:",d),alert("Failed to load record details")}finally{K(!1)}},F=(a,d,$,I)=>{let L=(a==null?void 0:a.replace(/_/g," "))||"";return d&&(L+=` - ${d.replace(/_/g," ")}`),$&&(L+=` - ${$.replace(/_/g," ")}`),I&&(L+=` - ${I.replace(/_/g," ")}`),L},f=async a=>{var d,$,I,L;try{v(!0);const w=await se.getOutgoingById(a);if((!(w!=null&&w.success)||!w.data)&&!(w!=null&&w.data)){alert("Failed to fetch invoice data");return}const R=w.data||(w==null?void 0:w.data),P=R.items||[];if(P.length===0){alert("No items found in this record");return}const r=new _t({orientation:"portrait",unit:"mm",format:"a4"}),W=210,q=297,g=15,H=W-g*2;let y=g;const oe=O=>y+O>q-g?(r.addPage(),y=g,!0):!1;r.setFontSize(24),r.setFont("helvetica","bold");const M=F(R.documentType||"",R.documentSubType,R.vendorSubType,R.deliveryChallanSubType);r.text(M.toUpperCase(),W/2,y,{align:"center"}),y+=12,r.setFontSize(10),r.setFont("helvetica","normal");const E=R.invoiceChallanNumber||R.invoice_challan_number||`DOC-${R.id}`,re=ae(R.invoiceChallanDate||R.invoice_challan_date),i=R.docketNumber||R.docket_number||"",ce=R.transportorName||R.transportor_name||"",be=R.destinationName||R.destination_name||"N/A",X=R.destinationType||R.destination_type||"",we=R.dispatchedByName||R.dispatched_by_name||"N/A",C=R.remarks||"",de=g,pe=g+H/2+5;let te=y,xe=y;r.setFont("helvetica","normal"),r.setFontSize(10),r.text(`Document Number: ${E}`,de,te),te+=6,r.text(`Date: ${re}`,de,te),te+=6,r.text(`Destination Type: ${X.replace(/_/g," ")}`,de,te),te+=6,r.text(`Destination: ${be}`,de,te),te+=6,r.text(`Dispatched By: ${we}`,de,te),te+=6,i&&(r.text(`Docket Number: ${i}`,pe,xe),xe+=6),ce&&(r.text(`Transporter: ${ce}`,pe,xe),xe+=6),y=Math.max(te,xe)+8,oe(20),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("ITEMS",g,y),y+=8,r.setFontSize(9),r.setFont("helvetica","bold");const ue=[12,60,25,25,28],Ce=["S.No","Item Name / SKU","Quantity","Unit Price","Total Value"];let ee=g;Ce.forEach((O,B)=>{r.text(O,ee,y),ee+=ue[B]}),y+=5,r.setLineWidth(.5),r.line(g,y-2,W-g,y-2),y+=4,r.setFontSize(9),r.setFont("helvetica","normal"),P.forEach((O,B)=>{oe(12);const he=O.itemName||O.item_name||"N/A",le=O.skuCode||O.sku_code||O.skuId||O.sku_id||"N/A",Te=O.outgoingQuantity||O.outgoing_quantity||0,G=parseFloat(O.unitPrice||O.unit_price||0)||0,ze=parseFloat(O.totalValue||O.total_value||0)||0;ee=g,r.text(String(B+1),ee,y),ee+=ue[0];const ke=r.splitTextToSize(he,ue[1]-2);r.text(ke,ee,y),r.setFontSize(8),r.setFont("helvetica","italic"),r.text(`SKU: ${le}`,ee,y+ke.length*4+2),r.setFontSize(9),r.setFont("helvetica","normal"),ee+=ue[1],r.text(String(Te),ee,y),ee+=ue[2],r.setFont("helvetica","bold"),r.setFontSize(10);const $e=`₹${G.toFixed(2)}`;r.text($e,ee,y),ee+=ue[3];const Oe=`₹${ze.toFixed(2)}`;r.text(Oe,ee,y),r.setFont("helvetica","normal"),r.setFontSize(9),y+=Math.max(8,ke.length*4+4)}),y+=8,oe(30),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("SUMMARY",g,y),y+=10,r.setFontSize(10),r.setFont("helvetica","normal");const Me=R.totalQuantity||P.reduce((O,B)=>O+(B.outgoingQuantity||B.outgoing_quantity||0),0),Fe=parseFloat(R.totalValue||P.reduce((O,B)=>O+(B.totalValue||B.total_value||0),0))||0;if(r.text(`Total Quantity: ${Me}`,g,y),y+=7,r.setFont("helvetica","bold"),r.setFontSize(11),r.text(`Total Value: ₹${Fe.toFixed(2)}`,g,y),y+=10,C){oe(15),r.setFont("helvetica","normal"),r.setFontSize(10),r.text("Remarks:",g,y),y+=6,r.setFontSize(9);const O=r.splitTextToSize(C,H);r.text(O,g,y),y+=O.length*4+5}r.setFont("helvetica","normal"),r.setFontSize(8),r.setTextColor(128,128,128),r.text(`Generated on: ${new Date().toLocaleString()}`,g,q-10),r.setTextColor(0,0,0);const _e=E.replace(/[^a-zA-Z0-9]/g,"_"),me=`${M.replace(/\s+/g,"_")}_${_e}_${new Date().toISOString().split("T")[0]}.pdf`;r.save(me)}catch(w){console.error("Error downloading invoice:",w),alert((($=(d=w.response)==null?void 0:d.data)==null?void 0:$.error)||((L=(I=w.response)==null?void 0:I.data)==null?void 0:L.message)||"Failed to download invoice")}finally{v(!1)}},p=l.useMemo(()=>{const a=[];return t.forEach(d=>{const $=T[d.id]||[];$.length>0?$.forEach(I=>{const L=I.id||0;a.push({record:d,item:I,itemKey:`${d.id}-${L}`})}):a.push({record:d,item:{id:0,skuId:0,skuCode:"-",itemName:"Loading items...",outgoingQuantity:d.totalQuantity||0,unitPrice:0,totalValue:d.totalValue||0},itemKey:`${d.id}-0`})}),a},[t,T]);return e.jsxs("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-center mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/70 border-b border-slate-100",children:[e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center w-9"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Invoice/Challan Number"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Date"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Document Type"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Item Name"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"SKU ID"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Customer"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Quantity"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Total Value"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Status"}),e.jsx("th",{className:"px-[30px] py-[21px] text-[10.8px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-10 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})})})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-10 py-12 text-center text-slate-500 font-medium",children:"No outgoing inventory records found"})}):p.map(a=>e.jsx(hs,{record:a.record,item:a.item,itemKey:a.itemKey,isExpanded:V.has(a.itemKey),onToggle:()=>A(a.itemKey),onViewDetails:()=>u(a.record.id),onDownloadInvoice:()=>f(a.record.id),downloading:Z},a.itemKey))})]})}),U&&c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Outgoing Record Details"}),e.jsx("button",{onClick:()=>{Q(!1),k(null),m([])},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg transition-colors",children:e.jsx(dt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Document Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Document Type"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:F(c.documentType||"",c.documentSubType,c.vendorSubType,c.deliveryChallanSubType)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Status"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:c.status||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.invoiceChallanDate?ae(c.invoiceChallanDate):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.invoiceChallanNumber||c.invoice_challan_number||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Docket Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.docketNumber||c.docket_number||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Transportor Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.transportorName||c.transportor_name||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Destination"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Destination Type"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:((D=c.destinationType)==null?void 0:D.replace(/_/g," "))||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Destination Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.destinationName||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Item Details"}),x.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No items found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Item Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Outgoing Quantity"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Total Value"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[x.map((a,d)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.itemName||a.item_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.skuCode||a.sku_code||a.skuId||a.sku_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:z(a.outgoingQuantity||a.outgoing_quantity||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ge(a.unitPrice||a.unit_price||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:ge(a.totalValue||a.total_value||0)})]},a.id||d)),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-sm text-gray-900",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:z(x.reduce((a,d)=>a+(d.outgoingQuantity||d.outgoing_quantity||0),0))}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ge(x.reduce((a,d)=>a+(d.totalValue||d.total_value||0),0))})]})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Dispatched By"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.dispatchedByName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Remarks"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.remarks||"-"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:z(c.totalQuantity||x.reduce((a,d)=>a+(d.outgoingQuantity||d.outgoing_quantity||0),0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Value"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:ge(c.totalValue||x.reduce((a,d)=>a+(d.totalValue||d.total_value||0),0))})]})]})]})]}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{Q(!1),k(null),m([])},className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})})]})})]})},js=({isOpen:t,record:o,items:V,selectedItemId:T,formData:A,updating:U,onClose:Q,onItemSelect:c,onFormDataChange:k,onUpdate:x})=>!t||!o?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"DETAILS"}),e.jsx("button",{onClick:Q,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg transition-colors",children:e.jsx(dt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice/Challan Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:ae(o.invoiceDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.invoiceNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Docket Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.docketNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Transportor Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.transportorName||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vendor & Brand"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.vendorName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Brand"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.brandName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Warranty"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.warranty?`${o.warranty} ${o.warrantyUnit||"months"}`:"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Receiving Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Receiving Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:ae(o.receivingDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Received By"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.receivedByName||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Item Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Total Quantity"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Received"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Short"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Rejected"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Total Value"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-3 py-4 text-center text-gray-500",children:"No items found"})}):V.map(m=>{const S=m.itemId||m.item_id||m.id||0,K=m.itemName||m.item_name||"N/A",Z=m.skuCode||m.sku_code||m.skuId||m.sku_id||"N/A",v=m.totalQuantity||m.total_quantity||0,u=m.received||0,F=m.short||0,f=m.rejected||0,p=m.unitPrice||m.unit_price||0,D=m.totalValue||m.total_value||v*p;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:K}),e.jsx("td",{className:"px-3 py-2 text-gray-700 font-mono text-xs",children:Z}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:z(v)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:z(u)}),e.jsx("td",{className:"px-3 py-2 text-center text-orange-700 font-semibold",children:z(F)}),e.jsx("td",{className:"px-3 py-2 text-center text-red-700 font-semibold",children:z(f)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:ge(p)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900 font-semibold",children:ge(D)})]},S)})}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-3 py-2 text-sm font-semibold text-gray-900",children:"Total"}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:z(V.reduce((m,S)=>m+(S.totalQuantity||S.total_quantity||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:z(V.reduce((m,S)=>m+(S.received||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-orange-700",children:z(V.reduce((m,S)=>m+(S.short||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-red-700",children:z(V.reduce((m,S)=>m+(S.rejected||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:"-"}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:ge(V.reduce((m,S)=>m+(S.totalValue||S.total_value||(S.totalQuantity||S.total_quantity||0)*(S.unitPrice||S.unit_price||0)),0))})]})})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:z(o.totalQuantity||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Received"}),e.jsx("p",{className:"text-lg font-bold text-green-700",children:z(o.received||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Short"}),e.jsx("p",{className:"text-lg font-bold text-orange-700",children:z(o.short||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Rejected"}),e.jsx("p",{className:"text-lg font-bold text-red-700",children:z(o.rejected||0)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Value"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:ge(o.totalValue||0)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Details"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Reason for Receipt"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.reason||"N/A"})]})})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200",children:e.jsx("button",{onClick:Q,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Close"})})]})}),zs=()=>{const[t,o]=l.useState("all"),[V,T]=l.useState(!1),[A,U]=l.useState([]),[Q,c]=l.useState([]),[k,x]=l.useState([]),[m,S]=l.useState(new Set),[K,Z]=l.useState(new Set),[v,u]=l.useState(new Set),[F,f]=l.useState({}),[p,D]=l.useState({}),[a,d]=l.useState(!1),$=l.useRef(null),[I,L]=l.useState(""),[w,R]=l.useState(""),[P,r]=l.useState(""),[W,q]=l.useState(""),[g,H]=l.useState(""),[y,oe]=l.useState("all"),[M,E]=l.useState(""),[re,i]=l.useState(""),[ce,be]=l.useState(""),[X,we]=l.useState(!1),[C,de]=l.useState(""),[pe,te]=l.useState("asc"),[xe,ue]=l.useState(""),[Ce,ee]=l.useState("asc"),[Me,Fe]=l.useState([]),[_e,me]=l.useState([]),[O,B]=l.useState([]),[he,le]=l.useState([]),[Te,G]=l.useState([]),[ze,ke]=l.useState([]),[$e,Oe]=l.useState(""),[Se,He]=l.useState(""),[Y,fe]=l.useState(""),[ye,De]=l.useState(""),[Ee,Ie]=l.useState(!1),[Ne,Ae]=l.useState(""),[Pe,Be]=l.useState(""),[Re,mt]=l.useState(""),[Ye,st]=l.useState(""),[We,at]=l.useState(""),[Tt,nt]=l.useState(!1),[Xe,$t]=l.useState(""),[Ge,Et]=l.useState(""),[At,Ze]=l.useState(!1),[Ve,rt]=l.useState(null),[ot,Ue]=l.useState([]),[Ke,Qe]=l.useState(null),[je,qe]=l.useState({rejected:0,short:0,invoiceNumber:"",invoiceDate:""}),[Pt,pt]=l.useState(!1);l.useEffect(()=>{ut()},[]),l.useEffect(()=>os(()=>{ut(),w&&gt(parseInt(w)),P&&ht(parseInt(P))}),[w,P]),l.useEffect(()=>ls(()=>{t==="all"?ft():t==="incoming"?Je():t==="outgoing"&&jt()}),[t]),l.useEffect(()=>{const s=n=>{$.current&&!$.current.contains(n.target)&&d(!1)};return a&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[a]),l.useEffect(()=>{t==="all"?ft():t==="incoming"?Je():t==="outgoing"&&jt()},[t,I,w,P,W,g,y,M,re,ce,C,pe,Se,Y,ye,Ne,Pe,Re,Ye,We,Xe,Ge]),l.useEffect(()=>{w?gt(parseInt(w)):(me([]),r(""),q(""),B([]))},[w]),l.useEffect(()=>{P?ht(parseInt(P)):(B([]),q(""))},[P]);const ut=async()=>{try{const[s,n,h,b]=await Promise.all([Le.getYourProductCategories(),Le.getBrands(),Le.getYourVendors(),Le.getCustomers()]);Fe(s.data||[]),le(n.data||[]),G(h.data||[]),ke(b.data||[])}catch(s){console.error("Error loading initial data:",s)}},gt=async s=>{try{const n=await Le.getYourItemCategories(s);me(n.data||[])}catch(n){console.error("Error loading item categories:",n)}},ht=async s=>{try{const n=await Le.getYourSubCategories(s);B(n.data||[])}catch(n){console.error("Error loading sub categories:",n)}},ft=async()=>{try{T(!0);const s={};if(I&&(s.search=I),w&&(s.productCategory=w),P&&(s.itemCategory=P),W&&(s.subCategory=W),g&&(s.brand=g),y!=="all"){const b={out_of_stock:"out",low_stock:"low",in_stock:"in"};s.stockStatus=b[y]||y}if(M==="custom")re&&(s.dateFrom=re),ce&&(s.dateTo=ce);else if(M){const b=ve(M);b&&(s.dateFrom=b.dateFrom,s.dateTo=b.dateTo)}let h=(await Jt.getAll(s)).data||[];h=h.map(b=>({...b,lastUpdated:b.updatedAt||b.lastUpdated||b.last_updated||null,minStock:b.minStockLevel||b.minStock||b.min_stock||0})),C&&h.length>0&&(h=[...h].sort((b,j)=>{var J,ne,bt,yt,Nt,vt,wt,Ct,kt,St,Dt,It;let _,N;switch(C){case"productCategory":_=((J=b.productCategory)==null?void 0:J.toLowerCase())||"",N=((ne=j.productCategory)==null?void 0:ne.toLowerCase())||"";break;case"itemCategory":_=((bt=b.itemCategory)==null?void 0:bt.toLowerCase())||"",N=((yt=j.itemCategory)==null?void 0:yt.toLowerCase())||"";break;case"subCategory":_=((Nt=b.subCategory)==null?void 0:Nt.toLowerCase())||"",N=((vt=j.subCategory)==null?void 0:vt.toLowerCase())||"";break;case"itemName":_=((wt=b.itemName)==null?void 0:wt.toLowerCase())||"",N=((Ct=j.itemName)==null?void 0:Ct.toLowerCase())||"";break;case"brand":_=((kt=b.brand)==null?void 0:kt.toLowerCase())||"",N=((St=j.brand)==null?void 0:St.toLowerCase())||"";break;case"vendor":_=((Dt=b.vendor)==null?void 0:Dt.toLowerCase())||"",N=((It=j.vendor)==null?void 0:It.toLowerCase())||"";break;case"currentStock":_=b.currentStock??0,N=j.currentStock??0;break;default:return 0}return typeof _=="string"&&typeof N=="string"?pe==="asc"?_.localeCompare(N):N.localeCompare(_):pe==="asc"?_-N:N-_})),U(h)}catch(s){console.error("Error loading inventory:",s),U([])}finally{T(!1)}},Vt=s=>{C===s?te(pe==="asc"?"desc":"asc"):(de(s),te("asc"))},Qt=({field:s})=>C!==s?e.jsxs("span",{className:"inline-flex flex-col ml-1 text-gray-400",children:[e.jsx(et,{className:"w-3 h-3 -mb-0.5"}),e.jsx(tt,{className:"w-3 h-3"})]}):pe==="asc"?e.jsx(et,{className:"w-4 h-4 ml-1 text-blue-600"}):e.jsx(tt,{className:"w-4 h-4 ml-1 text-blue-600"}),Lt=s=>{xe===s?ee(Ce==="asc"?"desc":"asc"):(ue(s),ee("asc"))},Mt=({field:s})=>xe!==s?e.jsxs("span",{className:"inline-flex flex-col ml-1 text-gray-400",children:[e.jsx(et,{className:"w-3 h-3 -mb-0.5"}),e.jsx(tt,{className:"w-3 h-3"})]}):Ce==="asc"?e.jsx(et,{className:"w-4 h-4 ml-1 text-blue-600"}):e.jsx(tt,{className:"w-4 h-4 ml-1 text-blue-600"}),Je=async()=>{try{T(!0);const s={};if(Ne&&(s.vendor=Ne),Pe&&(s.status=Pe),Se==="custom")Y&&(s.dateFrom=Y),ye&&(s.dateTo=ye);else if(Se){const _=ve(Se);_&&(s.dateFrom=_.dateFrom,s.dateTo=_.dateTo)}const n=await se.getIncoming(s);let h=[];n&&n.success&&Array.isArray(n.data)?h=n.data:Array.isArray(n)?h=n:n&&Array.isArray(n.data)&&(h=n.data),c(h);const b={},j=h.map(async _=>{try{const N=await se.getIncomingById(_.id);N.success&&N.data.items&&(b[_.id]=N.data.items)}catch(N){console.error(`Error loading items for record ${_.id}:`,N)}});await Promise.all(j),f(b)}catch(s){console.error("Error loading incoming records:",s),c([])}finally{T(!1)}},zt=s=>{E(s),s==="custom"?we(!0):(we(!1),i(""),be(""))},Ot=s=>{He(s),s==="custom"?Ie(!0):(Ie(!1),fe(""),De(""))},Bt=s=>{mt(s),s==="custom"?nt(!0):(nt(!1),st(""),at(""))},jt=async()=>{try{T(!0);const s={};if(Xe&&(s.destination=Xe),Ge&&(s.status=Ge),Re==="custom")Ye&&(s.dateFrom=Ye),We&&(s.dateTo=We);else if(Re){const j=ve(Re);j&&(s.dateFrom=j.dateFrom,s.dateTo=j.dateTo)}console.log("Loading outgoing records with params:",s);const n=await se.getOutgoing(s);console.log("Outgoing records response:",n);let h=[];n&&n.success&&Array.isArray(n.data)?h=n.data:Array.isArray(n)?h=n:n&&n.data&&Array.isArray(n.data)&&(h=n.data),console.log("Parsed records:",h),x(h);const b={};if(h.length>0){const j=h.map(async _=>{var N,J;try{const ne=await se.getOutgoingById(_.id);console.log(`Items for record ${_.id}:`,ne),(ne!=null&&ne.success&&((N=ne.data)!=null&&N.items)||(J=ne==null?void 0:ne.data)!=null&&J.items)&&(b[_.id]=ne.data.items)}catch(ne){console.error(`Error loading items for record ${_.id}:`,ne)}});await Promise.all(j),console.log("Items map:",b)}D(b)}catch(s){console.error("Error loading outgoing records:",s),x([]),D({})}finally{T(!1)}},Ut=async s=>{var h,b;const n=new Set(v);if(n.has(s))n.delete(s);else{n.add(s);const[j]=s.split("-"),_=parseInt(j);if(!p[_])try{const N=await se.getOutgoingById(_);N!=null&&N.success&&((h=N.data)!=null&&h.items)?D(J=>({...J,[_]:N.data.items})):(b=N==null?void 0:N.data)!=null&&b.items&&D(J=>({...J,[_]:N.data.items}))}catch(N){console.error("Error loading record items:",N)}}u(n)},Kt=s=>{const n=new Set(m);n.has(s)?n.delete(s):n.add(s),S(n)},qt=async s=>{const n=new Set(K);if(n.has(s))n.delete(s);else{n.add(s);const[h]=s.split("-"),b=parseInt(h);if(!F[b])try{const j=await se.getIncomingById(b);j.success&&j.data.items&&f(_=>({..._,[b]:j.data.items}))}catch(j){console.error("Error loading record items:",j)}}Z(n)},Ht=async(s,n)=>{try{rt(s);const h=await se.getIncomingById(s.id);if(h.success&&h.data.items&&h.data.items.length>0){Ue(h.data.items);const b=n.itemId||n.item_id||n.id;Qe(b||null),qe({rejected:n.rejected||0,short:n.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""})}else{const b=n.itemId||n.item_id||n.id||0;Ue([n]),Qe(b),qe({rejected:n.rejected||0,short:n.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""})}Ze(!0)}catch(h){console.error("Error loading record details:",h);const b=n.itemId||n.item_id||n.id||0;Ue([n]),Qe(b),qe({rejected:n.rejected||0,short:n.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""}),Ze(!0)}},Yt=async()=>{var b,j,_,N;if(!Ve||Ke===null){alert("Please select an item to update");return}const s=ot.find(J=>(J.itemId||J.item_id||J.id)===Ke);if(!s){alert("Selected item not found");return}const n=s.rejected||0,h=s.short||0;if(je.rejected>n||je.short>h){alert(`Updated rejected/short values cannot exceed the original values (Rejected: ${n}, Short: ${h})`);return}if(je.rejected===n&&je.short===h){alert("No changes detected. Please update at least one value.");return}if(Ke===0){alert("Cannot update: Item details not available. Please refresh and try again.");return}try{pt(!0),await se.updateRejectedShort(Ve.id,{itemId:Ke,rejected:je.rejected,short:je.short,invoiceNumber:je.invoiceNumber||void 0,invoiceDate:je.invoiceDate||void 0}),await Je(),Ze(!1),rt(null),Ue([]),Qe(null),alert("Rejected/Short quantities updated successfully. Stock has been adjusted.")}catch(J){console.error("Error updating rejected/short:",J),alert(((j=(b=J.response)==null?void 0:b.data)==null?void 0:j.error)||((N=(_=J.response)==null?void 0:_.data)==null?void 0:N.message)||"Failed to update rejected/short")}finally{pt(!1)}},Wt=async s=>{if(s)try{const n=await se.getIncomingItems(s);n.success&&n.data&&f(h=>({...h,[s]:n.data}))}catch(n){console.error("Error refreshing items:",n)}if(Ve){const n=await se.getIncomingById(Ve.id);n.success&&n.data.items&&f(h=>({...h,[Ve.id]:n.data.items}))}await Je()},Xt=async()=>{d(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],n=A.map(j=>[j.skuId||"-",j.productCategory||"-",j.itemCategory||"-",j.subCategory||"-",j.itemName||"-",j.brand||"-",j.vendor||"-",j.model||"-",j.hsnSacCode||"-",z(j.currentStock||0)]),h=M?ve(M):null,b=h?`Date Range: ${ae(h.dateFrom)} to ${ae(h.dateTo)}`:"";await ts({headers:s,rows:n,title:"Inventory Report",dateRange:b})}catch(s){console.error("Error exporting PDF:",s),alert("Failed to export PDF")}},Gt=async()=>{d(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],n=A.map(j=>[j.skuId||"-",j.productCategory||"-",j.itemCategory||"-",j.subCategory||"-",j.itemName||"-",j.brand||"-",j.vendor||"-",j.model||"-",j.hsnSacCode||"-",z(j.currentStock||0)]),h=M?ve(M):null,b=h?`Date Range: ${ae(h.dateFrom)} to ${ae(h.dateTo)}`:"";await es({headers:s,rows:n,title:"Inventory Report",dateRange:b})}catch(s){console.error("Error exporting Excel:",s),alert("Failed to export Excel")}},Zt=async()=>{d(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],n=A.map(N=>[N.skuId||"-",N.productCategory||"-",N.itemCategory||"-",N.subCategory||"-",N.itemName||"-",N.brand||"-",N.vendor||"-",N.model||"-",N.hsnSacCode||"-",z(N.currentStock||0)]),h=[["Inventory Report"],M?[ve(M)?`Date Range: ${ae(ve(M).dateFrom)} to ${ae(ve(M).dateTo)}`:""]:[],[],s,...n].map(N=>N.map(J=>`"${J}"`).join(",")).join(`
`),b=new Blob([h],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a"),_=URL.createObjectURL(b);j.setAttribute("href",_),j.setAttribute("download",`Inventory_Report_${new Date().toISOString().split("T")[0]}.csv`),j.style.visibility="hidden",document.body.appendChild(j),j.click(),document.body.removeChild(j)}catch(s){console.error("Error exporting CSV:",s),alert("Failed to export CSV")}};return e.jsxs("div",{className:"p-6 space-y-7 w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("h1",{className:"text-[21.6px] font-semibold leading-[1.2] tracking-[-0.01em] text-slate-900",children:"Inventory"}),e.jsx("p",{className:"text-[12.6px] font-normal leading-[1.5] text-slate-500",children:"Comprehensive inventory tracking and management system."})]})}),e.jsx("div",{className:"bg-white rounded-[1.875rem] border border-slate-100 shadow-sm p-[6px]",children:e.jsxs("nav",{className:"flex space-x-[6px]",children:[e.jsx("button",{onClick:()=>o("all"),className:`px-[18px] py-[9px] rounded-xl font-black text-[11.7px] uppercase tracking-wider transition-all ${t==="all"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"All Inventory"}),e.jsx("button",{onClick:()=>o("incoming"),className:`px-[18px] py-[9px] rounded-xl font-black text-[11.7px] uppercase tracking-wider transition-all ${t==="incoming"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"Incoming Records"}),e.jsx("button",{onClick:()=>o("outgoing"),className:`px-[18px] py-[9px] rounded-xl font-black text-[11.7px] uppercase tracking-wider transition-all ${t==="outgoing"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"Outgoing Records"})]})}),t==="all"&&e.jsxs(e.Fragment,{children:[e.jsx(is,{search:I,productCategory:w,itemCategory:P,subCategory:W,brand:g,stockStatus:y,datePreset:M,customDateFrom:re,customDateTo:ce,showCustomDatePicker:X,productCategories:Me,itemCategories:_e,subCategories:O,brands:he,onSearchChange:L,onProductCategoryChange:R,onItemCategoryChange:r,onSubCategoryChange:q,onBrandChange:H,onStockStatusChange:oe,onDatePresetChange:zt,onCustomDateFromChange:i,onCustomDateToChange:be,onClearDateFilter:()=>{E(""),i(""),be(""),we(!1)},showExportDropdown:a,onExportDropdownToggle:()=>d(!a),onExportPDF:Xt,onExportExcel:Gt,onExportCSV:Zt,exportDropdownRef:$,loading:V}),e.jsx(ms,{inventory:A,loading:V,expandedRows:m,onToggleRow:Kt,sortBy:C,sortOrder:pe,onSort:Vt,SortIcon:Qt})]}),t==="incoming"&&e.jsxs(e.Fragment,{children:[e.jsx(cs,{search:$e,vendor:Ne,status:Pe,datePreset:Se,customDateFrom:Y,customDateTo:ye,showCustomDatePicker:Ee,vendors:Te,onSearchChange:Oe,onVendorChange:Ae,onStatusChange:Be,onDatePresetChange:Ot,onCustomDateFromChange:fe,onCustomDateToChange:De,onClearDateFilter:()=>{He(""),fe(""),De(""),Ie(!1)}}),e.jsx(gs,{records:Q,loading:V,expandedRows:K,recordItems:F,onToggleRow:qt,onEditRejectedShort:Ht,onItemsUpdate:Wt,sortBy:xe,sortOrder:Ce,onSort:Lt,SortIcon:Mt,search:$e})]}),t==="outgoing"&&e.jsxs(e.Fragment,{children:[e.jsx(ds,{destination:Xe,status:Ge,datePreset:Re,customDateFrom:Ye,customDateTo:We,showCustomDatePicker:Tt,customers:ze,vendors:Te,onDestinationChange:$t,onStatusChange:Et,onDatePresetChange:Bt,onCustomDateFromChange:st,onCustomDateToChange:at,onClearDateFilter:()=>{mt(""),st(""),at(""),nt(!1)}}),e.jsx(fs,{records:k,loading:V,expandedRows:v,recordItems:p,onToggleRow:Ut})]}),e.jsx(js,{isOpen:At,record:Ve,items:ot,selectedItemId:Ke,formData:je,updating:Pt,onClose:()=>{Ze(!1),rt(null),Ue([]),Qe(null)},onItemSelect:s=>{Qe(s);const n=ot.find(h=>(h.itemId||h.item_id||h.id)===s);n&&qe(h=>({...h,rejected:n.rejected||0,short:n.short||0}))},onFormDataChange:s=>{qe(n=>({...n,...s}))},onUpdate:Yt})]})};export{zs as default};
