import{u as de,r as c,j as e}from"./index-C4O2RVGC.js";import{i as $}from"./inventoryService-Cfeh1TyB.js";import{s as ce}from"./skuService-CD47JNeC.js";import{l as Q}from"./libraryService-BC59J_DM.js";import{f as V,b as D,a as ue}from"./formatters-ptPrPoGe.js";import{A as xe}from"./arrow-left-DX9oxssc.js";import{P as me}from"./plus-DdeNo8e1.js";import{X as pe}from"./x-ChutkFoY.js";import{C as ge}from"./chevron-down-CuFOjVxo.js";import{T as be}from"./trash-2-BS2IYTwN.js";import{S as he}from"./save-jeta1nOA.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";import"./inventoryEvents-fOALNsvn.js";const Ee=()=>{const P=de(),[j,A]=c.useState("add"),[w,S]=c.useState(!1),E=()=>({id:Date.now().toString(),skuId:"",itemName:"",currentStock:0,originalStock:0,outgoingQuantity:0,unitPrice:0,gstPercentage:0,totalValue:0}),[n,d]=c.useState({documentType:"sales_invoice",documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",invoiceChallanDate:new Date().toISOString().split("T")[0],invoiceChallanNumber:"",docketNumber:"",transportorName:"",destinationType:"customer",destinationId:"",dispatchedBy:"",remarks:"",items:[E()]}),[p,q]=c.useState([]),[O,H]=c.useState([]),[z,B]=c.useState([]),[M,X]=c.useState([]),[F,L]=c.useState([]),[h,f]=c.useState({}),[R,N]=c.useState({}),[k,m]=c.useState({}),[T,Y]=c.useState(""),[C,J]=c.useState(""),[I,W]=c.useState(""),[_,Z]=c.useState("");c.useEffect(()=>{ee()},[]),c.useEffect(()=>{j==="history"&&te()},[j,T,C,I,_]),c.useEffect(()=>{const t=s=>{s.target.closest(".sku-dropdown-container")||(N({}),f(r=>{const o={};return Object.keys(r).forEach(l=>{const i=n.items.find(u=>u.id===l);if(i!=null&&i.skuId){const u=p.find(v=>v.id.toString()===i.skuId);(u==null?void 0:u.skuId)===r[l]&&(o[l]=r[l])}}),o}))};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[n.items,p]),c.useEffect(()=>{n.documentType==="transfer_note"?d(t=>({...t,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:"store_to_factory",destinationId:""})):d(t=>({...t,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:(t.documentType==="sales_invoice","customer"),destinationId:""})),m({})},[n.documentType]),c.useEffect(()=>{n.documentType==="sales_invoice"?n.documentSubType==="to_customer"?d(t=>({...t,destinationType:"customer",vendorSubType:"",destinationId:""})):n.documentSubType==="to_vendor"&&d(t=>({...t,destinationType:"vendor",destinationId:""})):n.documentType==="delivery_challan"&&(n.documentSubType==="sample"?d(t=>({...t,destinationType:"customer",deliveryChallanSubType:"",destinationId:""})):n.documentSubType==="replacement"&&d(t=>({...t,destinationId:""}))),m({})},[n.documentSubType]),c.useEffect(()=>{n.documentType==="delivery_challan"&&n.documentSubType==="replacement"&&(n.deliveryChallanSubType==="to_customer"?d(t=>({...t,destinationType:"customer",destinationId:""})):n.deliveryChallanSubType==="to_vendor"&&d(t=>({...t,destinationType:"vendor",destinationId:""}))),m({})},[n.deliveryChallanSubType]);const ee=async()=>{try{const[t,s,a,r]=await Promise.all([ce.getAll({limit:1e3}),Q.getCustomers(),Q.getYourVendors(),Q.getTeams()]);q(t.data||[]),H(s.data||[]),B(a.data||[]),X(r.data||[])}catch(t){console.error("Error loading initial data:",t)}},te=async()=>{try{S(!0);const t={};T&&(t.dateFrom=T),C&&(t.dateTo=C),I&&(t.destination=I),_&&(t.sku=_);const s=await $.getOutgoingHistory(t);L(s.data||[])}catch(t){console.error("Error loading history:",t),L([])}finally{S(!1)}},se=()=>{const t=E();d(s=>({...s,items:[...s.items,t]}))},ae=t=>{d(s=>{const a=s.items.filter(r=>r.id!==t);return a.length===0?{...s,items:[E()]}:{...s,items:a}})},y=()=>n.documentType==="delivery_challan"&&n.documentSubType==="replacement"&&n.deliveryChallanSubType==="to_vendor",g=(t,s,a)=>{d(r=>({...r,items:r.items.map(o=>{if(o.id===t){const l={...o,[s]:a};if(s==="skuId"){const i=p.find(x=>x.id.toString()===a);l.itemName=(i==null?void 0:i.itemName)||"",l.originalStock=(i==null?void 0:i.currentStock)||0,l.currentStock=(i==null?void 0:i.currentStock)||0;const u=(i==null?void 0:i.gstRate)??(i==null?void 0:i.gst_rate)??(i==null?void 0:i.gstRatePercentage)??(i==null?void 0:i.gst_rate_percentage);if(u!=null){const x=parseFloat(u);isNaN(x)||(l.gstPercentage=x)}l.outgoingQuantity=0;const v=l.outgoingQuantity*l.unitPrice;l.totalValue=v+v*(l.gstPercentage/100),m(x=>{const b={...x};return delete b[o.id],b})}if(s==="outgoingQuantity"){const i=parseInt(a)||0;if(y())l.outgoingQuantity=i,m(x=>{const b={...x};return delete b[o.id],b});else{const x=l.originalStock;if(i>x)return m(b=>({...b,[o.id]:`Outgoing quantity cannot exceed available stock (${x})`})),o;m(b=>{const K={...b};return delete K[o.id],K}),l.outgoingQuantity=i,l.currentStock=l.originalStock-i}const v=l.outgoingQuantity*l.unitPrice;l.totalValue=v+v*(l.gstPercentage/100)}if(s==="unitPrice"){const i=l.outgoingQuantity*l.unitPrice;l.totalValue=i+i*(l.gstPercentage/100)}if(s==="gstPercentage"){const i=l.outgoingQuantity*l.unitPrice;l.totalValue=i+i*(l.gstPercentage/100)}return l}return o})}))},ne=()=>{const t={},s=y();return n.items.forEach(a=>{a.skuId&&!s&&a.outgoingQuantity>a.originalStock&&(t[a.id]=`Outgoing quantity cannot exceed available stock (${a.originalStock})`)}),m(t),Object.keys(t).length===0},U=async(t=!1)=>{var s,a;if(!t&&!ne()){alert("Please fix validation errors before submitting.");return}try{S(!0);const r={...n,items:n.items.map(o=>({skuId:o.skuId,outgoingQuantity:o.outgoingQuantity,unitPrice:o.unitPrice,gstPercentage:o.gstPercentage})),status:t?"draft":"completed"};await $.addOutgoing(r),P("/app/inventory")}catch(r){console.error("Error submitting outgoing inventory:",r),alert(((a=(s=r.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to submit outgoing inventory")}finally{S(!1)}},re=t=>t>10?"text-green-600":t>0?"text-yellow-600":"text-red-600",le=()=>n.documentType==="sales_invoice"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:n.documentSubType,onChange:t=>d(s=>({...s,documentSubType:t.target.value,vendorSubType:""})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"to_customer",children:"To Customer"}),e.jsx("option",{value:"to_vendor",children:"To Vendor"})]})]}):n.documentType==="delivery_challan"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:n.documentSubType,onChange:t=>d(s=>({...s,documentSubType:t.target.value,deliveryChallanSubType:""})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"sample",children:"Sample"}),e.jsx("option",{value:"replacement",children:"Replacement"})]})]}):n.documentType==="transfer_note"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Type"}),e.jsx("input",{type:"text",value:"Store to Factory",readOnly:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}):null,oe=()=>n.documentType==="sales_invoice"&&n.documentSubType==="to_vendor"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor Type"}),e.jsxs("select",{value:n.vendorSubType,onChange:t=>d(s=>({...s,vendorSubType:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"replacement",children:"Replacement"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}):null,ie=()=>n.documentType==="delivery_challan"&&n.documentSubType==="replacement"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Replacement Type"}),e.jsxs("select",{value:n.deliveryChallanSubType,onChange:t=>d(s=>({...s,deliveryChallanSubType:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"to_customer",children:"To Customer"}),e.jsx("option",{value:"to_vendor",children:"To Vendor (Return to Vendor)"})]})]}):null,G=()=>n.documentType==="transfer_note"?null:n.documentType==="delivery_challan"&&n.documentSubType==="sample"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer"}),e.jsxs("select",{value:n.destinationId,onChange:t=>d(s=>({...s,destinationId:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Customer"}),O.map(t=>e.jsx("option",{value:t.id,children:t.customerName||t.name},t.id))]})]}):n.destinationType==="customer"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer"}),e.jsxs("select",{value:n.destinationId,onChange:t=>d(s=>({...s,destinationId:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Customer"}),O.map(t=>e.jsx("option",{value:t.id,children:t.customerName||t.name},t.id))]})]}):n.destinationType==="vendor"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor"}),e.jsxs("select",{value:n.destinationId,onChange:t=>d(s=>({...s,destinationId:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Vendor"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name||t.vendorName},t.id))]})]}):null;return e.jsxs("div",{className:"p-8 space-y-10 w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>P("/app/inventory"),className:"text-slate-600 hover:text-indigo-600 transition-colors",children:e.jsx(xe,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-[28.8px] font-semibold leading-[1.2] tracking-[-0.01em] text-slate-900",children:"Outgoing Inventory"})]}),e.jsx("p",{className:"text-[16.8px] font-normal leading-[1.5] text-slate-500",children:"Record and manage outgoing stock shipments and transfers."})]})}),e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-slate-100 shadow-sm p-2",children:e.jsxs("nav",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>A("add"),className:`px-6 py-3 rounded-2xl font-black text-[15.6px] uppercase tracking-wider transition-all ${j==="add"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"Add New"}),e.jsx("button",{onClick:()=>A("history"),className:`px-6 py-3 rounded-2xl font-black text-[15.6px] uppercase tracking-wider transition-all ${j==="history"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"History"})]})}),j==="add"&&e.jsxs("form",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Document Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>d(t=>({...t,documentType:"sales_invoice"})),children:[e.jsx("input",{type:"radio",name:"documentType",value:"sales_invoice",checked:n.documentType==="sales_invoice",onChange:t=>d(s=>({...s,documentType:t.target.value})),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Sales Invoice"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>d(t=>({...t,documentType:"delivery_challan"})),children:[e.jsx("input",{type:"radio",name:"documentType",value:"delivery_challan",checked:n.documentType==="delivery_challan",onChange:t=>d(s=>({...s,documentType:t.target.value})),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Delivery Challan"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>d(t=>({...t,documentType:"transfer_note"})),children:[e.jsx("input",{type:"radio",name:"documentType",value:"transfer_note",checked:n.documentType==="transfer_note",onChange:t=>d(s=>({...s,documentType:t.target.value})),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Transfer Note"})]})]})]}),e.jsxs("div",{children:[le(),oe(),ie()]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice/Challan Date"}),e.jsx("input",{type:"date",value:n.invoiceChallanDate,onChange:t=>d(s=>({...s,invoiceChallanDate:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice/Challan Number"}),e.jsx("input",{type:"text",value:n.invoiceChallanNumber,onChange:t=>d(s=>({...s,invoiceChallanNumber:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter invoice/challan number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Docket Number"}),e.jsx("input",{type:"text",value:n.docketNumber,onChange:t=>d(s=>({...s,docketNumber:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter docket number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transportor Name"}),e.jsx("input",{type:"text",value:n.transportorName,onChange:t=>d(s=>({...s,transportorName:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter transportor name"})]})]})]}),G()&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Destination"}),G()]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Item Details"}),e.jsxs("button",{type:"button",onClick:se,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsxs("div",{className:"space-y-3",children:[n.items.map(t=>{var s;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-[auto_1fr_1fr_1fr_1fr_1fr_1fr_1fr_auto] gap-3 items-end min-w-0",children:[e.jsx("div",{className:"flex items-center pb-1",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:["#",n.items.indexOf(t)+1]})}),e.jsxs("div",{className:"relative sku-dropdown-container min-w-0",style:{zIndex:1},children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("div",{className:"flex gap-1.5 items-start",children:e.jsxs("div",{className:"flex-1 relative min-w-0",style:{zIndex:10},children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsxs("div",{className:"flex-1 relative min-w-0",children:[e.jsx("input",{type:"text",value:h[t.id]||t.skuId&&((s=p.find(a=>a.id.toString()===t.skuId))==null?void 0:s.skuId)||"",onChange:a=>{f(r=>({...r,[t.id]:a.target.value})),N(r=>({...r,[t.id]:!1})),a.target.value||g(t.id,"skuId","")},onFocus:()=>{const a=p.find(r=>r.id.toString()===t.skuId);f(r=>({...r,[t.id]:(a==null?void 0:a.skuId)||""}))},placeholder:"Search SKU...",className:"w-full px-[11px] py-1.5 pr-8 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"}),(h[t.id]||t.skuId)&&e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),f(r=>({...r,[t.id]:""})),g(t.id,"skuId",""),N(r=>({...r,[t.id]:!1}))},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(pe,{className:"w-3 h-3"})})]}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),N(r=>({...r,[t.id]:!r[t.id]})),f(r=>({...r,[t.id]:""}))},className:"px-2 py-1.5 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 border border-gray-300 flex-shrink-0",title:"Show all SKUs",children:e.jsx(ge,{className:`w-3.5 h-3.5 transition-transform ${R[t.id]?"rotate-180":""}`})})]}),h[t.id]&&h[t.id].length>0&&!R[t.id]&&e.jsxs("div",{className:"absolute z-[100] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",style:{top:"100%"},children:[p.filter(a=>{var r,o;return((r=a.skuId)==null?void 0:r.toLowerCase().includes(h[t.id].toLowerCase()))||((o=a.itemName)==null?void 0:o.toLowerCase().includes(h[t.id].toLowerCase()))}).slice(0,10).map(a=>e.jsxs("div",{onClick:r=>{r.stopPropagation(),g(t.id,"skuId",a.id.toString()),f(o=>{const l={...o};return delete l[t.id],l}),N(o=>({...o,[t.id]:!1}))},className:"px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:a.skuId}),a.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:a.itemName})]},a.id)),p.filter(a=>{var r,o;return((r=a.skuId)==null?void 0:r.toLowerCase().includes(h[t.id].toLowerCase()))||((o=a.itemName)==null?void 0:o.toLowerCase().includes(h[t.id].toLowerCase()))}).length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs found"})]}),R[t.id]&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",style:{top:"100%"},children:p.length===0?e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs available"}):p.map(a=>e.jsxs("div",{onClick:r=>{r.stopPropagation(),g(t.id,"skuId",a.id.toString()),f(o=>{const l={...o};return delete l[t.id],l}),N(o=>({...o,[t.id]:!1}))},className:`px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 ${t.skuId===a.id.toString()?"bg-blue-50":""}`,children:[e.jsx("div",{className:"font-medium",children:a.skuId}),a.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:a.itemName})]},a.id))})]})})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:y()?"Rejected Qty":"Available Stock"}),e.jsx("div",{className:`w-full px-[11px] py-1.5 text-xs border border-gray-300 rounded bg-gray-50 font-semibold ${re(t.currentStock)}`,children:y()?V(t.outgoingQuantity):V(t.currentStock)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Outgoing Qty"}),e.jsx("input",{type:"number",min:"0",max:y()?void 0:t.originalStock,value:t.outgoingQuantity,onChange:a=>{const r=a.target.value;if(r===""){g(t.id,"outgoingQuantity","0");return}const o=parseInt(r);if(isNaN(o)||o<0)return;const l=y(),i=l?void 0:t.originalStock;if(!l&&i!==void 0&&o>i){m(u=>({...u,[t.id]:`Outgoing quantity cannot exceed available stock (${i})`}));return}g(t.id,"outgoingQuantity",r)},onBlur:a=>{const r=parseInt(a.target.value)||0;!y()&&r>t.originalStock&&(g(t.id,"outgoingQuantity",t.originalStock.toString()),m(l=>({...l,[t.id]:`Outgoing quantity cannot exceed available stock (${t.originalStock})`})))},className:`w-full px-[11px] py-1.5 text-xs border rounded focus:ring-1 focus:ring-blue-500 ${k[t.id]||!y()&&t.outgoingQuantity>t.originalStock?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"0"}),k[t.id]&&e.jsx("p",{className:"text-xs text-red-600 mt-0.5",children:k[t.id]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Unit Price"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.unitPrice,onChange:a=>g(t.id,"unitPrice",parseFloat(a.target.value)||0),className:"w-full px-[11px] py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total (Excl GST)"}),e.jsx("input",{type:"text",value:((t.outgoingQuantity||0)*(t.unitPrice||0)).toFixed(2),readOnly:!0,className:"w-full px-[11px] py-1.5 text-xs border border-gray-300 rounded bg-gray-50"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"GST%"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:t.gstPercentage,onChange:a=>g(t.id,"gstPercentage",parseFloat(a.target.value)||0),className:"w-full px-[11px] py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total Price (Incld GST)"}),e.jsx("input",{type:"text",value:t.totalValue.toFixed(2),readOnly:!0,className:"w-full px-[11px] py-1.5 text-xs border border-gray-300 rounded bg-gray-50"})]}),e.jsx("div",{className:"flex items-end pb-1",children:n.items.length>1&&e.jsx("button",{type:"button",onClick:()=>ae(t.id),className:"text-red-600 hover:text-red-800 flex-shrink-0 p-1",title:"Remove Item",children:e.jsx(be,{className:"w-4 h-4"})})})]})},t.id)}),(()=>{const t=n.items.reduce((r,o)=>r+(o.outgoingQuantity||0)*(o.unitPrice||0),0),s=n.items.reduce((r,o)=>{const l=(o.outgoingQuantity||0)*(o.unitPrice||0);return r+l*((o.gstPercentage||0)/100)},0),a=t+s;return e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Subtotal (Excl GST)"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:D(t)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total GST Amount"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:D(s)})]}),e.jsx("div",{className:"border-t border-gray-300 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-base font-bold text-gray-900",children:"Grand Total (Incl GST)"}),e.jsx("span",{className:"text-base font-bold text-gray-900",children:D(a)})]})]})})})()]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Additional Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dispatched By"}),e.jsxs("select",{value:n.dispatchedBy,onChange:t=>d(s=>({...s,dispatchedBy:t.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select Team"}),M.map(t=>e.jsx("option",{value:t.id,children:t.name||t.teamName},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{value:n.remarks,onChange:t=>d(s=>({...s,remarks:t.target.value})),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter any additional remarks"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>P("/app/inventory"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>U(!0),disabled:w,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:()=>U(!1),disabled:w||n.items.length===0||Object.keys(k).length>0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-5 h-5"}),"Submit"]})})]})]}),j==="history"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-slate-100 shadow-sm p-6",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[13px] font-black text-slate-700 uppercase tracking-wider mb-2",children:"Date From"}),e.jsx("input",{type:"date",value:T,onChange:t=>Y(t.target.value),className:"bg-slate-50 border border-slate-200 text-[15.6px] font-medium leading-[1.4] text-slate-800 px-5 py-3 rounded-[1.5rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[13px] font-black text-slate-700 uppercase tracking-wider mb-2",children:"Date To"}),e.jsx("input",{type:"date",value:C,onChange:t=>J(t.target.value),className:"bg-slate-50 border border-slate-200 text-[15.6px] font-medium leading-[1.4] text-slate-800 px-5 py-3 rounded-[1.5rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[13px] font-black text-slate-700 uppercase tracking-wider mb-2",children:"Destination"}),e.jsx("input",{type:"text",value:I,onChange:t=>W(t.target.value),placeholder:"SEARCH CUSTOMER/VENDOR",className:"bg-slate-50 border border-slate-200 text-[15.6px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[15.6px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 px-5 py-3 rounded-[1.5rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all w-48"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[13px] font-black text-slate-700 uppercase tracking-wider mb-2",children:"SKU"}),e.jsx("input",{type:"text",value:_,onChange:t=>Z(t.target.value),placeholder:"SEARCH SKU",className:"bg-slate-50 border border-slate-200 text-[15.6px] font-medium leading-[1.4] tracking-[0.05em] placeholder:text-[15.6px] placeholder:font-normal placeholder:tracking-[0.05em] text-slate-800 px-5 py-3 rounded-[1.5rem] focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/10 transition-all w-48"})]})]})}),e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-slate-100 shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-center mx-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-slate-50/70 border-b border-slate-100",children:[e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Date"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Document #"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Type"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Destination"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"SKU"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Quantity"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Value"}),e.jsx("th",{className:"px-10 py-7 text-[14.4px] font-semibold leading-[1.4] tracking-[0.1em] uppercase text-slate-400 text-center",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-10 py-12 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"})})})}):F.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-10 py-12 text-center text-slate-500 font-medium",children:"No history found"})}):F.map(t=>{var s;return e.jsxs("tr",{className:"group hover:bg-slate-50/40 transition-all min-h-[56px]",children:[e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[15.6px] font-normal leading-[1.4] text-slate-500",children:ue(t.date)})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[15.6px] font-medium leading-[1.4] text-slate-900",children:t.documentNumber||"-"})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[15.6px] font-normal leading-[1.4] text-slate-500 capitalize",children:((s=t.documentType)==null?void 0:s.replace(/_/g," "))||"-"})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[15.6px] font-normal leading-[1.4] text-slate-500",children:t.destination||"-"})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"inline-block text-[15.6px] font-normal leading-[1.4] text-indigo-600 bg-indigo-50/50 px-4 py-2 rounded-xl border border-indigo-100/50",children:t.sku||"-"})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[18px] font-semibold leading-[1.3] text-slate-900",children:V(t.quantity||0)})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:"text-[18px] font-semibold leading-[1.3] text-slate-900",children:D(t.value||0)})}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("button",{className:"text-[15.6px] font-medium text-indigo-600 hover:text-indigo-800 transition-colors",children:"View"})})]},t.id)})})]})})})]})]})};export{Ee as default};
