import{u as X,j as e,r as h,R as Pe}from"./index-BNvq7L73.js";import{i as _}from"./inventoryService-B58imFTr.js";import{l as z}from"./libraryService-1-VsGbkQ.js";import{s as Ee}from"./skuService-BaVM3Gme.js";import{P as J}from"./plus-i3erHhTd.js";import{X as W}from"./x-DoRfBOx5.js";import{C as oe}from"./chevron-down-7H3UhiUV.js";import{I as _e}from"./info-Dwxh0fA8.js";import{T as Re}from"./trash-2-CJo7E_kE.js";import{A as Ae}from"./alert-circle-CvwkvtqH.js";import{C as Be}from"./check-circle-DUrU9tOR.js";import{S as de}from"./save-DHz-rsxP.js";import{a as Q,b as Y}from"./formatters-ptPrPoGe.js";import{C as Qe}from"./chevron-right-r-Xp6hjL.js";import{E as De}from"./eye-yPZ_5C9M.js";import{D as Ge}from"./download-B9r3QDrU.js";import{P as Fe}from"./pen-square-kwXc_A6w.js";import{A as Oe}from"./arrow-left-BgDROCgl.js";import"./api-BJ7xcL-N.js";import"./cachedApi-DyAQX7TM.js";import"./inventoryEvents-fOALNsvn.js";const Ve=({formData:r,vendors:p,customers:d,brands:g,onFormDataChange:c})=>{const v=X(),t=()=>r.documentType==="bill"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:r.documentSubType,onChange:l=>{const y=l.target.value;c(y==="from_vendor"?{documentSubType:y,vendorSubType:"purchase_receipt",vendorId:"",brandId:"",destinationId:""}:{documentSubType:y,vendorSubType:"",vendorId:"",brandId:"",destinationId:""})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"from_vendor",children:"From Vendor"}),e.jsx("option",{value:"from_customer",children:"From Customer"})]})]}):r.documentType==="delivery_challan"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:r.documentSubType,onChange:l=>c({documentSubType:l.target.value,deliveryChallanSubType:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"sample",children:"Sample"}),e.jsx("option",{value:"replace",children:"Replace"})]})]}):r.documentType==="transfer_note"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Type"}),e.jsx("input",{type:"text",value:"Factory to Store",readOnly:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}):null,x=()=>r.documentType==="bill"&&r.documentSubType==="from_vendor"?e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Subtype"}),e.jsxs("select",{value:r.vendorSubType,onChange:l=>c({vendorSubType:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"purchase_receipt",children:"Purchase Receipt"})]})]}):null,T=()=>r.documentType==="delivery_challan"&&r.documentSubType==="sample"?e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sample Type"}),e.jsxs("select",{value:r.deliveryChallanSubType,onChange:l=>c({deliveryChallanSubType:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]})]}):null,b=()=>r.documentType==="bill"&&r.documentSubType==="from_vendor"?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Vendor & Brand"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Select Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.vendorId,onChange:l=>c({vendorId:l.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),p.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx("button",{type:"button",onClick:()=>v("/app/library?tab=vendors"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.brandId,onChange:l=>c({brandId:l.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Brand"}),g.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx("button",{type:"button",onClick:()=>v("/app/library?tab=brands"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warranty"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",min:"0",value:r.warranty,onChange:l=>c({warranty:parseInt(l.target.value)||0}),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0"}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>c({warrantyUnit:"months"}),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r.warrantyUnit==="months"?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-200"}`,children:"Months"}),e.jsx("button",{type:"button",onClick:()=>c({warrantyUnit:"year"}),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${r.warrantyUnit==="year"?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-200"}`,children:"Year"})]})]})]})]})]}):null,I=()=>r.documentType==="bill"&&r.documentSubType==="from_customer"?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Customer"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Customer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:r.destinationId,onChange:l=>c({destinationId:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),d.map(l=>e.jsx("option",{value:l.id,children:l.customerName||l.name},l.id))]})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Document Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>c({documentType:"bill"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"bill",checked:r.documentType==="bill",onChange:l=>c({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Bill"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>c({documentType:"delivery_challan"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"delivery_challan",checked:r.documentType==="delivery_challan",onChange:l=>c({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Delivery Challan"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>c({documentType:"transfer_note"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"transfer_note",checked:r.documentType==="transfer_note",onChange:l=>c({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Transfer Note"})]})]})]}),e.jsxs("div",{children:[t(),x(),T()]})]})]}),b(),I()]})},Ue=({formData:r,onFormDataChange:p})=>{const d=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Invoice/Challan Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Invoice/Challan Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:r.invoiceDate,max:d,onChange:g=>p({invoiceDate:g.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Invoice/Challan Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.invoiceNumber,onChange:g=>p({invoiceNumber:g.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter invoice number",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Docket Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.docketNumber,onChange:g=>p({docketNumber:g.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter docket number",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Transportor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r.transportorName,onChange:g=>p({transportorName:g.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter transportor name",required:!0})]})]})]})},qe=({formData:r,onFormDataChange:p})=>{const d=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Receiving Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Receiving Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:r.useCurrentDate,onChange:()=>p({useCurrentDate:!0}),className:"text-blue-600",required:!0}),e.jsx("span",{children:"Current Date"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:!r.useCurrentDate,onChange:()=>p({useCurrentDate:!1}),className:"text-blue-600",required:!0}),e.jsx("span",{children:"Select Date:"})]}),!r.useCurrentDate&&e.jsx("input",{type:"date",value:r.receivingDate,max:d,onChange:g=>p({receivingDate:g.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]})})]})},He=({itemId:r,skuId:p,skus:d,onSkuChange:g,onClear:c})=>{const[v,t]=h.useState(""),[x,T]=h.useState(!1),[b,I]=h.useState(!1),l=h.useRef(null),y=h.useRef(null),i=h.useRef(null);h.useEffect(()=>{const o=w=>{const k=w.target,V=l.current&&!l.current.contains(k),U=i.current&&!i.current.contains(k);if(V&&U)if(T(!1),I(!1),!p)t("");else{const B=d.find(D=>D.id.toString()===p);t((B==null?void 0:B.skuId)||"")}};return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[p,d]);const C=d.find(o=>o.id.toString()===p),P=v||(C==null?void 0:C.skuId)||"",R=v?d.filter(o=>{var w,k;return((w=o.skuId)==null?void 0:w.toLowerCase().includes(v.toLowerCase()))||((k=o.itemName)==null?void 0:k.toLowerCase().includes(v.toLowerCase()))}):d;return e.jsxs("div",{ref:l,className:"relative sku-dropdown-container w-full min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("div",{className:"flex gap-1.5 items-start",children:e.jsxs("div",{className:"flex-1 relative min-w-0",children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsxs("div",{className:"flex-1 relative min-w-0",children:[e.jsx("input",{ref:y,type:"text",value:P,onChange:o=>{I(!0),t(o.target.value),T(!1),o.target.value||(c(),I(!1))},onFocus:()=>{},onBlur:o=>{const w=o.relatedTarget,k=i.current&&(i.current.contains(w)||w===i.current);setTimeout(()=>{k||I(!1)},200)},placeholder:"Search SKU...",className:"w-full px-2.5 py-1.5 pr-8 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"}),(v||p)&&e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),t(""),c(),T(!1)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"w-3 h-3"})})]}),e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),T(w=>!w),t(""),I(!1)},className:"px-2 py-1.5 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 border border-gray-300",title:"Show all SKUs",children:e.jsx(oe,{className:`w-3.5 h-3.5 transition-transform ${x?"rotate-180":""}`})})]}),b&&v&&v.length>0&&!x&&e.jsxs("div",{ref:i,className:"absolute z-[100] top-full left-0 mt-1 w-full min-w-[200px] max-w-full bg-white border border-gray-300 rounded-lg shadow-xl max-h-48 overflow-y-auto",style:{position:"absolute"},children:[R.slice(0,50).map(o=>e.jsxs("div",{onMouseDown:w=>{w.preventDefault(),w.stopPropagation()},onClick:w=>{w.stopPropagation(),g(o.id.toString()),t(""),T(!1),I(!1)},className:"px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:o.skuId}),o.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:o.itemName})]},o.id)),R.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs found"})]}),x&&e.jsxs("div",{ref:i,className:"absolute z-[100] top-full left-0 mt-1 w-full min-w-[200px] max-w-full bg-white border border-gray-300 rounded-lg shadow-xl max-h-48 overflow-y-auto",style:{position:"absolute"},children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-3 py-2 flex items-center justify-between z-10",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700",children:"Select SKU"}),e.jsx("button",{onClick:o=>{o.stopPropagation(),T(!1)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(W,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"max-h-[calc(192px-40px)] overflow-y-auto",children:d.length===0?e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs available"}):d.map(o=>e.jsxs("div",{onMouseDown:w=>{w.preventDefault(),w.stopPropagation()},onClick:w=>{w.stopPropagation(),g(o.id.toString()),t(""),T(!1),I(!1)},className:`px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 ${p===o.id.toString()?"bg-blue-50":""}`,children:[e.jsx("div",{className:"font-medium",children:o.skuId}),o.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:o.itemName})]},o.id))})]})]})})]})},Me=({item:r,index:p,skus:d,canRemove:g,isAdmin:c,hasPriceHistory:v,onRemove:t,onItemChange:x,onPriceHistoryClick:T,validateTotalQuantity:b})=>{const I=b(r);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type="number"] {
          -moz-appearance: textfield;
        }
      `}),e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-[auto_2fr_auto_1fr_1fr_1fr_auto_1fr_auto_1fr_1fr_1fr_1fr_auto_1fr_1fr_auto] gap-3 items-end min-w-0 w-full",children:[e.jsx("div",{className:"flex items-center pb-1",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:["#",p+1]})}),e.jsx("div",{className:"min-w-0",children:e.jsx(He,{itemId:r.id,skuId:r.skuId,skus:d,onSkuChange:l=>{const y=d.find(i=>i.id.toString()===l);if(x("skuId",l),x("itemName",(y==null?void 0:y.itemName)||""),y){const i=y.gstRate??y.gst_rate??y.gstRatePercentage??y.gst_rate_percentage;i!=null&&x("gstRate",parseFloat(i)||0)}},onClear:()=>{x("skuId",""),x("itemName",""),x("gstRate",0)}})}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Ordered Qty"}),e.jsx("input",{type:"number",min:"0",max:"100000000",value:r.orderedQuantity,onChange:l=>{const y=parseInt(l.target.value)||0,i=Math.min(y,1e8);x("orderedQuantity",i),x("totalQuantity",i);const C=Math.max(0,i-(r.received||0));x("short",C),x("total",i)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0",required:!0})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Rec. Qty"}),e.jsx("input",{type:"number",min:"0",max:r.orderedQuantity||0,value:r.received,onChange:l=>{const y=parseInt(l.target.value)||0,i=r.orderedQuantity||0,C=Math.min(y,i);x("received",C);const P=Math.max(0,(r.orderedQuantity||0)-C);x("short",P)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0",required:!0})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Short Qty"}),e.jsx("input",{type:"number",value:r.short,readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50",required:!0})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium text-gray-700 mb-1",children:["Unit Price (Excl GST)",c&&r.skuId&&v&&e.jsx("button",{type:"button",onClick:T,className:"text-blue-600 hover:text-blue-800",title:"View price history",children:e.jsx(_e,{className:"w-3 h-3"})})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100000000",value:r.unitPrice,onChange:l=>{const y=parseFloat(l.target.value)||0,i=Math.min(y,1e8);x("unitPrice",i)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0",required:!0})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"GST %"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",value:r.gstRate,onChange:l=>{const y=parseFloat(l.target.value)||0;x("gstRate",y)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total (Excl GST)"}),e.jsx("input",{type:"text",value:r.totalExclGst.toFixed(2),readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"GST Amount"}),e.jsx("input",{type:"text",value:r.gstAmount.toFixed(2),readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total (Incl GST)"}),e.jsx("input",{type:"text",value:r.totalInclGst.toFixed(2),readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50 font-semibold",required:!0})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Boxes Ord"}),e.jsx("input",{type:"number",min:"0",max:"1000000",value:r.numberOfBoxes,onChange:l=>{const y=parseInt(l.target.value)||0,i=Math.min(y,1e6);x("numberOfBoxes",i)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Boxes Rec"}),e.jsx("input",{type:"number",min:"0",max:r.numberOfBoxes||0,value:r.receivedBoxes,onChange:l=>{const y=parseInt(l.target.value)||0,i=r.numberOfBoxes||0,C=Math.min(y,i);x("receivedBoxes",C)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsx("div",{className:"flex items-center justify-center pb-1",children:g?e.jsx("button",{type:"button",onClick:t,className:"text-red-600 hover:text-red-800 transition-colors",title:"Remove Item",children:e.jsx(Re,{className:"w-4 h-4"})}):e.jsxs(e.Fragment,{children:[r.orderedQuantity>0&&!I&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5",title:"Ordered Quantity must equal sum",children:[e.jsx(Ae,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-500 text-[10px]",children:"Invalid"})]}),r.orderedQuantity>0&&I&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5",title:"Validation passed",children:[e.jsx(Be,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 text-[10px]",children:"Valid"})]}),r.orderedQuantity===0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Exp: ",(r.received||0)+(r.short||0)]})]})})]})})]})},Ke=({items:r,skus:p,isAdmin:d,priceHistoryMap:g,onAddItem:c,onRemoveItem:v,onItemChange:t,onPriceHistoryClick:x,validateTotalQuantity:T})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Item Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:c,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsxs("div",{className:"space-y-3",children:[r.map((b,I)=>e.jsx(Me,{item:b,index:I,skus:p,canRemove:r.length>1,isAdmin:d,hasPriceHistory:g[b.skuId]||!1,onRemove:()=>v(b.id),onItemChange:(l,y)=>t(b.id,l,y),onPriceHistoryClick:()=>x(b),validateTotalQuantity:T},b.id)),r.length>0&&(()=>{const b=r.reduce((y,i)=>y+parseFloat((i.totalExclGst||0).toFixed(2)),0),I=r.reduce((y,i)=>y+parseFloat((i.gstAmount||0).toFixed(2)),0),l=r.reduce((y,i)=>y+parseFloat((i.totalInclGst||0).toFixed(2)),0);return e.jsx("div",{className:"mt-6 mb-4 flex justify-end",children:e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-5 shadow-sm min-w-[300px]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Subtotal (Excl GST)"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["₹",b.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total GST Amount"}),e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["₹",I.toFixed(2)]})]}),e.jsx("div",{className:"border-t border-gray-300 pt-4 mt-3",children:e.jsxs("div",{className:"flex justify-between items-center gap-8",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900",children:"Grand Total (Incl GST)"}),e.jsxs("span",{className:"text-base font-bold text-gray-900",children:["₹",l.toFixed(2)]})]})})]})})})})()]})]}),$e=({formData:r,teams:p,onFormDataChange:d})=>{const g=X();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Additional Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Received By ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.receivedBy,onChange:c=>d({receivedBy:c.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Team from Library"}),p.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsx("button",{type:"button",onClick:()=>g("/app/library?tab=teams"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(J,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{value:r.remarks,onChange:c=>d({remarks:c.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter any additional remarks"})]})]})]})},Le=({loading:r,isValid:p,hasItems:d,onSaveDraft:g,onSubmit:c})=>{const v=X();return e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>v("/app/inventory"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:g,disabled:r||!d,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:c,disabled:r||!d||!p,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:!p&&d?"Please ensure all Total Quantity fields match their calculated sums":"",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-5 h-5"}),"Submit"]})})]})},ze=({dateFrom:r,dateTo:p,filterVendor:d,filterSKU:g,vendors:c,onDateFromChange:v,onDateToChange:t,onFilterVendorChange:x,onFilterSKUChange:T})=>e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),e.jsx("input",{type:"date",value:r,onChange:b=>v(b.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),e.jsx("input",{type:"date",value:p,onChange:b=>t(b.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),e.jsxs("select",{value:d,onChange:b=>x(b.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Vendors"}),c.map(b=>e.jsx("option",{value:b.id,children:b.name},b.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:g,onChange:b=>T(b.target.value),placeholder:"Search SKU",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),Ye=({loading:r,history:p,expandedRows:d,rowItems:g,editingItem:c,editFormData:v,onToggleRow:t,onEditShort:x,onSaveEdit:T,onCancelEdit:b,onMoveToRejected:I,onEditFormDataChange:l,getChallanCount:y})=>e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Total Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Received Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Receiving Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Received By"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})})})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:"No history found"})}):p.map(i=>{const C=d[i.id],P=g[i.id]||[],R=y(P);return e.jsxs(Pe.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>t(i.id),className:"text-gray-600 hover:text-gray-900",children:C?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(Qe,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Q(i.invoice_date||i.date)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:i.invoice_number||i.invoiceNumber}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i.total_quantity||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:i.received_quantity||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:i.vendor_name||i.vendor||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:Q(i.receiving_date||i.date)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:i.received_by_name||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:Y(i.total_value||0)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${i.status==="Pending"||i.total_short>0?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:i.status==="Pending"||i.total_short>0?"Pending":"Complete"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(i.id),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"View Details",children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-green-600 hover:text-green-800 flex items-center gap-1",title:"Download",children:e.jsx(Ge,{className:"w-4 h-4"})})]})})]}),C&&e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-4 bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h4",{className:"text-sm font-semibold text-gray-700",children:["Items (",P.length,") - Challans: ",R]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Received"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Short"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Challan Number"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"Loading items..."})}):P.map(o=>{const w=(c==null?void 0:c.inventoryId)===i.id&&(c==null?void 0:c.itemId)===(o.itemId||o.item_id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:o.skuCode||o.sku_code||o.skuId||"N/A"}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:o.itemName||o.item_name||"N/A"}),w?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:v.received,onChange:k=>l({received:parseInt(k.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded",min:"0"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:v.short,onChange:k=>l({short:parseInt(k.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded",min:"0"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"date",value:v.challanDate,onChange:k=>l({challanDate:k.target.value}),className:"w-32 px-2 py-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:v.challanNumber,onChange:k=>l({challanNumber:k.target.value}),className:"w-32 px-2 py-1 border border-gray-300 rounded",placeholder:"Challan Number"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:T,className:"text-green-600 hover:text-green-800",title:"Save",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:b,className:"text-red-600 hover:text-red-800",title:"Cancel",children:e.jsx(W,{className:"w-4 h-4"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:o.received||0}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:o.short||0}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:o.challanDate||o.challan_date?Q(o.challanDate||o.challan_date):"N/A"}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:o.challanNumber||o.challan_number||"N/A"}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[(o.short||0)>0&&e.jsx("button",{onClick:()=>I(i.id,o.itemId||o.item_id),className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 border border-orange-300 rounded hover:bg-orange-50",title:"Move to Rejected",children:"Move to Rejected"}),(o.short||0)>0&&e.jsx("button",{onClick:()=>x(i.id,o),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(Fe,{className:"w-4 h-4"})})]})})]})]},o.itemId||o.item_id)})})]})})]})})})]},i.id)})})]})})}),Je=({isOpen:r,loading:p,data:d,onClose:g})=>r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Buying Price History"}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-lg hover:bg-gray-100","aria-label":"Close",children:e.jsx(W,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:p?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):d?e.jsxs("div",{className:"space-y-4",children:[d.current&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#E8F0FE"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#1A73E8"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#1A73E8"},children:"Current Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:Y(d.current.price)})," from ",e.jsx("span",{className:"font-medium",children:d.current.vendorName})," on ",e.jsx("span",{className:"font-medium",children:Q(d.current.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:d.current.invoiceNumber}),")"]})]})]})}),d.previous&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#F5F5F5"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#9E9E9E"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#9E9E9E"},children:"Previously Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:Y(d.previous.price)})," from ",e.jsx("span",{className:"font-medium",children:d.previous.vendorName})," on ",e.jsx("span",{className:"font-medium",children:Q(d.previous.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:d.previous.invoiceNumber}),")"]})]})]})}),d.lowest&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#E8F5E9"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#43A047"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#43A047"},children:"Lowest Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:Y(d.lowest.price)})," from ",e.jsx("span",{className:"font-medium",children:d.lowest.vendorName})," on ",e.jsx("span",{className:"font-medium",children:Q(d.lowest.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:d.lowest.invoiceNumber}),")"]})]})]})}),!d.current&&!d.previous&&!d.lowest&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No buying price history found for this SKU."})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Failed to load price history."})})}),e.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-100 bg-gray-50",children:e.jsx("button",{onClick:g,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm hover:shadow-md",children:"Close"})})]})}):null,bt=()=>{const r=X(),[p,d]=h.useState("add"),[g,c]=h.useState(!1),v=()=>({id:Date.now().toString(),skuId:"",itemName:"",orderedQuantity:0,received:0,short:0,total:0,totalQuantity:0,unitPrice:0,totalExclGst:0,gstRate:0,gstAmount:0,totalInclGst:0,totalValue:0,numberOfBoxes:0,receivedBoxes:0}),[t,x]=h.useState({documentType:"bill",documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:"vendor",destinationId:"",invoiceDate:new Date().toISOString().split("T")[0],invoiceNumber:"",docketNumber:"",transportorName:"",vendorId:"",brandId:"",warranty:0,warrantyUnit:"months",receivingDate:new Date().toISOString().split("T")[0],useCurrentDate:!0,receivedBy:"",remarks:"",items:[v()]}),[T,b]=h.useState([]),[I,l]=h.useState([]),[y,i]=h.useState([]),[C,P]=h.useState([]),[R,o]=h.useState([]),[w,k]=h.useState([]),[V,U]=h.useState({}),[B,D]=h.useState({}),[G,Z]=h.useState(null),[F,ee]=h.useState({received:0,short:0,challanNumber:"",challanDate:""}),[A,ce]=h.useState(null),[ue,ne]=h.useState({}),[te,q]=h.useState({isOpen:!1,skuId:"",loading:!1,data:null}),[H,xe]=h.useState(""),[M,me]=h.useState(""),[K,pe]=h.useState(""),[$,ye]=h.useState("");h.useEffect(()=>{ge(),he()},[]);const he=()=>{const a=localStorage.getItem("user")||sessionStorage.getItem("user");if(a)try{const s=JSON.parse(a);ce(s)}catch(s){console.error("Error parsing user data:",s)}},se=()=>(A==null?void 0:A.role)==="admin"||(A==null?void 0:A.role)==="super_admin";h.useEffect(()=>{(async()=>{if(!se())return;const s=t.items.filter(m=>m.skuId).map(async m=>{try{const S=await _.hasPriceHistory(m.skuId);S.success&&ne(u=>({...u,[m.skuId]:S.data.hasHistory}))}catch(S){console.error(`Error checking price history for SKU ${m.skuId}:`,S)}});await Promise.all(s)})()},[t.items,A]),h.useEffect(()=>{p==="history"&&re()},[p,H,M,K,$]),h.useEffect(()=>{t.documentType==="transfer_note"?x(a=>({...a,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:"vendor",destinationId:""})):x(a=>({...a,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:a.documentType==="bill"?"vendor":"customer",destinationId:""}))},[t.documentType]),h.useEffect(()=>{t.documentType==="bill"?t.documentSubType==="from_vendor"?x(a=>({...a,destinationType:"vendor",destinationId:"",vendorSubType:"purchase_receipt"})):t.documentSubType==="from_customer"&&x(a=>({...a,destinationType:"customer",destinationId:"",vendorSubType:""})):t.documentType==="delivery_challan"&&(t.documentSubType==="sample"?x(a=>({...a,deliveryChallanSubType:"",destinationId:""})):t.documentSubType==="replace"&&x(a=>({...a,destinationType:"customer",deliveryChallanSubType:"",destinationId:""})))},[t.documentSubType]),h.useEffect(()=>{t.documentType==="delivery_challan"&&t.documentSubType==="sample"&&(t.deliveryChallanSubType==="vendor"?x(a=>({...a,destinationType:"vendor",destinationId:""})):t.deliveryChallanSubType==="customer"&&x(a=>({...a,destinationType:"customer",destinationId:""})))},[t.deliveryChallanSubType]);const ge=async()=>{try{const[a,s,m,S,u]=await Promise.all([z.getYourVendors(),z.getCustomers(),z.getYourBrands(),z.getTeams(),Ee.getAll({limit:1e3})]);b(Array.isArray(a)?a:(a==null?void 0:a.data)||[]),l(Array.isArray(s)?s:(s==null?void 0:s.data)||[]),i(Array.isArray(m)?m:(m==null?void 0:m.data)||[]),P(Array.isArray(S)?S:(S==null?void 0:S.data)||[]),o(Array.isArray(u)?u:(u==null?void 0:u.data)||[])}catch(a){console.error("Error loading initial data:",a)}},re=async()=>{try{c(!0);const a={};H&&(a.dateFrom=H),M&&(a.dateTo=M),K&&(a.vendor=K),$&&(a.sku=$);const s=await _.getIncomingHistory(a);k(s.data||[]),U({}),D({})}catch(a){console.error("Error loading history:",a),k([])}finally{c(!1)}},ae=async a=>{try{const s=await _.getIncomingItems(a);D(m=>({...m,[a]:s.data||[]}))}catch(s){console.error("Error loading items:",s),D(m=>({...m,[a]:[]}))}},be=async a=>{const s=V[a];U(m=>({...m,[a]:!s})),!s&&!B[a]&&await ae(a)},fe=async(a,s)=>{var m,S;if(confirm("Are you sure you want to move this short quantity to rejected? This will update the stock."))try{c(!0),await _.moveShortToRejected(a,s),await ae(a),await re(),alert("Short quantity moved to rejected successfully. Stock has been updated.")}catch(u){console.error("Error moving to rejected:",u),alert(((S=(m=u.response)==null?void 0:m.data)==null?void 0:S.error)||"Failed to move short to rejected")}finally{c(!1)}},ve=(a,s)=>{Z({inventoryId:a,itemId:s.itemId||s.item_id}),ee({received:s.received||0,short:s.short||0,challanNumber:s.challanNumber||s.challan_number||"",challanDate:s.challanDate||s.challan_date||""})},je=async()=>{var a,s;if(G)try{c(!0),await _.updateShortItem(G.inventoryId,{itemId:G.itemId,received:F.received,short:F.short,challanNumber:F.challanNumber,challanDate:F.challanDate}),await ae(G.inventoryId),await re(),Z(null),alert("Short item updated successfully. Stock has been updated.")}catch(m){console.error("Error updating short item:",m),alert(((s=(a=m.response)==null?void 0:a.data)==null?void 0:s.error)||"Failed to update short item")}finally{c(!1)}},Ne=()=>{Z(null),ee({received:0,short:0,challanNumber:"",challanDate:""})},we=a=>a?new Set(a.filter(m=>m.challanNumber||m.challan_number).map(m=>m.challanNumber||m.challan_number)).size:0,Se=()=>{const a=v();x(s=>({...s,items:[...s.items,a]}))},Te=a=>{x(s=>{const m=s.items.filter(S=>S.id!==a);return m.length===0?{...s,items:[v()]}:{...s,items:m}})},Ie=(a,s,m)=>{x(S=>({...S,items:S.items.map(u=>{if(u.id===a){const f={...u,[s]:m};if(s==="skuId"){const N=R.find(L=>L.id.toString()===m);f.itemName=(N==null?void 0:N.itemName)||"";const O=(N==null?void 0:N.gstRate)??(N==null?void 0:N.gst_rate)??(N==null?void 0:N.gstRatePercentage)??(N==null?void 0:N.gst_rate_percentage);if(O!=null){const L=parseFloat(O);isNaN(L)||(f.gstRate=L)}}(s==="received"||s==="orderedQuantity")&&(f.short=Math.max(0,(f.orderedQuantity||0)-(f.received||0)),f.total=f.orderedQuantity||0,f.totalQuantity=f.orderedQuantity||0);const E=f.orderedQuantity||0,n=f.unitPrice||0,j=f.gstRate||0;return(s==="orderedQuantity"||s==="unitPrice"||s==="gstRate"||s==="skuId")&&(f.totalExclGst=E*n,f.gstAmount=f.totalExclGst*(j/100),f.totalInclGst=f.totalExclGst+f.gstAmount,f.totalValue=f.totalInclGst),f}return u})}))},le=a=>{const s=(a.received||0)+(a.short||0);return a.orderedQuantity===s},ke=()=>!t.documentType||t.documentType==="bill"&&!t.documentSubType||t.documentType==="delivery_challan"&&!t.documentSubType||!t.invoiceDate||!t.invoiceNumber.trim()||!t.docketNumber.trim()||!t.transportorName.trim()||!t.receivingDate||t.documentType==="bill"&&t.documentSubType==="from_vendor"&&(!t.vendorId||!t.brandId)||t.documentType==="bill"&&t.documentSubType==="from_customer"&&!t.destinationId||!t.receivedBy||t.items.length===0?!1:t.items.every(s=>!s.skuId||s.orderedQuantity===void 0||s.orderedQuantity===null||s.orderedQuantity===0||s.received===void 0||s.received===null||s.short===void 0||s.short===null||s.unitPrice===void 0||s.unitPrice===null||s.unitPrice===0||s.totalInclGst===void 0||s.totalInclGst===null||s.totalInclGst===0?!1:le(s)),ie=async(a=!1)=>{var s,m,S;if(!a){if(!t.documentType){alert("Please select Document Type.");return}if(t.documentType==="bill"&&!t.documentSubType){alert("Please select Type (From Vendor or From Customer).");return}if(!t.invoiceDate){alert("Please enter Invoice/Challan Date.");return}if(!t.invoiceNumber.trim()){alert("Please enter Invoice/Challan Number.");return}if(!t.docketNumber.trim()){alert("Please enter Docket Number.");return}if(!t.transportorName.trim()){alert("Please enter Transportor Name.");return}if(!t.receivingDate){alert("Please select Receiving Date.");return}if(t.documentType==="bill"&&t.documentSubType==="from_vendor"){if(!t.vendorId){alert("Please select a Vendor.");return}if(!t.brandId){alert("Please select a Brand.");return}}if(t.documentType==="bill"&&t.documentSubType==="from_customer"&&!t.destinationId){alert("Please select a Customer.");return}if(!t.receivedBy){alert("Please select Received By.");return}if(t.items.length===0){alert("Please add at least one item.");return}for(const u of t.items){if(!u.skuId){alert("Please select SKU for all items.");return}if(u.orderedQuantity===void 0||u.orderedQuantity===null||u.orderedQuantity===0){alert("Please enter Ordered Quantity for all items.");return}if(u.received===void 0||u.received===null){alert("Please enter Received quantity for all items.");return}if(u.short===void 0||u.short===null){alert("Please ensure Short quantity is calculated for all items.");return}if(u.unitPrice===void 0||u.unitPrice===null||u.unitPrice===0){alert("Please enter Unit Price (Excl GST) for all items.");return}if(u.totalInclGst===void 0||u.totalInclGst===null||u.totalInclGst===0){alert("Please ensure Total (Incl GST) is calculated for all items.");return}if(!le(u)){alert("Please ensure all Ordered Quantity fields match their calculated sums (Received + Short).");return}}}try{c(!0);const u=n=>n==null||typeof n=="string"&&n.trim()===""?null:n,f={invoiceDate:t.invoiceDate,invoiceNumber:t.invoiceNumber,docketNumber:u(t.docketNumber),transportorName:u(t.transportorName),vendorId:t.vendorId?typeof t.vendorId=="string"?parseInt(t.vendorId,10):t.vendorId:null,brandId:t.brandId?typeof t.brandId=="string"?parseInt(t.brandId,10):t.brandId:null,warranty:t.warranty?typeof t.warranty=="string"?parseInt(t.warranty,10):t.warranty:0,warrantyUnit:t.warrantyUnit||"months",receivingDate:t.receivingDate,receivedBy:t.receivedBy?typeof t.receivedBy=="string"?parseInt(t.receivedBy,10):t.receivedBy:null,remarks:u(t.remarks),documentType:t.documentType||"bill",documentSubType:u(t.documentSubType),vendorSubType:u(t.vendorSubType),deliveryChallanSubType:u(t.deliveryChallanSubType),destinationType:u(t.destinationType),destinationId:t.destinationId?typeof t.destinationId=="string"?parseInt(t.destinationId,10):t.destinationId:null,items:t.items.map(n=>({skuId:n.skuId?typeof n.skuId=="string"?parseInt(n.skuId,10):n.skuId:null,orderedQuantity:n.orderedQuantity?typeof n.orderedQuantity=="string"?parseInt(n.orderedQuantity,10):n.orderedQuantity:0,received:n.received?typeof n.received=="string"?parseInt(n.received,10):n.received:0,short:n.short?typeof n.short=="string"?parseInt(n.short,10):n.short:0,totalQuantity:n.orderedQuantity?typeof n.orderedQuantity=="string"?parseInt(n.orderedQuantity,10):n.orderedQuantity:0,unitPrice:n.unitPrice?typeof n.unitPrice=="string"?parseFloat(n.unitPrice):n.unitPrice:0,totalExclGst:n.totalExclGst?typeof n.totalExclGst=="string"?parseFloat(n.totalExclGst):n.totalExclGst:0,gstRate:n.gstRate?typeof n.gstRate=="string"?parseFloat(n.gstRate):n.gstRate:0,gstAmount:n.gstAmount?typeof n.gstAmount=="string"?parseFloat(n.gstAmount):n.gstAmount:0,totalInclGst:n.totalInclGst?typeof n.totalInclGst=="string"?parseFloat(n.totalInclGst):n.totalInclGst:0,numberOfBoxes:n.numberOfBoxes?typeof n.numberOfBoxes=="string"?parseInt(n.numberOfBoxes,10):n.numberOfBoxes:0,receivedBoxes:n.receivedBoxes?typeof n.receivedBoxes=="string"?parseInt(n.receivedBoxes,10):n.receivedBoxes:0})),status:a?"draft":"completed"};if((await _.addIncoming(f)).success&&se()){const n=t.items.filter(j=>j.skuId).map(async j=>{try{const N=await _.hasPriceHistory(j.skuId);N.success&&ne(O=>({...O,[j.skuId]:N.data.hasHistory}))}catch(N){console.error(`Error checking price history for SKU ${j.skuId}:`,N)}});await Promise.all(n)}r("/app/inventory")}catch(u){console.error("Error submitting incoming inventory:",u),console.error("Full error response:",(s=u.response)==null?void 0:s.data);let f="Failed to submit incoming inventory",E="";if((m=u.response)!=null&&m.data){const j=u.response.data;if(f=j.message||j.error||f,j.details){if(typeof j.details=="string")E=j.details;else if(typeof j.details=="object"){const N=[];j.details.originalError&&N.push(`Error: ${j.details.originalError}`),j.details.hint&&N.push(`Hint: ${j.details.hint}`),j.details.detail&&N.push(`Detail: ${j.details.detail}`),j.details.code&&N.push(`Code: ${j.details.code}`),E=N.join(`
`)}}(j.error==="DATABASE_SCHEMA_ERROR"||j.error==="DATABASE_ERROR")&&(f=j.message||"Database configuration error",(S=j.details)!=null&&S.hint&&(E=j.details.hint))}else u.message&&(f=u.message);const n=E?`${f}

${E}`:f;alert(n)}finally{c(!1)}},Ce=async a=>{q({isOpen:!0,skuId:a.skuId,loading:!0,data:null});try{const s=await _.getPriceHistory(a.skuId);q(m=>({...m,loading:!1,data:s.data}))}catch(s){console.error("Error loading price history:",s),q(m=>({...m,loading:!1,data:null}))}};return e.jsxs("div",{className:"p-8 space-y-10 w-full animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("style",{children:`
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type="number"] {
          -moz-appearance: textfield;
        }
      `}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/app/inventory"),className:"text-slate-600 hover:text-indigo-600 transition-colors",children:e.jsx(Oe,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-[28.8px] font-semibold leading-[1.2] tracking-[-0.01em] text-slate-900",children:"Incoming Inventory"})]}),e.jsx("p",{className:"text-[16.8px] font-normal leading-[1.5] text-slate-500",children:"Record and manage incoming stock from vendors and suppliers."})]})}),e.jsx("div",{className:"bg-white rounded-[2.5rem] border border-slate-100 shadow-sm p-2",children:e.jsxs("nav",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>d("add"),className:`px-6 py-3 rounded-2xl font-black text-[15.6px] uppercase tracking-wider transition-all ${p==="add"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"Add New"}),e.jsx("button",{onClick:()=>d("history"),className:`px-6 py-3 rounded-2xl font-black text-[15.6px] uppercase tracking-wider transition-all ${p==="history"?"bg-indigo-600 text-white shadow-lg shadow-indigo-600/20":"text-slate-500 hover:bg-slate-50"}`,children:"History"})]})}),p==="add"&&e.jsxs("form",{className:"space-y-6",children:[e.jsx(Ve,{formData:t,vendors:T,customers:I,brands:y,onFormDataChange:a=>x(s=>({...s,...a}))}),e.jsx(Ue,{formData:t,onFormDataChange:a=>x(s=>({...s,...a}))}),e.jsx(qe,{formData:t,onFormDataChange:a=>x(s=>({...s,...a}))}),e.jsx(Ke,{items:t.items,skus:R,isAdmin:se(),priceHistoryMap:ue,onAddItem:Se,onRemoveItem:Te,onItemChange:Ie,onPriceHistoryClick:Ce,validateTotalQuantity:le}),e.jsx($e,{formData:t,teams:C,onFormDataChange:a=>x(s=>({...s,...a}))}),e.jsx(Le,{loading:g,isValid:ke(),hasItems:t.items.length>0,onSaveDraft:()=>ie(!0),onSubmit:()=>ie(!1)})]}),p==="history"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(ze,{dateFrom:H,dateTo:M,filterVendor:K,filterSKU:$,vendors:T,onDateFromChange:xe,onDateToChange:me,onFilterVendorChange:pe,onFilterSKUChange:ye}),e.jsx(Ye,{loading:g,history:w,expandedRows:V,rowItems:B,editingItem:G,editFormData:F,onToggleRow:be,onEditShort:ve,onSaveEdit:je,onCancelEdit:Ne,onMoveToRejected:fe,onEditFormDataChange:a=>ee(s=>({...s,...a})),getChallanCount:we})]}),e.jsx(Je,{isOpen:te.isOpen,loading:te.loading,data:te.data,onClose:()=>q({isOpen:!1,skuId:"",loading:!1,data:null})})]})};export{bt as default};
