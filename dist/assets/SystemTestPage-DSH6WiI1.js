import{c as B,u as Y,r as A,j as a,F as T}from"./index-BNvq7L73.js";import{i as p}from"./inventoryService-B58imFTr.js";import{s as K}from"./skuService-BaVM3Gme.js";import{a as N}from"./api-BJ7xcL-N.js";import{A as Z}from"./arrow-left-BgDROCgl.js";import{R as _}from"./refresh-cw-C6itDSXN.js";import{D as v}from"./database-D0mIIQLS.js";import{A as tt}from"./alert-circle-CvwkvtqH.js";import{X as et}from"./x-circle-D_y5PVN5.js";import{C as at}from"./check-circle-DUrU9tOR.js";import"./cachedApi-DyAQX7TM.js";import"./inventoryEvents-fOALNsvn.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=B("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),pt=()=>{const L=Y(),[w,D]=A.useState(!1),[x,I]=A.useState([]),[b,X]=A.useState(null),k=async(t,e)=>{const n=Date.now();try{const o=await e(),c=Date.now()-n;return{...o,duration:c}}catch(o){const c=Date.now()-n;return{name:t,status:"fail",message:o.message||"Test failed",duration:c}}},F=async()=>{try{const t=await N.get("/health");return t.data&&t.status===200?{name:"API Health Check",status:"pass",message:"API is responding",data:t.data}:{name:"API Health Check",status:"fail",message:"API returned unexpected response"}}catch(t){return{name:"API Health Check",status:"fail",message:t.message||"API is not responding"}}},C=async()=>{try{const t=new Date,e=new Date(t);e.setMonth(t.getMonth()-3);const n=e.toISOString().split("T")[0],o=t.toISOString().split("T")[0],s=(await p.getIncomingHistory({dateFrom:n,dateTo:o})).data||[],i=s.length>0&&(s[0].totalValueExclGst!==void 0||s[0].total_value_excl_gst!==void 0||s[0].gstAmount!==void 0||s[0].gst_amount!==void 0),l=s.filter(r=>!r.totalValueExclGst&&!r.total_value_excl_gst).length;return{name:"Incoming History API",status:i&&l===0?"pass":l>0?"warning":"fail",message:`Found ${s.length} records. ${l>0?`${l} records missing GST fields`:"GST fields present"}`,data:{totalRecords:s.length,hasGSTFields:i,missingGSTCount:l,sampleRecord:s[0]||null}}}catch(t){return{name:"Incoming History API",status:"fail",message:t.message||"Failed to fetch incoming history"}}},G=async()=>{try{const t=new Date,e=new Date(t);e.setMonth(t.getMonth()-3);const n=e.toISOString().split("T")[0],o=t.toISOString().split("T")[0],s=(await p.getOutgoingHistory({dateFrom:n,dateTo:o})).data||[],i=s.length>0&&(s[0].date!==void 0||s[0].invoiceChallanDate!==void 0||s[0].invoice_challan_date!==void 0),l=s.length>0&&(s[0].totalValueExclGst!==void 0||s[0].total_value_excl_gst!==void 0||s[0].gstAmount!==void 0||s[0].gst_amount!==void 0),r=s.filter(u=>!u.date&&!u.invoiceChallanDate&&!u.invoice_challan_date).length,d=s.filter(u=>!u.totalValueExclGst&&!u.total_value_excl_gst).length,m=s.filter(u=>(u.totalValueExclGst||u.total_value_excl_gst||0)===0).length;return{name:"Outgoing History API (Sales)",status:i&&l&&r===0&&d===0?"pass":"warning",message:`Found ${s.length} records. Date field: ${i?"✓":"✗"}, GST fields: ${l?"✓":"✗"}. ${m} records with zero sales.`,data:{totalRecords:s.length,hasDateField:i,hasGSTFields:l,missingDateCount:r,missingGSTCount:d,zeroSalesCount:m,sampleRecord:s[0]||null}}}catch(t){return{name:"Outgoing History API (Sales)",status:"fail",message:t.message||"Failed to fetch outgoing history"}}},R=async()=>{try{const t=new Date,e=new Date(t);e.setMonth(t.getMonth()-3);const n=e.toISOString().split("T")[0],o=t.toISOString().split("T")[0],[c,s]=await Promise.all([p.getIncomingHistory({dateFrom:n,dateTo:o}),p.getOutgoingHistory({dateFrom:n,dateTo:o})]),i=c.data||[],l=s.data||[];let r=0,d=0,m=0,u=0;l.forEach(h=>{const S=parseFloat(h.totalValueExclGst||h.total_value_excl_gst||0),j=parseFloat(h.gstAmount||h.gst_amount||0);r+=S,m+=j}),i.forEach(h=>{const S=parseFloat(h.totalValueExclGst||h.total_value_excl_gst||0),j=parseFloat(h.gstAmount||h.gst_amount||0);d+=S,u+=j});const f=r-d,y=m-u,g=[];return r===0&&l.length>0&&g.push("Sales revenue is zero but records exist"),m<0&&g.push("Output GST is negative (data issue)"),u<0&&g.push("Input GST is negative (data issue)"),{name:"Finance Calculations",status:g.length===0?"pass":"warning",message:g.length>0?g.join(", "):"Calculations are correct",data:{totalRevenueExclGST:r,totalExpensesExclGST:d,totalGrossProfit:f,totalOutputGST:m,totalInputGST:u,netGST:y,incomingRecords:i.length,outgoingRecords:l.length}}}catch(t){return{name:"Finance Calculations",status:"fail",message:t.message||"Failed to calculate finance data"}}},M=async()=>{try{const t=new Date,e=new Date(t);e.setMonth(t.getMonth()-3);const n=e.toISOString().split("T")[0],o=t.toISOString().split("T")[0],[c,s]=await Promise.all([p.getIncomingHistory({dateFrom:n,dateTo:o}),p.getOutgoingHistory({dateFrom:n,dateTo:o})]),i=c.data||[],l=s.data||[],r=[],d=[],m=l.filter(g=>parseFloat(g.gstAmount||g.gst_amount||0)<0).length,u=i.filter(g=>parseFloat(g.gstAmount||g.gst_amount||0)<0).length;m>0&&r.push(`${m} outgoing records have negative GST`),u>0&&r.push(`${u} incoming records have negative GST`);const f=l.filter(g=>!g.date&&!g.invoiceChallanDate&&!g.invoice_challan_date).length,y=i.filter(g=>!g.receivingDate&&!g.receiving_date&&!g.invoiceDate&&!g.invoice_date).length;return f>0&&d.push(`${f} outgoing records missing dates`),y>0&&d.push(`${y} incoming records missing dates`),{name:"Data Integrity Check",status:r.length===0?d.length>0?"warning":"pass":"fail",message:r.length>0?r.join(", "):d.length>0?d.join(", "):"Data integrity is good",data:{negativeOutputGST:m,negativeInputGST:u,missingOutgoingDates:f,missingIncomingDates:y,totalIncomingRecords:i.length,totalOutgoingRecords:l.length}}}catch(t){return{name:"Data Integrity Check",status:"fail",message:t.message||"Failed to check data integrity"}}},P=async()=>{try{const e=(await p.getOutgoingHistory({})).data||[];if(e.length===0)return{name:"Date Field Mapping",status:"warning",message:"No outgoing records to test"};const n=e[0],o=!!n.date,c=!!n.invoiceChallanDate,s=!!n.invoice_challan_date;return{name:"Date Field Mapping",status:o?"pass":"warning",message:o?"Date field is correctly mapped":"Date field may be missing - check field mapping",data:{fieldMapping:{date:o,invoiceChallanDate:c,invoice_challan_date:s},sampleRecord:n}}}catch(t){return{name:"Date Field Mapping",status:"fail",message:t.message||"Failed to check date field mapping"}}},H=async()=>{try{const e=(await K.getAll({limit:10})).data||[],n=e.length===0||e[0].skuId!==void 0||e[0].sku_id!==void 0||e[0].itemName!==void 0||e[0].item_name!==void 0,o=e.filter(c=>c.currentStock===void 0&&c.current_stock===void 0).length;return{name:"SKU API",status:n&&o===0?"pass":o>0?"warning":"fail",message:`Found ${e.length} SKUs. ${o>0?`${o} missing stock data`:"All fields present"}`,data:{totalSKUs:e.length,hasRequiredFields:n,missingStockCount:o,sampleSKU:e[0]||null}}}catch(t){return{name:"SKU API",status:"fail",message:t.message||"Failed to fetch SKUs"}}},O=async()=>{var t;try{if(!(localStorage.getItem("token")||sessionStorage.getItem("token")))return{name:"Authentication",status:"warning",message:"No authentication token found",data:{hasToken:!1}};const n=await N.get("/skus",{params:{limit:1}});return{name:"Authentication",status:n.status===200?"pass":"fail",message:n.status===200?"Authentication is working":"Authentication failed",data:{hasToken:!0,status:n.status}}}catch(e){return((t=e.response)==null?void 0:t.status)===401?{name:"Authentication",status:"fail",message:"Authentication token is invalid or expired"}:{name:"Authentication",status:"warning",message:e.message||"Could not verify authentication"}}},$=async()=>{try{const t=[{name:"Health",url:"/health"},{name:"SKUs",url:"/skus?limit=1"},{name:"Incoming History",url:"/inventory/incoming/history?limit=1"},{name:"Outgoing History",url:"/inventory/outgoing/history?limit=1"}],e=[];for(const s of t){const i=Date.now();try{await N.get(s.url);const l=Date.now()-i;e.push({name:s.name,duration:l,status:"success"})}catch(l){const r=Date.now()-i;e.push({name:s.name,duration:r,status:"error",error:l.message})}}const n=e.reduce((s,i)=>s+i.duration,0)/e.length,o=e.filter(s=>s.duration>2e3),c=e.filter(s=>s.status==="error");return{name:"API Response Time",status:c.length>0?"fail":o.length>0?"warning":"pass",message:c.length>0?`${c.length} endpoints failed`:o.length>0?`Average: ${Math.round(n)}ms. ${o.length} slow endpoints (>2s)`:`Average response time: ${Math.round(n)}ms (all good)`,data:{results:e,averageResponseTime:Math.round(n),slowEndpoints:o.length,failedEndpoints:c.length}}}catch(t){return{name:"API Response Time",status:"fail",message:t.message||"Failed to test response times"}}},E=async()=>{try{const[t,e,n]=await Promise.all([K.getAll({limit:100}).catch(()=>({data:[]})),p.getIncoming().catch(()=>({data:[]})),p.getOutgoing().catch(()=>({data:[]}))]),o=t.data||[],c=e.data||[],s=n.data||[],i=[];o.length===0&&i.push("No SKUs found"),c.length===0&&s.length===0&&i.push("No inventory data found");const l=o.filter(r=>{const d=r.currentStock||r.current_stock||0,m=r.minStockLevel||r.min_stock||0;return d>0&&d<=m}).length;return{name:"Dashboard Data",status:i.length===0?"pass":"warning",message:i.length>0?i.join(", "):`Dashboard data available: ${o.length} SKUs, ${c.length} incoming, ${s.length} outgoing. ${l} low stock items.`,data:{totalSKUs:o.length,totalIncoming:c.length,totalOutgoing:s.length,lowStockCount:l}}}catch(t){return{name:"Dashboard Data",status:"fail",message:t.message||"Failed to fetch dashboard data"}}},V=async()=>{try{const t=new Date,e=new Date(t);e.setMonth(t.getMonth()-1);const n=e.toISOString().split("T")[0],o=t.toISOString().split("T")[0],[c,s]=await Promise.all([p.getIncomingHistory({dateFrom:n,dateTo:o}),p.getOutgoingHistory({dateFrom:n,dateTo:o})]),i=c.data||[],l=s.data||[],r=[];let d=0;return l.forEach(m=>{const u=parseFloat(m.totalValueExclGst||m.total_value_excl_gst||0),f=parseFloat(m.gstAmount||m.gst_amount||0),y=parseFloat(m.gstPercentage||m.gst_percentage||0),g=parseFloat(m.totalValueInclGst||m.total_value_incl_gst||0);if(u>0&&y>0){const h=u*(y/100),S=u+h;Math.abs(f-h)>.01&&d++,Math.abs(g-S)>.01&&g>0&&d++}}),d>0&&r.push(`${d} records have incorrect GST calculations`),{name:"GST Calculation Validation",status:r.length===0?"pass":"warning",message:r.length>0?r.join(", "):`GST calculations are correct for ${l.length} sales records`,data:{totalOutgoingRecords:l.length,totalIncomingRecords:i.length,incorrectCalculations:d}}}catch(t){return{name:"GST Calculation Validation",status:"fail",message:t.message||"Failed to validate GST calculations"}}},U=async()=>{try{const t=new Date,e=new Date(t);e.setDate(t.getDate()+30);const n=t.toISOString().split("T")[0],o=e.toISOString().split("T")[0],s=(await p.getIncomingHistory({dateFrom:n,dateTo:o})).data||[],i=s.filter(l=>{const r=l.receivingDate||l.receiving_date;return r?new Date(r)>t:!1}).length;return{name:"Date Range Validation",status:i===0?"pass":"warning",message:i>0?`Found ${i} records with future dates (data issue)`:"Date ranges are valid",data:{totalRecords:s.length,futureRecords:i}}}catch(t){return{name:"Date Range Validation",status:"fail",message:t.message||"Failed to validate date ranges"}}},q=async()=>{D(!0),I([]);const t=[{name:"API Health",fn:F},{name:"Authentication",fn:O},{name:"SKU API",fn:H},{name:"Incoming History",fn:C},{name:"Outgoing History",fn:G},{name:"Finance Calculations",fn:R},{name:"Data Integrity",fn:M},{name:"Date Field Mapping",fn:P},{name:"API Response Time",fn:$},{name:"Dashboard Data",fn:E},{name:"GST Calculation Validation",fn:V},{name:"Date Range Validation",fn:U}],e=[];for(const n of t){const o=await k(n.name,n.fn);e.push(o),I([...e])}D(!1)},J=async t=>{D(!0);const e={"API Health":F,Authentication:O,"SKU API":H,"Incoming History":C,"Outgoing History":G,"Finance Calculations":R,"Data Integrity":M,"Date Field Mapping":P,"API Response Time":$,"Dashboard Data":E,"GST Calculation Validation":V,"Date Range Validation":U};if(e[t]){const n=await k(t,e[t]);I([n])}D(!1)},Q=t=>{switch(t){case"pass":return a.jsx(at,{className:"w-5 h-5 text-green-500"});case"fail":return a.jsx(et,{className:"w-5 h-5 text-red-500"});case"warning":return a.jsx(tt,{className:"w-5 h-5 text-yellow-500"});default:return a.jsx(_,{className:"w-5 h-5 text-gray-400 animate-spin"})}},W=t=>{switch(t){case"pass":return"bg-green-50 border-green-200";case"fail":return"bg-red-50 border-red-200";case"warning":return"bg-yellow-50 border-yellow-200";default:return"bg-gray-50 border-gray-200"}};return a.jsxs("div",{className:"p-8 space-y-6 w-full bg-gray-50 min-h-screen",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:()=>L("/app/dashboard"),className:"text-slate-600 hover:text-indigo-600 transition-colors",children:a.jsx(Z,{className:"w-6 h-6"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-[28.8px] font-bold leading-[1.2] tracking-tight text-slate-900",children:"System Test & Diagnostics"}),a.jsx("p",{className:"text-[14px] font-normal leading-[1.5] text-slate-500 mt-1",children:"Test system components, API endpoints, and data integrity"})]})]}),a.jsxs("button",{onClick:q,disabled:w,className:"px-6 py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[a.jsx(_,{className:`w-5 h-5 ${w?"animate-spin":""}`}),"Run All Tests"]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Quick Tests"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[{name:"API Health",icon:v},{name:"Authentication",icon:v},{name:"SKU API",icon:v},{name:"Incoming History",icon:T},{name:"Outgoing History",icon:T},{name:"Finance Calculations",icon:z},{name:"Data Integrity",icon:v},{name:"Date Field Mapping",icon:T},{name:"API Response Time",icon:v},{name:"Dashboard Data",icon:v},{name:"GST Calculation Validation",icon:z},{name:"Date Range Validation",icon:T}].map(t=>a.jsxs("button",{onClick:()=>J(t.name),disabled:w,className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50 flex flex-col items-center gap-2",children:[a.jsx(t.icon,{className:"w-6 h-6 text-indigo-600"}),a.jsx("span",{className:"text-xs font-medium text-gray-700 text-center",children:t.name})]},t.name))})]}),x.length>0&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Test Results"}),x.map((t,e)=>a.jsx("div",{className:`bg-white rounded-xl shadow-sm p-6 border-2 ${W(t.status)}`,children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[Q(t.status),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:t.name}),t.duration&&a.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.duration,"ms)"]})]}),a.jsx("p",{className:"text-sm text-gray-700 mb-3",children:t.message}),t.data&&a.jsxs("div",{className:"mt-4",children:[a.jsxs("button",{onClick:()=>X(b===t.name?null:t.name),className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:[b===t.name?"Hide":"Show"," Details"]}),b===t.name&&a.jsx("pre",{className:"mt-3 p-4 bg-gray-50 rounded-lg text-xs overflow-auto max-h-96 border border-gray-200",children:JSON.stringify(t.data,null,2)})]})]})]}),a.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${t.status==="pass"?"bg-green-100 text-green-700":t.status==="fail"?"bg-red-100 text-red-700":t.status==="warning"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"}`,children:t.status.toUpperCase()})]})},e))]}),x.length>0&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[a.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-4",children:"Test Summary"}),a.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-gray-900",children:x.length}),a.jsx("div",{className:"text-sm text-gray-500",children:"Total Tests"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-green-600",children:x.filter(t=>t.status==="pass").length}),a.jsx("div",{className:"text-sm text-gray-500",children:"Passed"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:x.filter(t=>t.status==="warning").length}),a.jsx("div",{className:"text-sm text-gray-500",children:"Warnings"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-3xl font-bold text-red-600",children:x.filter(t=>t.status==="fail").length}),a.jsx("div",{className:"text-sm text-gray-500",children:"Failed"})]})]})]}),w&&x.length===0&&a.jsx("div",{className:"flex justify-center items-center h-64",children:a.jsxs("div",{className:"text-center",children:[a.jsx(_,{className:"w-12 h-12 text-indigo-600 animate-spin mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Running tests..."})]})})]})};export{pt as default};
