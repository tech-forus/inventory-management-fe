import{u as T,d as $,r as t,j as e}from"./index-BNvq7L73.js";import{a as j}from"./api-BJ7xcL-N.js";import{X as y}from"./x-circle-D_y5PVN5.js";import{C as q}from"./check-circle-2-B5DaI6Em.js";import{L as N}from"./lock-C0-IBKT9.js";import{B as M}from"./building-2-zDs6-mdQ.js";import{M as O}from"./mail-GAFf_lEu.js";import{E as v}from"./eye-off-BMcvtH3b.js";import{E as P}from"./eye-yPZ_5C9M.js";const J=()=>{const x=T(),{token:c}=$(),[o,S]=t.useState({password:"",confirmPassword:""}),[n,h]=t.useState({}),[p,w]=t.useState(!1),[u,k]=t.useState(!1),[f,C]=t.useState(!1),[l,E]=t.useState(null),[I,b]=t.useState(!0),[F,L]=t.useState(!1),[m,d]=t.useState("");t.useEffect(()=>{(async()=>{var a,i;if(!c){d("Invalid token"),b(!1);return}try{const s=await j.get(`/users/verify-token/${c}`);s.data.success?(E(s.data.data),d("")):d(s.data.error||"Invalid or expired token")}catch(s){d(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.error)||"Invalid or expired token. Please request a new invitation.")}finally{b(!1)}})()},[c]);const g=r=>{const{name:a,value:i}=r.target;S(s=>({...s,[a]:i})),n[a]&&h(s=>({...s,[a]:""}))},B=()=>{const r={};return o.password?o.password.length<8&&(r.password="Password must be at least 8 characters long"):r.password="Password is required",o.confirmPassword?o.password!==o.confirmPassword&&(r.confirmPassword="Passwords do not match"):r.confirmPassword="Please confirm your password",h(r),Object.keys(r).length===0},D=async r=>{var a,i;if(r.preventDefault(),!!B()){w(!0),d("");try{(await j.post("/users/set-password",{token:c,password:o.password})).data.success&&(L(!0),setTimeout(()=>{x("/login",{state:{message:"Password set successfully! Please login with your credentials."}})},2e3))}catch(s){d(((i=(a=s.response)==null?void 0:a.data)==null?void 0:i.error)||"Failed to set password. Please try again.")}finally{w(!1)}}};return I?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verifying invitation link..."})]})}):m&&!l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx(y,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Invalid Link"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m}),e.jsx("button",{onClick:()=>x("/login"),className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Go to Login"})]})}):F?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx(q,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Password Set Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Redirecting to login page..."}),e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-[2.5rem] border border-slate-100 shadow-xl p-10 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-indigo-100 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(N,{className:"w-8 h-8 text-indigo-600"})}),e.jsx("h1",{className:"text-4xl font-black text-slate-900 tracking-tight mb-2",children:"Set Your Password"}),e.jsx("p",{className:"text-lg text-slate-500 font-medium",children:"Create a secure password for your account"})]}),l&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Company:"}),e.jsxs("span",{children:[l.companyName," (",l.companyId,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("span",{children:l.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsx("span",{children:l.name})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx("span",{children:m})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u?"text":"password",id:"password",name:"password",value:o.password,onChange:g,className:`w-full px-4 py-3 pr-12 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${n.password?"border-red-500":"border-gray-300"}`,placeholder:"Enter your password (min. 8 characters)"}),e.jsx("button",{type:"button",onClick:()=>k(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:u?e.jsx(v,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})})]}),n.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:f?"text":"password",id:"confirmPassword",name:"confirmPassword",value:o.confirmPassword,onChange:g,className:`w-full px-4 py-3 pr-12 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors ${n.confirmPassword?"border-red-500":"border-gray-300"}`,placeholder:"Confirm your password"}),e.jsx("button",{type:"button",onClick:()=>C(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:f?e.jsx(v,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})})]}),n.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.confirmPassword})]}),e.jsx("button",{type:"submit",disabled:p,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center gap-2",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Setting Password..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-5 h-5"}),"Set Password"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:()=>x("/login"),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Back to Login"})})]})})};export{J as default};
