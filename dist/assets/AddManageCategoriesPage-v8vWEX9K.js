import{c as fe,u as Ke,b as Ue,r as m,j as s,X as Ze}from"./index-v4UyLoar.js";import{l as N}from"./libraryService-BqxRzzIS.js";import{e as B}from"./categoriesEvents-i2FsXa12.js";import{A as qe}from"./arrow-left-CQGXFyIF.js";import{S as G}from"./save-4D8tpIMf.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=fe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=fe("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);function x(y){return A(y).trim().replace(/\s+/g," ")}function A(y){return(y??"").toUpperCase().replace(/[^A-Z0-9 ]/g,"").slice(0,25)}function Q(y){return y.split(",").map(w=>x(w)).filter(Boolean)}function Ge(){return`${Date.now()}-${Math.random().toString(36).slice(2)}`}function V({tag:y,editable:w,onChange:L,onRemove:$}){return s.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-gray-200 bg-gray-50 px-3 py-1 text-sm",children:[w?s.jsx("input",{value:y.name,onChange:f=>L(A(f.target.value)),className:"bg-transparent outline-none w-44"}):s.jsx("span",{className:"max-w-[220px] truncate",children:y.name}),s.jsx("button",{type:"button",onClick:$,className:"text-gray-500 hover:text-gray-900","aria-label":"Remove",title:"Remove",children:s.jsx(Ze,{className:"w-4 h-4"})})]})}function _({label:y,selected:w,onClick:L}){return s.jsxs("button",{type:"button",onClick:L,className:`inline-flex items-center gap-2 rounded-full px-3 py-1 text-sm border transition-colors ${w?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"}`,children:[w&&s.jsx(Xe,{className:"w-4 h-4"}),y]})}function at(){const y=Ke(),w=Ue(),[L,$]=m.useState([]),f=e=>{const t=Ge();$(r=>[...r,{...e,id:t}]),window.setTimeout(()=>{$(r=>r.filter(i=>i.id!==t))},3500)},[ge,p]=m.useState(!1),[S,xe]=m.useState([]),[C,O]=m.useState(null),[h,D]=m.useState([]),[J,ee]=m.useState(""),[z,W]=m.useState(!1),[ye,pe]=m.useState([]),[M,T]=m.useState(1),[te,se]=m.useState([]),[R,P]=m.useState({}),[ae,re]=m.useState({}),[he,K]=m.useState({}),[be,Ne]=m.useState({}),[je,we]=m.useState([]),[Y,k]=m.useState({}),[ne,ie]=m.useState({}),[ve,U]=m.useState({}),[Se,Ce]=m.useState({}),F=e=>te.filter(t=>t.productCategoryId===e),j=()=>h.filter(e=>!e.isDeleted),De=m.useRef(null),oe=m.useRef(w.state||null),I=m.useRef(null),le=async()=>{const e=await N.getYourProductCategories();xe(e.data||[])},Z=async e=>{const t=await N.getYourItemCategories(e);se(t.data||[])},ce=async e=>{const t=await N.getYourSubCategories(e);we(t.data||[])};m.useEffect(()=>{p(!0),le().catch(e=>{console.error(e),f({type:"error",title:"Failed to load product categories"})}).finally(()=>p(!1))},[]),m.useEffect(()=>{const e=oe.current;if(!(e!=null&&e.fromCategoryMaster)||!S.length)return;const t=Number(e.productCategoryId)||null,r=Number(e.itemCategoryId)||null;if(t){const i=S.find(a=>a.id===t);i&&(O(i),T(2))}r&&T(3),oe.current=null},[S]),m.useEffect(()=>{if(M!==2)return;const e=j();e.length!==0&&(p(!0),Promise.all(e.filter(t=>t.id).map(t=>Z(t.id))).catch(t=>{console.error(t),f({type:"error",title:"Failed to load item categories"})}).finally(()=>p(!1)))},[M,h]),m.useEffect(()=>{if(M!==3)return;const e=j(),t=[];for(const r of e)if(r.id){const i=F(r.id);t.push(...i.map(a=>a.id))}t.length!==0&&(p(!0),Promise.all(t.map(r=>ce(r))).catch(r=>{console.error(r),f({type:"error",title:"Failed to load sub-categories"})}).finally(()=>p(!1)))},[M,te]);const q=e=>{O(e)},Pe=e=>{D(t=>{const r=t.find(a=>a.id===e.id);if(r){const a=t.map(n=>n.id===e.id?{...n,isDeleted:!n.isDeleted}:n);if((C==null?void 0:C.id)===e.id&&!r.isDeleted){const n=a.filter(o=>!o.isDeleted&&o.id);if(n.length>0&&n[0].id){const o=S.find(l=>l.id===n[0].id);o&&q(o)}else O(null)}return a}const i=[...t,{id:e.id,name:e.name,originalName:e.name}];return C||q(e),i})},ke=()=>{const e=Q(J);e.length!==0&&(D(t=>{const r=[...t];for(const i of e){if(r.some(o=>!o.isDeleted&&o.name.toLowerCase()===i.toLowerCase()))continue;const n=S.find(o=>o.name.toLowerCase()===i.toLowerCase());n?(r.push({id:n.id,name:n.name,originalName:n.name}),C||q(n)):r.push({name:i,isNew:!0})}return r}),ee(""))},Ie=()=>{pe(JSON.parse(JSON.stringify(h))),W(!0)},Ee=()=>{D(ye),W(!1)},Le=async()=>{const e=h.filter(r=>!r.isDeleted).map(r=>x(r.name));if(e.some(r=>!r)){f({type:"error",title:"Product category name cannot be empty"});return}const t=e.find((r,i)=>e.findIndex(a=>a.toLowerCase()===r.toLowerCase())!==i);if(t){f({type:"error",title:`Duplicate product category: "${t}"`});return}p(!0);try{for(const a of h.filter(n=>!n.isDeleted&&n.isNew))await N.createYourProductCategory({name:x(a.name)});for(const a of h.filter(n=>!n.isDeleted&&n.id&&n.originalName&&x(n.name)!==x(n.originalName)))await N.updateYourProductCategory(a.id,{name:x(a.name)});await le();const r=h.map(a=>{if(a.isDeleted)return a;if(a.isNew){const n=S.find(o=>o.name.toLowerCase()===x(a.name).toLowerCase());if(n)return{id:n.id,name:n.name,originalName:n.name}}return a});D(r);const i=r.filter(a=>!a.isDeleted&&a.id);for(const a of i)a.id&&await Z(a.id);W(!1),f({type:"success",title:"Product categories saved"}),B(),T(2)}catch(r){f({type:"error",title:"Failed to save product categories",message:r==null?void 0:r.message})}finally{p(!1)}},Fe=async()=>{await Le(),j().length>0&&(T(2),setTimeout(()=>{I.current&&I.current.scrollTo({left:I.current.clientWidth,behavior:"smooth"})},100))},Te=()=>{T(3),setTimeout(()=>{I.current&&I.current.scrollTo({left:I.current.clientWidth*2,behavior:"smooth"})},100)},Ae=e=>{const t=Q(ae[e]||"");if(t.length===0)return;const r=F(e);P(i=>{const n=[...i[e]||[]];for(const o of t){if(n.some(c=>!c.isDeleted&&c.name.toLowerCase()===o.toLowerCase()))continue;const d=r.find(c=>c.name.toLowerCase()===o.toLowerCase());d?n.push({id:d.id,name:d.name,originalName:d.name}):n.push({name:o,isNew:!0})}return{...i,[e]:n}}),re(i=>({...i,[e]:""}))},$e=(e,t)=>{P(r=>{const i=r[t]||[];return i.find(n=>n.id===e.id)?{...r,[t]:i.map(n=>n.id===e.id?{...n,isDeleted:!n.isDeleted}:n)}:{...r,[t]:[...i,{id:e.id,name:e.name,originalName:e.name}]}})},Me=e=>{Ne(t=>({...t,[e]:JSON.parse(JSON.stringify(R[e]||[]))})),K(t=>({...t,[e]:!0}))},Re=e=>{P(t=>({...t,[e]:be[e]||[]})),K(t=>({...t,[e]:!1}))},de=async e=>{const t=R[e]||[],r=t.filter(a=>!a.isDeleted).map(a=>x(a.name));if(r.some(a=>!a)){f({type:"error",title:"Item category name cannot be empty"});return}const i=r.find((a,n)=>r.findIndex(o=>o.toLowerCase()===a.toLowerCase())!==n);if(i){f({type:"error",title:`Duplicate item category: "${i}"`});return}p(!0);try{for(const a of t.filter(n=>n.isDeleted&&n.id))await N.deleteYourItemCategory(a.id);for(const a of t.filter(n=>!n.isDeleted&&n.isNew))await N.createYourItemCategory({name:x(a.name),productCategoryId:e});for(const a of t.filter(n=>!n.isDeleted&&n.id&&n.originalName&&x(n.name)!==x(n.originalName)))await N.updateYourItemCategory(a.id,{name:x(a.name),productCategoryId:e});await Z(e),P(a=>({...a,[e]:[]})),K(a=>({...a,[e]:!1})),f({type:"success",title:"Item categories saved"}),B()}catch(a){f({type:"error",title:"Failed to save item categories",message:a==null?void 0:a.message})}finally{p(!1)}},Ye=async()=>{var t;const e=j();for(const r of e)r.id&&((t=R[r.id])==null?void 0:t.length)>0&&await de(r.id)},me=e=>je.filter(t=>t.itemCategoryId===e),E=(e,t)=>`${e}-${t}`,Be=(e,t)=>{const r=E(e,t),i=Q(ne[r]||"");if(i.length===0)return;const a=me(t);k(n=>{const l=[...n[r]||[]];for(const d of i){if(l.some(g=>!g.isDeleted&&g.name.toLowerCase()===d.toLowerCase()))continue;const u=a.find(g=>g.name.toLowerCase()===d.toLowerCase());u?l.push({id:u.id,name:u.name,originalName:u.name}):l.push({name:d,isNew:!0})}return{...n,[r]:l}}),ie(n=>({...n,[r]:""}))},Oe=(e,t,r)=>{const i=E(t,r);k(a=>{const n=a[i]||[];return n.find(l=>l.id===e.id)?{...a,[i]:n.map(l=>l.id===e.id?{...l,isDeleted:!l.isDeleted}:l)}:{...a,[i]:[...n,{id:e.id,name:e.name,originalName:e.name}]}})},Je=(e,t)=>{const r=E(e,t);Ce(i=>({...i,[r]:JSON.parse(JSON.stringify(Y[r]||[]))})),U(i=>({...i,[r]:!0}))},ze=(e,t)=>{const r=E(e,t);k(i=>({...i,[r]:Se[r]||[]})),U(i=>({...i,[r]:!1}))},ue=async(e,t)=>{const r=E(e,t),i=Y[r]||[],a=i.filter(o=>!o.isDeleted).map(o=>x(o.name));if(a.some(o=>!o)){f({type:"error",title:"Sub-category name cannot be empty"});return}const n=a.find((o,l)=>a.findIndex(d=>d.toLowerCase()===o.toLowerCase())!==l);if(n){f({type:"error",title:`Duplicate sub-category: "${n}"`});return}p(!0);try{for(const o of i.filter(l=>l.isDeleted&&l.id))await N.deleteYourSubCategory(o.id);for(const o of i.filter(l=>!l.isDeleted&&l.isNew))await N.createYourSubCategory({name:x(o.name),itemCategoryId:t});for(const o of i.filter(l=>!l.isDeleted&&l.id&&l.originalName&&x(l.name)!==x(l.originalName)))await N.updateYourSubCategory(o.id,{name:x(o.name),itemCategoryId:t});await ce(t),k(o=>({...o,[r]:[]})),U(o=>({...o,[r]:!1})),f({type:"success",title:"Sub-categories saved"}),B()}catch(o){f({type:"error",title:"Failed to save sub-categories",message:o==null?void 0:o.message})}finally{p(!1)}},We=async()=>{const e=j();if(e.length===0){f({type:"error",title:"Select at least one Product Category first"});return}p(!0);try{await Ye();const t=e.filter(a=>a.id).map(a=>N.getYourItemCategories(a.id)),r=await Promise.all(t),i=[];r.forEach(a=>{i.push(...a.data||[])}),se(i);for(const a of e){if(!a.id)continue;const n=F(a.id);for(const o of n){const l=E(a.id,o.id),d=Y[l]||[];(d.filter(c=>!c.isDeleted).length>0||d.some(c=>c.isDeleted))&&await ue(a.id,o.id)}}f({type:"success",title:"All changes saved"}),B(),y("/app/library")}catch(t){f({type:"error",title:"Save All failed",message:t==null?void 0:t.message})}finally{p(!1)}};return s.jsxs("div",{className:"p-4 bg-gray-50 min-h-screen",children:[s.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:L.map(e=>s.jsxs("div",{className:`w-80 rounded-lg border px-4 py-3 shadow-lg bg-white ${e.type==="success"?"border-green-200":e.type==="error"?"border-red-200":"border-gray-200"}`,children:[s.jsx("div",{className:"font-semibold text-gray-900",children:e.title}),e.message&&s.jsx("div",{className:"text-sm text-gray-600 mt-0.5",children:e.message})]},e.id))}),s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsxs("button",{type:"button",onClick:()=>y("/app/library"),className:"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900",children:[s.jsx(qe,{className:"w-4 h-4"}),"Back to Library"]}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mt-2",children:"Add / Manage Categories"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Product Category → Item Category → Sub-Category"})]}),ge&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),"Working..."]})]}),s.jsx("div",{ref:I,className:"overflow-x-auto overflow-y-hidden scroll-smooth snap-x snap-mandatory",style:{scrollbarWidth:"thin",WebkitOverflowScrolling:"touch"},children:s.jsxs("div",{className:"flex",style:{width:"300%"},children:[s.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 mb-4 mr-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"1) Product Category"}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Type and press Enter (or use commas) to add. Select existing tags below."})]}),C&&s.jsxs("div",{className:"text-xs text-gray-500",children:["Selected: ",s.jsx("span",{className:"font-semibold text-gray-900",children:C.name})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Product Category"}),s.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg px-3 py-2",children:s.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.filter(e=>!e.isDeleted).map((e,t)=>s.jsx(V,{tag:e,editable:z,onChange:r=>D(i=>i.map((a,n)=>n===t?{...a,name:r}:a)),onRemove:()=>D(r=>r.map((i,a)=>a===t?{...i,isDeleted:!0}:i))},`${e.id??"new"}-${t}`)),s.jsx("input",{ref:De,value:J,onChange:e=>ee(A(e.target.value)),onKeyDown:e=>{var t;if((e.key==="Enter"||e.key===",")&&(e.preventDefault(),ke()),e.key==="Backspace"&&J===""&&h.length>0){const r=(t=h.map((i,a)=>({t:i,i:a})).filter(({t:i})=>!i.isDeleted).slice(-1)[0])==null?void 0:t.i;r!==void 0&&D(i=>i.map((a,n)=>n===r?{...a,isDeleted:!0}:a))}},placeholder:"Type product category and press Enter…",className:"flex-1 min-w-[220px] outline-none"})]})}),s.jsxs("div",{className:"mt-3",children:[s.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Existing product categories"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.map(e=>{const t=h.some(r=>r.id===e.id&&!r.isDeleted);return s.jsx(_,{label:e.name,selected:t,onClick:()=>Pe(e)},e.id)}),S.length===0&&s.jsx("div",{className:"text-sm text-gray-500",children:"No product categories yet."})]})]})]}),s.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[s.jsxs("button",{type:"button",onClick:()=>z?Ee():Ie(),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm",children:[s.jsx(H,{className:"w-4 h-4"}),z?"Cancel":"Edit"]}),s.jsxs("button",{type:"button",onClick:Fe,disabled:h.filter(e=>!e.isDeleted).length===0,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black disabled:opacity-50",children:[s.jsx(G,{className:"w-4 h-4"}),"Save & Next"]})]})]})}),s.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:s.jsxs("div",{className:"space-y-4 mr-4",children:[j().map(e=>{const t=e.id;if(!t)return null;const r=F(t),i=R[t]||[],a=ae[t]||"",n=he[t]||!1;return s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["Product Category: ",e.name]}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Type Your Item Category"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{type:"button",onClick:()=>n?Re(t):Me(t),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm",children:[s.jsx(H,{className:"w-4 h-4"}),n?"Cancel":"Edit"]}),s.jsxs("button",{type:"button",onClick:()=>de(t),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black",children:[s.jsx(G,{className:"w-4 h-4"}),"Save"]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Item Category"}),s.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg px-3 py-2",children:s.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.filter(o=>!o.isDeleted).map((o,l)=>s.jsx(V,{tag:o,editable:n,onChange:d=>P(c=>({...c,[t]:(c[t]||[]).map((u,g)=>g===l?{...u,name:d}:u)})),onRemove:()=>P(d=>({...d,[t]:(d[t]||[]).map((c,u)=>u===l?{...c,isDeleted:!0}:c)}))},`${o.id??"new"}-${l}`)),s.jsx("input",{value:a,onChange:o=>re(l=>({...l,[t]:A(o.target.value)})),onKeyDown:o=>{var l;if((o.key==="Enter"||o.key===",")&&(o.preventDefault(),Ae(t)),o.key==="Backspace"&&a===""&&i.length>0){const d=(l=i.map((c,u)=>({t:c,i:u})).filter(({t:c})=>!c.isDeleted).slice(-1)[0])==null?void 0:l.i;d!==void 0&&P(c=>({...c,[t]:(c[t]||[]).map((u,g)=>g===d?{...u,isDeleted:!0}:u)}))}},placeholder:"Type item category and press Enter…",className:"flex-1 min-w-[220px] outline-none"})]})}),s.jsxs("div",{className:"mt-3",children:[s.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Existing under ",e.name]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.map(o=>{const l=i.some(d=>d.id===o.id&&!d.isDeleted);return s.jsx(_,{label:o.name,selected:l,onClick:()=>$e(o,t)},o.id)}),r.length===0&&s.jsx("div",{className:"text-sm text-gray-500",children:"No item categories yet."})]})]})]})]},t)}),j().length===0&&s.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:s.jsx("div",{className:"text-sm text-gray-500",children:"Select Product Categories in Step 1 first."})}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx("button",{type:"button",onClick:Te,disabled:j().length===0,className:"px-4 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black disabled:opacity-50",children:"Next"})})]})}),s.jsx("div",{className:"flex-shrink-0 w-full snap-center",style:{width:"33.333%"},children:s.jsxs("div",{className:"space-y-4",children:[j().map(e=>{const t=e.id;return t?F(t).map(i=>{const a=E(t,i.id),n=Y[a]||[],o=ne[a]||"",l=ve[a]||!1,d=me(i.id);return s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:["Product Category ",e.name," → Item Category ",i.name]}),s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Type your Sub Category"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{type:"button",onClick:()=>l?ze(t,i.id):Je(t,i.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border text-sm",children:[s.jsx(H,{className:"w-4 h-4"}),l?"Cancel":"Edit"]}),s.jsxs("button",{type:"button",onClick:()=>ue(t,i.id),className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-900 text-white text-sm font-semibold hover:bg-black",children:[s.jsx(G,{className:"w-4 h-4"}),"Save"]})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Sub-Category"}),s.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg px-3 py-2",children:s.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.filter(c=>!c.isDeleted).map((c,u)=>s.jsx(V,{tag:c,editable:l,onChange:g=>k(b=>({...b,[a]:(b[a]||[]).map((v,X)=>X===u?{...v,name:g}:v)})),onRemove:()=>k(g=>({...g,[a]:(g[a]||[]).map((b,v)=>v===u?{...b,isDeleted:!0}:b)}))},`${c.id??"new"}-${u}`)),s.jsx("input",{value:o,onChange:c=>ie(u=>({...u,[a]:A(c.target.value)})),onKeyDown:c=>{var u;if((c.key==="Enter"||c.key===",")&&(c.preventDefault(),Be(t,i.id)),c.key==="Backspace"&&o===""&&n.length>0){const g=(u=n.map((b,v)=>({t:b,i:v})).filter(({t:b})=>!b.isDeleted).slice(-1)[0])==null?void 0:u.i;g!==void 0&&k(b=>({...b,[a]:(b[a]||[]).map((v,X)=>X===g?{...v,isDeleted:!0}:v)}))}},placeholder:"Type sub-category and press Enter…",className:"flex-1 min-w-[220px] outline-none"})]})}),s.jsxs("div",{className:"mt-3",children:[s.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:["Existing under ",s.jsx("span",{className:"font-semibold text-gray-900",children:i.name})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[d.map(c=>{const u=n.some(g=>g.id===c.id&&!g.isDeleted);return s.jsx(_,{label:c.name,selected:u,onClick:()=>Oe(c,t,i.id)},c.id)}),d.length===0&&s.jsx("div",{className:"text-sm text-gray-500",children:"No sub-categories yet."})]})]})]})]},a)}):null}),(()=>{const e=j(),t=e.some(r=>r.id&&F(r.id).length>0);return e.length===0?s.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:s.jsx("div",{className:"text-sm text-gray-500",children:"Select Product Categories in Step 1 first."})}):t?null:s.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-5 opacity-60",children:s.jsx("div",{className:"text-sm text-gray-500",children:"Save item categories in Step 2 first."})})})()]})})]})}),s.jsxs("div",{className:"mt-6 flex items-center justify-between gap-2",children:[s.jsx("button",{type:"button",onClick:We,disabled:j().length===0,className:"px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700 disabled:opacity-50",children:"Save All"}),s.jsx("button",{type:"button",onClick:()=>y("/app/library"),className:"px-4 py-2 rounded-lg border text-sm hover:bg-gray-50",children:"Close"})]})]})]})}export{at as default};
