import{j as e,u as Ft,r as l,X as lt}from"./index-v4UyLoar.js";import{i as ee}from"./inventoryService-3mhiX-ga.js";import{l as Qe}from"./libraryService-BqxRzzIS.js";import{s as It}from"./skuService-CD47JNeC.js";import{f as O,a as te,b as ge,g as Ne}from"./formatters-ptPrPoGe.js";import{e as ts,a as ss}from"./reportExporter-C58px7xM.js";import{C as as}from"./calendar-DZNgaMIm.js";import{D as ct}from"./download-WG4FeSf0.js";import{C as et}from"./chevron-down-DTzR0Snc.js";import{S as _t}from"./search-C_UOvm8j.js";import{C as it}from"./chevron-up-CbePdg3V.js";import{E as dt}from"./eye-TdPdDtr5.js";import{T as rs}from"./trash-2-F_yzDzD4.js";import{H as ns}from"./history-CzvNXcID.js";import{E as Rt}from"./jspdf.es.min-HmMNWplZ.js";import{S as os}from"./save-4D8tpIMf.js";import{o as ls}from"./categoriesEvents-i2FsXa12.js";import{A as Ze,a as Je}from"./arrow-up-BUb5EjXf.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";const xt=({datePreset:t,customDateFrom:o,customDateTo:V,showCustomDatePicker:F,onDatePresetChange:E,onCustomDateFromChange:U,onCustomDateToChange:A,onClear:i})=>{const w=m=>{E(m),m==="custom"||i()};return e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filter by Date:"})]}),e.jsxs("select",{value:t,onChange:m=>w(m.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Dates"}),e.jsx("option",{value:"1month",children:"1 Month"}),e.jsx("option",{value:"3months",children:"3 Months"}),e.jsx("option",{value:"6months",children:"6 Months"}),e.jsx("option",{value:"1year",children:"1 Year"}),e.jsx("option",{value:"thisFinancialYear",children:"This Financial Year"}),e.jsx("option",{value:"previousFinancialYear",children:"Previous Financial Year"}),e.jsx("option",{value:"custom",children:"Custom Date Range"})]}),F&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:o,onChange:m=>U(m.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"From Date"}),e.jsx("span",{className:"text-gray-500",children:"to"}),e.jsx("input",{type:"date",value:V,onChange:m=>A(m.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"To Date"}),e.jsx("button",{onClick:i,className:"px-3 py-2 text-sm text-gray-600 hover:text-gray-800",children:"Clear"})]})]})})},cs=({search:t,productCategory:o,itemCategory:V,subCategory:F,brand:E,stockStatus:U,datePreset:A,customDateFrom:i,customDateTo:w,showCustomDatePicker:m,productCategories:x,itemCategories:D,subCategories:S,brands:I,onSearchChange:T,onProductCategoryChange:L,onItemCategoryChange:j,onSubCategoryChange:y,onBrandChange:u,onStockStatusChange:C,onDatePresetChange:a,onCustomDateFromChange:n,onCustomDateToChange:P,onClearDateFilter:Q,showExportDropdown:K=!1,onExportDropdownToggle:_,onExportPDF:R,onExportExcel:q,onExportCSV:d,exportDropdownRef:re,loading:ae=!1})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap lg:flex-nowrap items-center gap-3",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Search SKU ID, Item Name, Model Number, HSN Code, Vendor, Brand...",value:t,onChange:g=>T(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"})}),e.jsx("div",{className:"w-full sm:w-auto lg:w-48",children:e.jsxs("select",{value:o,onChange:g=>L(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"All Product Categories"}),x.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]})}),e.jsx("div",{className:"w-full sm:w-auto lg:w-48",children:e.jsxs("select",{value:V,onChange:g=>j(g.target.value),disabled:!o,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 text-sm",children:[e.jsx("option",{value:"",children:"All Item Categories"}),D.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]})}),e.jsx("div",{className:"w-full sm:w-auto lg:w-40",children:e.jsxs("select",{value:E,onChange:g=>u(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"All Brands"}),I.map(g=>e.jsx("option",{value:g.id,children:g.name},g.id))]})}),e.jsx("div",{className:"w-full sm:w-auto lg:w-40",children:e.jsxs("select",{value:U,onChange:g=>C(g.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Stock Status"}),e.jsx("option",{value:"out_of_stock",children:"Out of Stock"}),e.jsx("option",{value:"low_stock",children:"Low Stock"}),e.jsx("option",{value:"in_stock",children:"In Stock"})]})}),_&&e.jsxs("div",{className:"relative w-full sm:w-auto",ref:re,children:[e.jsxs("button",{onClick:_,className:"w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 text-sm whitespace-nowrap",children:[e.jsx(ct,{className:"w-4 h-4"}),"Export",e.jsx(et,{className:`w-4 h-4 transition-transform ${K?"rotate-180":""}`})]}),K&&e.jsxs("div",{className:"absolute right-0 mt-1 w-32 bg-white border border-gray-200 rounded-lg shadow-lg z-50",children:[e.jsx("button",{onClick:R,disabled:ae,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg disabled:opacity-50",children:"PDF"}),e.jsx("button",{onClick:q,disabled:ae,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 disabled:opacity-50",children:"XLSX"}),e.jsx("button",{onClick:d,disabled:ae,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg disabled:opacity-50",children:"CSV"})]})]})]}),e.jsx(xt,{datePreset:A,customDateFrom:i,customDateTo:w,showCustomDatePicker:m,onDatePresetChange:a,onCustomDateFromChange:n,onCustomDateToChange:P,onClear:Q})]}),is=({search:t,vendor:o,status:V,datePreset:F,customDateFrom:E,customDateTo:U,showCustomDatePicker:A,vendors:i,onSearchChange:w,onVendorChange:m,onStatusChange:x,onDatePresetChange:D,onCustomDateFromChange:S,onCustomDateToChange:I,onClearDateFilter:T})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search Invoice, Item, SKU...",value:t,onChange:L=>w(L.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),e.jsxs("select",{value:o,onChange:L=>m(L.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Vendors"}),i.map(L=>e.jsx("option",{value:L.id,children:L.name},L.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:V,onChange:L=>x(L.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsx(xt,{datePreset:F,customDateFrom:E,customDateTo:U,showCustomDatePicker:A,onDatePresetChange:D,onCustomDateFromChange:S,onCustomDateToChange:I,onClear:T})]}),ds=({destination:t,status:o,datePreset:V,customDateFrom:F,customDateTo:E,showCustomDatePicker:U,customers:A,vendors:i,onDestinationChange:w,onStatusChange:m,onDatePresetChange:x,onCustomDateFromChange:D,onCustomDateToChange:S,onClearDateFilter:I})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Destination"}),e.jsx("input",{type:"text",value:t,onChange:T=>w(T.target.value),placeholder:"Search customer/vendor",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:o,onChange:T=>m(T.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsx(xt,{datePreset:V,customDateFrom:F,customDateTo:E,showCustomDatePicker:U,onDatePresetChange:x,onCustomDateFromChange:D,onCustomDateToChange:S,onClear:I})]}),xs=({item:t,isExpanded:o,onToggle:V,onDelete:F})=>{const E=Ft(),U=(A,i)=>{const w=t.minStockLevel??i;return A===0?"text-red-600 font-semibold":A<=w?"text-yellow-600 font-semibold":"text-green-600 font-semibold"};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:V,className:"text-gray-600 hover:text-gray-900",children:o?e.jsx(it,{className:"w-5 h-5"}):e.jsx(et,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-3 py-2 text-xs font-medium text-gray-900 text-center",children:t.skuId}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.productCategory}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.itemCategory}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.subCategory||"-"}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-900 text-center",children:t.itemName}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.brand}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.vendor}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.model||"-"}),e.jsx("td",{className:"px-3 py-2 text-xs text-gray-700 text-center",children:t.hsnSacCode||"-"}),e.jsx("td",{className:"px-3 py-2 text-xs text-center",children:e.jsx("span",{className:`${U(t.currentStock,t.minStockLevel??t.minStock)} text-sm`,children:O(t.currentStock)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>E(`/app/sku/${t.id}`),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:F,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete",disabled:!F,children:e.jsx(rs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>E(`/app/inventory/${t.id}/history`),className:"p-2 text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"History",children:e.jsx(ns,{className:"w-4 h-4"})})]})})]}),o&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:12,className:"px-4 py-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Item Details:"}),e.jsx("p",{className:"text-gray-600",children:t.itemDetails||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Vendor Item Code:"}),e.jsx("p",{className:"text-gray-600",children:t.vendorItemCode||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Rating/Size:"}),e.jsx("p",{className:"text-gray-600",children:t.ratingSize||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Model:"}),e.jsx("p",{className:"text-gray-600",children:t.model||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Series:"}),e.jsx("p",{className:"text-gray-600",children:t.series||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"HSN/SAC Code:"}),e.jsx("p",{className:"text-gray-600",children:t.hsnSacCode||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Unit:"}),e.jsx("p",{className:"text-gray-600",children:t.unit})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Minimum Stock Level:"}),e.jsx("p",{className:"text-gray-600",children:t.minStock||"-"})]}),(t.material||t.color||t.weight)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Material:"}),e.jsx("p",{className:"text-gray-600",children:t.material||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Color:"}),e.jsx("p",{className:"text-gray-600",children:t.color||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Weight:"}),e.jsx("p",{className:"text-gray-600",children:t.weight?`${t.weight} Kg`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Dimensions:"}),e.jsx("p",{className:"text-gray-600",children:t.length&&t.width&&t.height?`${t.length} × ${t.width} × ${t.height} mm`:"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Last Updated:"}),e.jsx("p",{className:"text-gray-600",children:te(t.lastUpdated)})]})]})})})]})},ms=({inventory:t,loading:o,expandedRows:V,onToggleRow:F,onDeleteItem:E,sortBy:U,sortOrder:A,onSort:i,SortIcon:w})=>e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider w-10"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"SKU ID"}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("productCategory"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Product Category",w&&e.jsx(w,{field:"productCategory"})]})}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("itemCategory"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Item Category",w&&e.jsx(w,{field:"itemCategory"})]})}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("subCategory"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Sub Category",w&&e.jsx(w,{field:"subCategory"})]})}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("itemName"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Item Name",w&&e.jsx(w,{field:"itemName"})]})}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("brand"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Brand",w&&e.jsx(w,{field:"brand"})]})}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("vendor"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Vendor",w&&e.jsx(w,{field:"vendor"})]})}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Model Number"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"HSN Code"}),e.jsx("th",{className:`px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${i?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>i&&i("currentStock"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Current Stock",w&&e.jsx(w,{field:"currentStock"})]})}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"px-3 py-6 text-center text-gray-500 text-xs",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-3 border-blue-600 border-t-transparent rounded-full animate-spin"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:12,className:"px-3 py-6 text-center text-gray-500 text-xs",children:"No inventory items found"})}):t.map(m=>e.jsx(xs,{item:m,isExpanded:V.has(m.id),onToggle:()=>F(m.id),onDelete:E?()=>E(m.id):void 0},m.id))})]})})}),us=({record:t,items:o,onItemsUpdate:V})=>{const[F,E]=l.useState({}),[U,A]=l.useState({}),[i,w]=l.useState({}),[m,x]=l.useState(!1),D=async(S,I)=>{var y,u,C,a;if(I<=0){alert("Please enter a quantity greater than 0");return}const T=S.received||0,L=S.rejected||0,j=L+I;if(j>T){const n=T-L;alert(`Cannot move ${I}. Total rejected (${L} + ${I} = ${j}) would exceed received quantity (${T}). Maximum you can move is ${n}.`);return}if(confirm(`Move ${I} from received to rejected (defective items)? This will reduce stock by ${I}.`))try{x(!0);const n=S.itemId||S.item_id||S.id;if(!n){alert("Item ID not found");return}const P=U[`${t.id}-${n}`]||new Date().toISOString().split("T")[0];await ee.moveReceivedToRejected(t.id,n,I,P),await ee.getIncomingItems(t.id),V(),E(Q=>{const K={...Q};return delete K[`${t.id}-${n}`],K}),A(Q=>{const K={...Q};return delete K[`${t.id}-${n}`],K}),w(Q=>({...Q,[`${t.id}-${n}`]:!0})),alert(`Successfully moved ${I} to rejected. Stock reduced by ${I}.`)}catch(n){console.error("Error moving to rejected:",n),alert(((u=(y=n.response)==null?void 0:y.data)==null?void 0:u.error)||((a=(C=n.response)==null?void 0:C.data)==null?void 0:a.message)||"Failed to move to rejected")}finally{x(!1)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Item Details with Invoice Information"}),o&&o.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Rejected Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Short Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Received Quantity"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600 border-r border-gray-300",children:"Invoice Number"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:o.map(S=>{const I=S.itemId||S.item_id||S.id||0,T=S.itemName||S.item_name||"-",L=S.skuCode||S.sku_code||S.skuId||S.sku_id||"-",j=S.received||0,y=S.short||0,u=S.rejected||0;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-3 text-gray-900 border-r border-gray-200",children:T}),e.jsx("td",{className:"px-3 py-3 text-gray-700 font-mono text-xs border-r border-gray-200",children:L}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-red-700 font-semibold",children:["Rejected Quantity: ",O(u)]}),j>0&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"1",max:j-u,value:F[`${t.id}-${I}`]||"",onChange:C=>{const a=parseInt(C.target.value)||0,n=j-u;a>=0&&a<=n&&E(P=>({...P,[`${t.id}-${I}`]:a}))},onBlur:C=>{const a=parseInt(C.target.value)||0,n=j-u;a>n?E(P=>({...P,[`${t.id}-${I}`]:n})):a<0&&E(P=>({...P,[`${t.id}-${I}`]:0}))},placeholder:"Qty",className:"w-16 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",title:`Max: ${j-u} (Received: ${j} - Already Rejected: ${u})`}),e.jsx("input",{type:"date",value:U[`${t.id}-${I}`]||new Date().toISOString().split("T")[0],onChange:C=>{A(a=>({...a,[`${t.id}-${I}`]:C.target.value}))},className:"w-32 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",title:"Inspection Date"}),e.jsx("button",{onClick:()=>D(S,F[`${t.id}-${I}`]||0),disabled:m||!F[`${t.id}-${I}`],className:"px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors disabled:opacity-50",title:"Move Received to Rejected",children:"Move to Rejected"})]})]}),i[`${t.id}-${I}`]&&u>0&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-xs",children:[e.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"Rejected Items Details:"}),e.jsx("div",{className:"space-y-1 text-red-700",children:e.jsxs("div",{children:["Quantity: ",O(u)]})})]})]})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("span",{className:"text-orange-700 font-semibold",children:["Short Quantity: ",O(y)]})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200 bg-gray-50",children:e.jsx("div",{className:"space-y-1",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"text-green-700 font-semibold",children:["Received Quantity: ",O(j)]})})})}),e.jsx("td",{className:"px-3 py-3 border-r border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-900 font-medium",children:t.invoiceNumber})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-6 bg-blue-500 rounded"}),e.jsx("span",{className:"text-gray-700",children:te(t.invoiceDate)})]})})]},I)})})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-4 bg-blue-500 rounded"}),e.jsx("span",{children:"Invoice and Date are linked to the rejected/short quantities above"})]})]}):e.jsx("div",{className:"text-center text-gray-500 text-sm py-4",children:"Loading items..."})]})},gs=({record:t,item:o,itemKey:V,isExpanded:F,onToggle:E,onEditRejectedShort:U,onItemsUpdate:A})=>{Ft();const[i,w]=l.useState(!1),[m,x]=l.useState(o.rejected||0),[D,S]=l.useState(o.short||0),[I,T]=l.useState(!1),[L,j]=l.useState(!1),y=l.useRef(null),u=o.itemName||o.item_name||"N/A",C=o.skuCode||o.sku_code||o.skuId||o.sku_id||"-",a=o.received||0,n=o.rejected||0,P=o.short||0,Q=o.totalQuantity||o.total_quantity||0,K=Q-a,_=Math.max(0,K-P),R=i?(()=>{const g=Q-a,Y=Math.max(0,g-D);return m>0?a-m+Y:a+Y})():n>0?a-n+_:a+_;l.useEffect(()=>{i||(x(n),S(P))},[n,P,i]);const q=()=>{F||E()},d=()=>{x(n),S(P),w(!1)},re=async()=>{var g,Y,b,oe;try{j(!0);const M=await ee.getIncomingById(t.id);if(!M.success||!M.data){alert("Failed to fetch invoice data");return}const $=M.data;let ne=$.items||[];ne.length===0&&(ne=(await ee.getIncomingItems(t.id)).data||[]);const c=new Rt({orientation:"portrait",unit:"mm",format:"a4"}),ce=210,je=297,W=15,ve=ce-W*2;let v=W;const ie=H=>v+H>je-W?(c.addPage(),v=W,!0):!1,me=(H,pe,be,ke,$e=10,De="normal",fe="left")=>{c.setFontSize($e),c.setFont("helvetica",De);const Ee=c.splitTextToSize(H,ke);return c.text(Ee,pe,be,{align:fe}),Ee.length*($e*.35)};c.setFontSize(24),c.setFont("helvetica","bold"),c.text("INVOICE",ce/2,v,{align:"center"}),v+=12,c.setFontSize(10),c.setFont("helvetica","normal");const J=$.invoiceNumber||$.invoice_number||t.invoiceNumber||`INV-${t.id}`,de=te($.invoiceDate||$.invoice_date||t.invoiceDate),ue=te($.receivingDate||$.receiving_date||t.receivingDate),we=$.vendorName||$.vendor_name||t.vendorName,Z=$.brandName||$.brand_name||t.brandName,Le=$.receivedByName||$.received_by_name||t.receivedByName||"N/A",Fe=$.docketNumber||$.docket_number,_e=$.transportorName||$.transportor_name,xe=W,z=W+ve/2+5;let B=v,he=v;c.setFont("helvetica","normal"),c.setFontSize(10),c.text(`Invoice Number: ${J}`,xe,B),B+=6,c.text(`Invoice Date: ${de}`,xe,B),B+=6,c.text(`Receiving Date: ${ue}`,xe,B),B+=6,c.text(`Vendor: ${we}`,xe,B),B+=6,c.text(`Brand: ${Z}`,xe,B),B+=6,c.text(`Received By: ${Le}`,xe,B),B+=6,Fe&&(c.text(`Docket Number: ${Fe}`,z,he),he+=6),_e&&(c.text(`Transporter: ${_e}`,z,he),he+=6),v=Math.max(B,he)+8,ie(20),c.setFontSize(12),c.setFont("helvetica","bold"),c.text("ITEMS",W,v),v+=8,c.setFontSize(9),c.setFont("helvetica","bold");const le=[12,60,18,18,18,18,28],Re=["S.No","Item Name / SKU","Total Qty","Received","Short","Rejected","Total Value"];let X=W;Re.forEach((H,pe)=>{c.text(H,X,v),X+=le[pe]}),v+=5,c.setLineWidth(.5),c.line(W,v-2,ce-W,v-2),v+=4,c.setFontSize(9),c.setFont("helvetica","normal"),ne.forEach((H,pe)=>{ie(12);const be=H.item_name||H.itemName||"N/A",ke=H.sku_code||H.skuCode||H.sku_id||"N/A",$e=H.total_quantity||H.totalQuantity||0,De=H.received||0,fe=H.short||0,Ee=H.rejected||0,Pe=parseFloat(H.total_value||H.totalValue||0)||0;X=W,c.text(String(pe+1),X,v),X+=le[0];const ze=c.splitTextToSize(be,le[1]-2);c.text(ze,X,v),c.setFontSize(8),c.setFont("helvetica","italic"),c.text(`SKU: ${ke}`,X,v+ze.length*4+2),c.setFontSize(9),c.setFont("helvetica","normal"),X+=le[1],c.text(String($e),X,v),X+=le[2],c.text(String(De),X,v),X+=le[3],c.text(String(fe),X,v),X+=le[4],c.text(String(Ee),X,v),X+=le[5],c.setFont("helvetica","bold"),c.setFontSize(10);const Ie=`₹${Pe.toFixed(2)}`;c.text(Ie,X,v),c.setFont("helvetica","normal"),c.setFontSize(9),v+=Math.max(8,ze.length*4+4)}),v+=8,ie(35),c.setFontSize(12),c.setFont("helvetica","bold"),c.text("SUMMARY",W,v),v+=10,c.setFontSize(10),c.setFont("helvetica","normal");const Me=$.totalQuantity||$.total_quantity||t.totalQuantity||0,Ce=$.received||t.received||0,Te=$.short||t.short||0,Oe=$.rejected||t.rejected||0,Se=parseFloat($.totalValue||$.total_value||t.totalValue||0)||0;c.text(`Total Quantity: ${Me}`,W,v),v+=7,c.text(`Total Received: ${Ce}`,W,v),v+=7,c.text(`Total Short: ${Te}`,W,v),v+=7,c.text(`Total Rejected: ${Oe}`,W,v),v+=7,c.setFont("helvetica","bold"),c.setFontSize(11),c.text(`Total Value: ₹${Se.toFixed(2)}`,W,v),v+=10,c.setFont("helvetica","normal"),c.setFontSize(8),c.setTextColor(128,128,128),c.text(`Generated on: ${new Date().toLocaleString()}`,W,je-10),c.setTextColor(0,0,0);const qe=J.replace(/[^a-zA-Z0-9]/g,"_");c.save(`Invoice_${qe}_${new Date().toISOString().split("T")[0]}.pdf`)}catch(M){console.error("Error downloading invoice:",M),alert(((Y=(g=M.response)==null?void 0:g.data)==null?void 0:Y.error)||((oe=(b=M.response)==null?void 0:b.data)==null?void 0:oe.message)||"Failed to download invoice")}finally{j(!1)}},ae=async()=>{var g,Y,b,oe;try{if(T(!0),m>a){alert(`Rejected quantity cannot exceed received quantity (${a})`),T(!1);return}const M=Q-a,$=Math.max(0,M-D),ne=m>0?a-m+$:a+$;if(ne<0){alert(`Invalid quantities: Available (${ne}) cannot be negative. Received: ${a}, Rejected: ${m}, Arrived Short: ${$}`),T(!1);return}const c=o.itemId||o.item_id||o.id;if(!c){alert("Item ID not found"),T(!1);return}await ee.updateRejectedShort(t.id,{itemId:c,rejected:m,short:D}),w(!1),await A(t.id),alert("Quantities updated successfully")}catch(M){console.error("Error updating quantities:",M),alert(((Y=(g=M.response)==null?void 0:g.data)==null?void 0:Y.error)||((oe=(b=M.response)==null?void 0:b.data)==null?void 0:oe.message)||"Failed to update quantities")}finally{T(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:E,className:"text-gray-600 hover:text-gray-900",children:F?e.jsx(it,{className:"w-5 h-5"}):e.jsx(et,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-center",children:t.invoiceNumber}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:te(t.invoiceDate)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:te(t.receivingDate)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:e.jsx("div",{className:"max-w-xs truncate mx-auto",title:u,children:u})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 font-mono text-xs text-center",children:C}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:t.vendorName}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold text-center",children:O(Q)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:i?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-green-700 font-semibold text-xs",children:"Accepted:"}),e.jsx("span",{className:"text-green-700 font-semibold",children:O(R)})]}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-red-700 font-semibold text-xs",children:"Rejected:"}),e.jsx("input",{type:"number",min:"0",max:Math.min(a,Q-D),value:m,onChange:g=>{const Y=parseInt(g.target.value)||0,b=a;Y>=0&&Y<=b&&x(Y)},onBlur:g=>{const Y=parseInt(g.target.value)||0,b=a;Y>b?x(b):Y<0&&x(0)},className:"w-20 px-2 py-1 text-sm border border-red-300 rounded text-red-700 font-semibold focus:ring-2 focus:ring-red-500 mx-auto",title:`Max: ${a} (Received: ${a})`})]})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 relative",children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"text-green-700 font-semibold",children:O(R)})}),e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsx("div",{className:"flex items-center gap-1 relative",ref:y,children:e.jsx("button",{onClick:q,className:"text-red-700 font-semibold hover:text-red-800 hover:bg-red-50 px-2 py-1 rounded transition-colors cursor-pointer",title:"View Item Details",children:O(n)})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:i?e.jsx("input",{type:"number",min:"0",max:Q-m,value:D,onChange:g=>{const Y=parseInt(g.target.value)||0;Y>=0&&S(Y)},onBlur:g=>{(parseInt(g.target.value)||0)<0&&S(0)},className:"w-20 px-2 py-1 text-sm border border-orange-300 rounded text-orange-700 font-semibold focus:ring-2 focus:ring-orange-500 mx-auto",title:"Short quantity (items not yet received). When items arrive, reduce short to update stock."}):e.jsx("span",{className:"text-orange-700 font-semibold",children:O(P)})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:i?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:ae,disabled:I,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50",title:"Save",children:e.jsx(os,{className:"w-4 h-4"})}),e.jsx("button",{onClick:d,disabled:I,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50",title:"Cancel",children:e.jsx(lt,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>U(t,o),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Item",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:re,disabled:L,className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors disabled:opacity-50",title:"Download Invoice",children:e.jsx(ct,{className:"w-4 h-4"})})]})})]}),F&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:11,className:"px-4 py-4",children:e.jsx(us,{record:t,items:[o],onItemsUpdate:A})})})]})},hs=({records:t,loading:o,expandedRows:V,recordItems:F,onToggleRow:E,onEditRejectedShort:U,onItemsUpdate:A,sortBy:i,sortOrder:w,onSort:m,SortIcon:x,search:D})=>{const[S,I]=l.useState(""),T=D!==void 0?D:S,L=l.useMemo(()=>{const j=[];if(t.forEach(y=>{const u=F[y.id]||[];u.length>0?u.forEach(C=>{const a=C.itemId||C.item_id||C.id||0;j.push({record:y,item:C,itemKey:`${y.id}-${a}`})}):j.push({record:y,item:{id:0,itemName:"Loading...",received:y.received||0,short:y.short||0,rejected:y.rejected||0,totalQuantity:y.totalQuantity||0},itemKey:`${y.id}-0`})}),i&&w&&j.length>0&&j.sort((y,u)=>{let C,a;switch(i){case"invoiceDate":C=new Date(y.record.invoiceDate||y.record.invoice_date||0).getTime(),a=new Date(u.record.invoiceDate||u.record.invoice_date||0).getTime();break;case"receivingDate":C=new Date(y.record.receivingDate||y.record.receiving_date||0).getTime(),a=new Date(u.record.receivingDate||u.record.receiving_date||0).getTime();break;case"itemName":C=(y.item.itemName||y.item.item_name||"").toLowerCase(),a=(u.item.itemName||u.item.item_name||"").toLowerCase();break;case"vendor":C=(y.record.vendorName||y.record.vendor_name||"").toLowerCase(),a=(u.record.vendorName||u.record.vendor_name||"").toLowerCase();break;case"totalQuantity":C=y.item.totalQuantity||y.item.total_quantity||0,a=u.item.totalQuantity||u.item.total_quantity||0;break;case"available":const n=y.item.received||0,P=y.item.rejected||0,K=(y.item.totalQuantity||y.item.total_quantity||0)-n,_=Math.max(0,K-(y.item.short||0));C=P>0?n-P+_:n+_;const R=u.item.received||0,q=u.item.rejected||0,re=(u.item.totalQuantity||u.item.total_quantity||0)-R,ae=Math.max(0,re-(u.item.short||0));a=q>0?R-q+ae:R+ae;break;case"rejected":C=y.item.rejected||0,a=u.item.rejected||0;break;case"short":C=y.item.short||0,a=u.item.short||0;break;default:return 0}return typeof C=="string"&&typeof a=="string"?w==="asc"?C.localeCompare(a):a.localeCompare(C):w==="asc"?C-a:a-C}),T.trim()){const y=T.toLowerCase().trim();return j.filter(u=>{var q,d;const C=(u.record.invoiceNumber||u.record.invoice_number||"").toLowerCase(),a=(u.record.invoiceDate||u.record.invoice_date||"").toLowerCase(),n=(u.record.receivingDate||u.record.receiving_date||"").toLowerCase(),P=(u.item.itemName||u.item.item_name||"").toLowerCase(),Q=(((q=u.item.skuId)==null?void 0:q.toString())||((d=u.item.sku_id)==null?void 0:d.toString())||u.item.skuCode||u.item.sku_code||"").toLowerCase(),K=(u.record.vendorName||u.record.vendor_name||"").toLowerCase(),_=(u.record.brandName||u.record.brand_name||"").toLowerCase(),R=(u.item.challanNumber||u.item.challan_number||"").toLowerCase();return C.includes(y)||a.includes(y)||n.includes(y)||P.includes(y)||Q.includes(y)||K.includes(y)||_.includes(y)||R.includes(y)})}return j},[t,F,i,w,T]);return e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[D===void 0&&e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by Invoice Number, Item Name, SKU ID, Vendor, Brand...",value:S,onChange:j=>I(j.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("invoiceDate"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Invoice Date",x&&e.jsx(x,{field:"invoiceDate"})]})}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("receivingDate"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Receiving Date",x&&e.jsx(x,{field:"receivingDate"})]})}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("itemName"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Item Name",x&&e.jsx(x,{field:"itemName"})]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"SKU ID"}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("vendor"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Vendor",x&&e.jsx(x,{field:"vendor"})]})}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("totalQuantity"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Total Quantity",x&&e.jsx(x,{field:"totalQuantity"})]})}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("available"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Available | Rejected",x&&e.jsx(x,{field:"available"})]})}),e.jsx("th",{className:`px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider ${m?"cursor-pointer hover:bg-gray-100 select-none":""}`,onClick:()=>m&&m("short"),children:e.jsxs("div",{className:"flex items-center justify-center",children:["Short",x&&e.jsx(x,{field:"short"})]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})})})}):L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:"No incoming inventory records found"})}):L.map(j=>e.jsx(gs,{record:j.record,item:j.item,itemKey:j.itemKey,isExpanded:V.has(j.itemKey),onToggle:()=>E(j.itemKey),onEditRejectedShort:U,onItemsUpdate:A},j.itemKey))})]})})]})},ps=({record:t,item:o,itemKey:V,isExpanded:F,onToggle:E,onViewDetails:U,onDownloadInvoice:A,downloading:i=!1})=>{const w=o.itemName||o.item_name||"N/A",m=o.skuCode||o.sku_code||String(o.skuId||o.sku_id||"-"),x=o.outgoingQuantity||o.outgoing_quantity||0,D=o.rejectedQuantity||o.rejected_quantity||0,S=o.unitPrice||o.unit_price||0,I=o.totalValue||o.total_value||0,T=()=>{var y;let j="";return t.documentType==="sales_invoice"?(j="Sales Invoice",t.documentSubType==="to_customer"&&(j+=" - To Customer"),t.documentSubType==="to_vendor"&&(j+=" - To Vendor",t.vendorSubType==="replacement"&&(j+=" (Replacement)"),t.vendorSubType==="rejected"&&(j+=" (Rejected)"))):t.documentType==="delivery_challan"?(j="Delivery Challan",t.documentSubType==="sample"&&(j+=" - Sample"),t.documentSubType==="replacement"&&(j+=" - Replacement",t.deliveryChallanSubType==="to_customer"&&(j+=" (To Customer)"),t.deliveryChallanSubType==="to_vendor"&&(j+=" (To Vendor)"))):t.documentType==="transfer_note"?j="Transfer Note":j=((y=t.documentType)==null?void 0:y.replace(/_/g," "))||"-",j},L=()=>(t.status||"draft")==="completed"?e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800",children:"Completed"}):e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-800",children:"Draft"});return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("button",{onClick:E,className:"text-gray-400 hover:text-gray-600 transition-colors",children:F?e.jsx(it,{className:"w-5 h-5"}):e.jsx(et,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-medium text-center",children:t.invoiceChallanNumber||t.docketNumber||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:t.invoiceChallanDate?te(t.invoiceChallanDate):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 capitalize text-center",children:T()}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:w}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:m}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700 text-center",children:t.destinationName||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-medium text-center",children:O(x)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold text-center",children:ge(I)}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:L()}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:U,className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"View Details",disabled:!U,children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A,className:"text-green-600 hover:text-green-800 flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",title:"Download Invoice",disabled:!A||i,children:e.jsx(ct,{className:`w-4 h-4 ${i?"animate-pulse":""}`})})]})})]}),F&&e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-4 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Docket Number:"}),e.jsx("p",{className:"text-gray-900",children:t.docketNumber||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Transportor:"}),e.jsx("p",{className:"text-gray-900",children:t.transportorName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Dispatched By:"}),e.jsx("p",{className:"text-gray-900",children:t.dispatchedByName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Unit Price:"}),e.jsx("p",{className:"text-gray-900",children:ge(S)})]}),D>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Rejected Quantity:"}),e.jsx("p",{className:"text-red-600 font-semibold",children:O(D)})]}),t.remarks&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Remarks:"}),e.jsx("p",{className:"text-gray-900",children:t.remarks})]})]})})})]})},ys=({records:t,loading:o,expandedRows:V,recordItems:F,onToggleRow:E})=>{var C;const[U,A]=l.useState(!1),[i,w]=l.useState(null),[m,x]=l.useState([]),[D,S]=l.useState(!1),[I,T]=l.useState(!1),L=async a=>{try{S(!0);const n=await ee.getOutgoingById(a);n!=null&&n.success&&n.data?(w(n.data),x(n.data.items||[]),A(!0)):n!=null&&n.data?(w(n.data),x(n.data.items||[]),A(!0)):alert("Failed to load record details")}catch(n){console.error("Error loading record details:",n),alert("Failed to load record details")}finally{S(!1)}},j=(a,n,P,Q)=>{let K=(a==null?void 0:a.replace(/_/g," "))||"";return n&&(K+=` - ${n.replace(/_/g," ")}`),P&&(K+=` - ${P.replace(/_/g," ")}`),Q&&(K+=` - ${Q.replace(/_/g," ")}`),K},y=async a=>{var n,P,Q,K;try{T(!0);const _=await ee.getOutgoingById(a);if((!(_!=null&&_.success)||!_.data)&&!(_!=null&&_.data)){alert("Failed to fetch invoice data");return}const R=_.data||(_==null?void 0:_.data),q=R.items||[];if(q.length===0){alert("No items found in this record");return}const d=new Rt({orientation:"portrait",unit:"mm",format:"a4"}),re=210,ae=297,g=15,Y=re-g*2;let b=g;const oe=z=>b+z>ae-g?(d.addPage(),b=g,!0):!1;d.setFontSize(24),d.setFont("helvetica","bold");const M=j(R.documentType||"",R.documentSubType,R.vendorSubType,R.deliveryChallanSubType);d.text(M.toUpperCase(),re/2,b,{align:"center"}),b+=12,d.setFontSize(10),d.setFont("helvetica","normal");const $=R.invoiceChallanNumber||R.invoice_challan_number||`DOC-${R.id}`,ne=te(R.invoiceChallanDate||R.invoice_challan_date),c=R.docketNumber||R.docket_number||"",ce=R.transportorName||R.transportor_name||"",je=R.destinationName||R.destination_name||"N/A",W=R.destinationType||R.destination_type||"",ve=R.dispatchedByName||R.dispatched_by_name||"N/A",v=R.remarks||"",ie=g,me=g+Y/2+5;let J=b,de=b;d.setFont("helvetica","normal"),d.setFontSize(10),d.text(`Document Number: ${$}`,ie,J),J+=6,d.text(`Date: ${ne}`,ie,J),J+=6,d.text(`Destination Type: ${W.replace(/_/g," ")}`,ie,J),J+=6,d.text(`Destination: ${je}`,ie,J),J+=6,d.text(`Dispatched By: ${ve}`,ie,J),J+=6,c&&(d.text(`Docket Number: ${c}`,me,de),de+=6),ce&&(d.text(`Transporter: ${ce}`,me,de),de+=6),b=Math.max(J,de)+8,oe(20),d.setFontSize(12),d.setFont("helvetica","bold"),d.text("ITEMS",g,b),b+=8,d.setFontSize(9),d.setFont("helvetica","bold");const ue=[12,60,25,25,28],we=["S.No","Item Name / SKU","Quantity","Unit Price","Total Value"];let Z=g;we.forEach((z,B)=>{d.text(z,Z,b),Z+=ue[B]}),b+=5,d.setLineWidth(.5),d.line(g,b-2,re-g,b-2),b+=4,d.setFontSize(9),d.setFont("helvetica","normal"),q.forEach((z,B)=>{oe(12);const he=z.itemName||z.item_name||"N/A",le=z.skuCode||z.sku_code||z.skuId||z.sku_id||"N/A",Re=z.outgoingQuantity||z.outgoing_quantity||0,X=parseFloat(z.unitPrice||z.unit_price||0)||0,Me=parseFloat(z.totalValue||z.total_value||0)||0;Z=g,d.text(String(B+1),Z,b),Z+=ue[0];const Ce=d.splitTextToSize(he,ue[1]-2);d.text(Ce,Z,b),d.setFontSize(8),d.setFont("helvetica","italic"),d.text(`SKU: ${le}`,Z,b+Ce.length*4+2),d.setFontSize(9),d.setFont("helvetica","normal"),Z+=ue[1],d.text(String(Re),Z,b),Z+=ue[2],d.setFont("helvetica","bold"),d.setFontSize(10);const Te=`₹${X.toFixed(2)}`;d.text(Te,Z,b),Z+=ue[3];const Oe=`₹${Me.toFixed(2)}`;d.text(Oe,Z,b),d.setFont("helvetica","normal"),d.setFontSize(9),b+=Math.max(8,Ce.length*4+4)}),b+=8,oe(30),d.setFontSize(12),d.setFont("helvetica","bold"),d.text("SUMMARY",g,b),b+=10,d.setFontSize(10),d.setFont("helvetica","normal");const Le=R.totalQuantity||q.reduce((z,B)=>z+(B.outgoingQuantity||B.outgoing_quantity||0),0),Fe=parseFloat(R.totalValue||q.reduce((z,B)=>z+(B.totalValue||B.total_value||0),0))||0;if(d.text(`Total Quantity: ${Le}`,g,b),b+=7,d.setFont("helvetica","bold"),d.setFontSize(11),d.text(`Total Value: ₹${Fe.toFixed(2)}`,g,b),b+=10,v){oe(15),d.setFont("helvetica","normal"),d.setFontSize(10),d.text("Remarks:",g,b),b+=6,d.setFontSize(9);const z=d.splitTextToSize(v,Y);d.text(z,g,b),b+=z.length*4+5}d.setFont("helvetica","normal"),d.setFontSize(8),d.setTextColor(128,128,128),d.text(`Generated on: ${new Date().toLocaleString()}`,g,ae-10),d.setTextColor(0,0,0);const _e=$.replace(/[^a-zA-Z0-9]/g,"_"),xe=`${M.replace(/\s+/g,"_")}_${_e}_${new Date().toISOString().split("T")[0]}.pdf`;d.save(xe)}catch(_){console.error("Error downloading invoice:",_),alert(((P=(n=_.response)==null?void 0:n.data)==null?void 0:P.error)||((K=(Q=_.response)==null?void 0:Q.data)==null?void 0:K.message)||"Failed to download invoice")}finally{T(!1)}},u=l.useMemo(()=>{const a=[];return t.forEach(n=>{const P=F[n.id]||[];P.length>0?P.forEach(Q=>{const K=Q.id||0;a.push({record:n,item:Q,itemKey:`${n.id}-${K}`})}):a.push({record:n,item:{id:0,skuId:0,skuCode:"-",itemName:"Loading items...",outgoingQuantity:n.totalQuantity||0,unitPrice:0,totalValue:n.totalValue||0},itemKey:`${n.id}-0`})}),a},[t,F]);return e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Invoice/Challan Number"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Document Type"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Item Name"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"SKU ID"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Customer/Vendor"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})})})}):u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:"No outgoing inventory records found"})}):u.map(a=>e.jsx(ps,{record:a.record,item:a.item,itemKey:a.itemKey,isExpanded:V.has(a.itemKey),onToggle:()=>E(a.itemKey),onViewDetails:()=>L(a.record.id),onDownloadInvoice:()=>y(a.record.id),downloading:I},a.itemKey))})]})}),U&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Outgoing Record Details"}),e.jsx("button",{onClick:()=>{A(!1),w(null),x([])},className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg transition-colors",children:e.jsx(lt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Document Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Document Type"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:j(i.documentType||"",i.documentSubType,i.vendorSubType,i.deliveryChallanSubType)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Status"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:i.status||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Document Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.invoiceChallanDate?te(i.invoiceChallanDate):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.invoiceChallanNumber||i.invoice_challan_number||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Docket Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.docketNumber||i.docket_number||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Transportor Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.transportorName||i.transportor_name||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Destination"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Destination Type"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:((C=i.destinationType)==null?void 0:C.replace(/_/g," "))||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Destination Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.destinationName||"-"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Item Details"}),m.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No items found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Item Name"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"SKU"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Outgoing Quantity"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase",children:"Total Value"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[m.map((a,n)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:a.itemName||a.item_name||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:a.skuCode||a.sku_code||a.skuId||a.sku_id||"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:O(a.outgoingQuantity||a.outgoing_quantity||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ge(a.unitPrice||a.unit_price||0)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:ge(a.totalValue||a.total_value||0)})]},a.id||n)),e.jsxs("tr",{className:"bg-blue-50 font-semibold",children:[e.jsx("td",{colSpan:2,className:"px-4 py-3 text-sm text-gray-900",children:"Total"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:O(m.reduce((a,n)=>a+(n.outgoingQuantity||n.outgoing_quantity||0),0))}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ge(m.reduce((a,n)=>a+(n.totalValue||n.total_value||0),0))})]})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Dispatched By"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.dispatchedByName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Remarks"}),e.jsx("p",{className:"text-sm text-gray-900",children:i.remarks||"-"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:O(i.totalQuantity||m.reduce((a,n)=>a+(n.outgoingQuantity||n.outgoing_quantity||0),0))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Value"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:ge(i.totalValue||m.reduce((a,n)=>a+(n.totalValue||n.total_value||0),0))})]})]})]})]}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:()=>{A(!1),w(null),x([])},className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:"Close"})})]})})]})},js=({isOpen:t,record:o,items:V,selectedItemId:F,formData:E,updating:U,onClose:A,onItemSelect:i,onFormDataChange:w,onUpdate:m})=>!t||!o?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"DETAILS"}),e.jsx("button",{onClick:A,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg transition-colors",children:e.jsx(lt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice/Challan Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:te(o.invoiceDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Invoice/Challan Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.invoiceNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Docket Number"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.docketNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Transportor Name"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.transportorName||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vendor & Brand"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Vendor"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.vendorName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Brand"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.brandName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Warranty"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.warranty?`${o.warranty} ${o.warrantyUnit||"months"}`:"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Receiving Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Receiving Date"}),e.jsx("p",{className:"text-sm text-gray-900",children:te(o.receivingDate)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Received By"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.receivedByName||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Item Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Total Quantity"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Received"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Short"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Rejected"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Unit Price"}),e.jsx("th",{className:"px-3 py-2 text-center text-xs font-semibold text-gray-700",children:"Total Value"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-3 py-4 text-center text-gray-500",children:"No items found"})}):V.map(x=>{const D=x.itemId||x.item_id||x.id||0,S=x.itemName||x.item_name||"N/A",I=x.skuCode||x.sku_code||x.skuId||x.sku_id||"N/A",T=x.totalQuantity||x.total_quantity||0,L=x.received||0,j=x.short||0,y=x.rejected||0,u=x.unitPrice||x.unit_price||0,C=x.totalValue||x.total_value||T*u;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:S}),e.jsx("td",{className:"px-3 py-2 text-gray-700 font-mono text-xs",children:I}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:O(T)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:O(L)}),e.jsx("td",{className:"px-3 py-2 text-center text-orange-700 font-semibold",children:O(j)}),e.jsx("td",{className:"px-3 py-2 text-center text-red-700 font-semibold",children:O(y)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900",children:ge(u)}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-900 font-semibold",children:ge(C)})]},D)})}),e.jsx("tfoot",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:2,className:"px-3 py-2 text-sm font-semibold text-gray-900",children:"Total"}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:O(V.reduce((x,D)=>x+(D.totalQuantity||D.total_quantity||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:O(V.reduce((x,D)=>x+(D.received||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-orange-700",children:O(V.reduce((x,D)=>x+(D.short||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-red-700",children:O(V.reduce((x,D)=>x+(D.rejected||0),0))}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:"-"}),e.jsx("td",{className:"px-3 py-2 text-center text-sm font-semibold text-gray-900",children:ge(V.reduce((x,D)=>x+(D.totalValue||D.total_value||(D.totalQuantity||D.total_quantity||0)*(D.unitPrice||D.unit_price||0)),0))})]})})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Quantity"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:O(o.totalQuantity||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Received"}),e.jsx("p",{className:"text-lg font-bold text-green-700",children:O(o.received||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Short"}),e.jsx("p",{className:"text-lg font-bold text-orange-700",children:O(o.short||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Rejected"}),e.jsx("p",{className:"text-lg font-bold text-red-700",children:O(o.rejected||0)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Total Value"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:ge(o.totalValue||0)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Details"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Reason for Receipt"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.reason||"N/A"})]})})]})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200",children:e.jsx("button",{onClick:A,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Close"})})]})}),Ls=()=>{const[t,o]=l.useState("all"),[V,F]=l.useState(!1),[E,U]=l.useState([]),[A,i]=l.useState([]),[w,m]=l.useState([]),[x,D]=l.useState(new Set),[S,I]=l.useState(new Set),[T,L]=l.useState(new Set),[j,y]=l.useState({}),[u,C]=l.useState({}),[a,n]=l.useState(!1),P=l.useRef(null),[Q,K]=l.useState(""),[_,R]=l.useState(""),[q,d]=l.useState(""),[re,ae]=l.useState(""),[g,Y]=l.useState(""),[b,oe]=l.useState("all"),[M,$]=l.useState(""),[ne,c]=l.useState(""),[ce,je]=l.useState(""),[W,ve]=l.useState(!1),[v,ie]=l.useState(""),[me,J]=l.useState("asc"),[de,ue]=l.useState(""),[we,Z]=l.useState("asc"),[Le,Fe]=l.useState([]),[_e,xe]=l.useState([]),[z,B]=l.useState([]),[he,le]=l.useState([]),[Re,X]=l.useState([]),[Me,Ce]=l.useState([]),[Te,Oe]=l.useState(""),[Se,qe]=l.useState(""),[H,pe]=l.useState(""),[be,ke]=l.useState(""),[$e,De]=l.useState(!1),[fe,Ee]=l.useState(""),[Pe,ze]=l.useState(""),[Ie,mt]=l.useState(""),[Ye,tt]=l.useState(""),[He,st]=l.useState(""),[Tt,at]=l.useState(!1),[We,$t]=l.useState(""),[Xe,Et]=l.useState(""),[Pt,Ge]=l.useState(!1),[Ve,rt]=l.useState(null),[nt,Be]=l.useState([]),[Ue,Ae]=l.useState(null),[ye,Ke]=l.useState({rejected:0,short:0,invoiceNumber:"",invoiceDate:""}),[Vt,ut]=l.useState(!1);l.useEffect(()=>{gt()},[]),l.useEffect(()=>ls(()=>{gt(),_&&ht(parseInt(_)),q&&pt(parseInt(q))}),[_,q]),l.useEffect(()=>{const s=r=>{P.current&&!P.current.contains(r.target)&&n(!1)};return a&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[a]),l.useEffect(()=>{t==="all"?yt():t==="incoming"?ot():t==="outgoing"&&Kt()},[t,Q,_,q,re,g,b,M,ne,ce,v,me,Se,H,be,fe,Pe,Ie,Ye,He,We,Xe]),l.useEffect(()=>{_?ht(parseInt(_)):(xe([]),d(""),ae(""),B([]))},[_]),l.useEffect(()=>{q?pt(parseInt(q)):(B([]),ae(""))},[q]);const gt=async()=>{try{const[s,r,h,f]=await Promise.all([Qe.getYourProductCategories(),Qe.getBrands(),Qe.getYourVendors(),Qe.getCustomers()]);Fe(s.data||[]),le(r.data||[]),X(h.data||[]),Ce(f.data||[])}catch(s){console.error("Error loading initial data:",s)}},ht=async s=>{try{const r=await Qe.getYourItemCategories(s);xe(r.data||[])}catch(r){console.error("Error loading item categories:",r)}},pt=async s=>{try{const r=await Qe.getYourSubCategories(s);B(r.data||[])}catch(r){console.error("Error loading sub categories:",r)}},yt=async()=>{try{F(!0);const s={};if(Q&&(s.search=Q),_&&(s.productCategory=_),q&&(s.itemCategory=q),re&&(s.subCategory=re),g&&(s.brand=g),b!=="all"){const f={out_of_stock:"out",low_stock:"low",in_stock:"in"};s.stockStatus=f[b]||b}if(M==="custom")ne&&(s.dateFrom=ne),ce&&(s.dateTo=ce);else if(M){const f=Ne(M);f&&(s.dateFrom=f.dateFrom,s.dateTo=f.dateTo)}let h=(await It.getAll(s)).data||[];v&&h.length>0&&(h=[...h].sort((f,p)=>{var G,se,jt,bt,ft,Nt,vt,wt,Ct,St,kt,Dt;let k,N;switch(v){case"productCategory":k=((G=f.productCategory)==null?void 0:G.toLowerCase())||"",N=((se=p.productCategory)==null?void 0:se.toLowerCase())||"";break;case"itemCategory":k=((jt=f.itemCategory)==null?void 0:jt.toLowerCase())||"",N=((bt=p.itemCategory)==null?void 0:bt.toLowerCase())||"";break;case"subCategory":k=((ft=f.subCategory)==null?void 0:ft.toLowerCase())||"",N=((Nt=p.subCategory)==null?void 0:Nt.toLowerCase())||"";break;case"itemName":k=((vt=f.itemName)==null?void 0:vt.toLowerCase())||"",N=((wt=p.itemName)==null?void 0:wt.toLowerCase())||"";break;case"brand":k=((Ct=f.brand)==null?void 0:Ct.toLowerCase())||"",N=((St=p.brand)==null?void 0:St.toLowerCase())||"";break;case"vendor":k=((kt=f.vendor)==null?void 0:kt.toLowerCase())||"",N=((Dt=p.vendor)==null?void 0:Dt.toLowerCase())||"";break;case"currentStock":k=f.currentStock??0,N=p.currentStock??0;break;default:return 0}return typeof k=="string"&&typeof N=="string"?me==="asc"?k.localeCompare(N):N.localeCompare(k):me==="asc"?k-N:N-k})),U(h)}catch(s){console.error("Error loading inventory:",s),U([])}finally{F(!1)}},At=s=>{v===s?J(me==="asc"?"desc":"asc"):(ie(s),J("asc"))},Qt=({field:s})=>v!==s?e.jsxs("span",{className:"inline-flex flex-col ml-1 text-gray-400",children:[e.jsx(Ze,{className:"w-3 h-3 -mb-0.5"}),e.jsx(Je,{className:"w-3 h-3"})]}):me==="asc"?e.jsx(Ze,{className:"w-4 h-4 ml-1 text-blue-600"}):e.jsx(Je,{className:"w-4 h-4 ml-1 text-blue-600"}),Lt=s=>{de===s?Z(we==="asc"?"desc":"asc"):(ue(s),Z("asc"))},Mt=({field:s})=>de!==s?e.jsxs("span",{className:"inline-flex flex-col ml-1 text-gray-400",children:[e.jsx(Ze,{className:"w-3 h-3 -mb-0.5"}),e.jsx(Je,{className:"w-3 h-3"})]}):we==="asc"?e.jsx(Ze,{className:"w-4 h-4 ml-1 text-blue-600"}):e.jsx(Je,{className:"w-4 h-4 ml-1 text-blue-600"}),Ot=async s=>{var r,h,f,p;if(window.confirm("Are you sure you want to delete this item? This action cannot be undone."))try{F(!0),await It.delete(s),await yt(),alert("Item deleted successfully")}catch(k){console.error("Error deleting item:",k),alert(((h=(r=k.response)==null?void 0:r.data)==null?void 0:h.error)||((p=(f=k.response)==null?void 0:f.data)==null?void 0:p.message)||"Failed to delete item")}finally{F(!1)}},ot=async()=>{try{F(!0);const s={};if(fe&&(s.vendor=fe),Pe&&(s.status=Pe),Se==="custom")H&&(s.dateFrom=H),be&&(s.dateTo=be);else if(Se){const k=Ne(Se);k&&(s.dateFrom=k.dateFrom,s.dateTo=k.dateTo)}const r=await ee.getIncoming(s);let h=[];r&&r.success&&Array.isArray(r.data)?h=r.data:Array.isArray(r)?h=r:r&&Array.isArray(r.data)&&(h=r.data),i(h);const f={},p=h.map(async k=>{try{const N=await ee.getIncomingById(k.id);N.success&&N.data.items&&(f[k.id]=N.data.items)}catch(N){console.error(`Error loading items for record ${k.id}:`,N)}});await Promise.all(p),y(f)}catch(s){console.error("Error loading incoming records:",s),i([])}finally{F(!1)}},zt=s=>{$(s),s==="custom"?ve(!0):(ve(!1),c(""),je(""))},Bt=s=>{qe(s),s==="custom"?De(!0):(De(!1),pe(""),ke(""))},Ut=s=>{mt(s),s==="custom"?at(!0):(at(!1),tt(""),st(""))},Kt=async()=>{try{F(!0);const s={};if(We&&(s.destination=We),Xe&&(s.status=Xe),Ie==="custom")Ye&&(s.dateFrom=Ye),He&&(s.dateTo=He);else if(Ie){const p=Ne(Ie);p&&(s.dateFrom=p.dateFrom,s.dateTo=p.dateTo)}console.log("Loading outgoing records with params:",s);const r=await ee.getOutgoing(s);console.log("Outgoing records response:",r);let h=[];r&&r.success&&Array.isArray(r.data)?h=r.data:Array.isArray(r)?h=r:r&&r.data&&Array.isArray(r.data)&&(h=r.data),console.log("Parsed records:",h),m(h);const f={};if(h.length>0){const p=h.map(async k=>{var N,G;try{const se=await ee.getOutgoingById(k.id);console.log(`Items for record ${k.id}:`,se),(se!=null&&se.success&&((N=se.data)!=null&&N.items)||(G=se==null?void 0:se.data)!=null&&G.items)&&(f[k.id]=se.data.items)}catch(se){console.error(`Error loading items for record ${k.id}:`,se)}});await Promise.all(p),console.log("Items map:",f)}C(f)}catch(s){console.error("Error loading outgoing records:",s),m([]),C({})}finally{F(!1)}},qt=async s=>{var h,f;const r=new Set(T);if(r.has(s))r.delete(s);else{r.add(s);const[p]=s.split("-"),k=parseInt(p);if(!u[k])try{const N=await ee.getOutgoingById(k);N!=null&&N.success&&((h=N.data)!=null&&h.items)?C(G=>({...G,[k]:N.data.items})):(f=N==null?void 0:N.data)!=null&&f.items&&C(G=>({...G,[k]:N.data.items}))}catch(N){console.error("Error loading record items:",N)}}L(r)},Yt=s=>{const r=new Set(x);r.has(s)?r.delete(s):r.add(s),D(r)},Ht=async s=>{const r=new Set(S);if(r.has(s))r.delete(s);else{r.add(s);const[h]=s.split("-"),f=parseInt(h);if(!j[f])try{const p=await ee.getIncomingById(f);p.success&&p.data.items&&y(k=>({...k,[f]:p.data.items}))}catch(p){console.error("Error loading record items:",p)}}I(r)},Wt=async(s,r)=>{try{rt(s);const h=await ee.getIncomingById(s.id);if(h.success&&h.data.items&&h.data.items.length>0){Be(h.data.items);const f=r.itemId||r.item_id||r.id;Ae(f||null),Ke({rejected:r.rejected||0,short:r.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""})}else{const f=r.itemId||r.item_id||r.id||0;Be([r]),Ae(f),Ke({rejected:r.rejected||0,short:r.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""})}Ge(!0)}catch(h){console.error("Error loading record details:",h);const f=r.itemId||r.item_id||r.id||0;Be([r]),Ae(f),Ke({rejected:r.rejected||0,short:r.short||0,invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||""}),Ge(!0)}},Xt=async()=>{var f,p,k,N;if(!Ve||Ue===null){alert("Please select an item to update");return}const s=nt.find(G=>(G.itemId||G.item_id||G.id)===Ue);if(!s){alert("Selected item not found");return}const r=s.rejected||0,h=s.short||0;if(ye.rejected>r||ye.short>h){alert(`Updated rejected/short values cannot exceed the original values (Rejected: ${r}, Short: ${h})`);return}if(ye.rejected===r&&ye.short===h){alert("No changes detected. Please update at least one value.");return}if(Ue===0){alert("Cannot update: Item details not available. Please refresh and try again.");return}try{ut(!0),await ee.updateRejectedShort(Ve.id,{itemId:Ue,rejected:ye.rejected,short:ye.short,invoiceNumber:ye.invoiceNumber||void 0,invoiceDate:ye.invoiceDate||void 0}),await ot(),Ge(!1),rt(null),Be([]),Ae(null),alert("Rejected/Short quantities updated successfully. Stock has been adjusted.")}catch(G){console.error("Error updating rejected/short:",G),alert(((p=(f=G.response)==null?void 0:f.data)==null?void 0:p.error)||((N=(k=G.response)==null?void 0:k.data)==null?void 0:N.message)||"Failed to update rejected/short")}finally{ut(!1)}},Gt=async s=>{if(s)try{const r=await ee.getIncomingItems(s);r.success&&r.data&&y(h=>({...h,[s]:r.data}))}catch(r){console.error("Error refreshing items:",r)}if(Ve){const r=await ee.getIncomingById(Ve.id);r.success&&r.data.items&&y(h=>({...h,[Ve.id]:r.data.items}))}await ot()},Zt=async()=>{n(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],r=E.map(p=>[p.skuId||"-",p.productCategory||"-",p.itemCategory||"-",p.subCategory||"-",p.itemName||"-",p.brand||"-",p.vendor||"-",p.model||"-",p.hsnSacCode||"-",O(p.currentStock||0)]),h=M?Ne(M):null,f=h?`Date Range: ${te(h.dateFrom)} to ${te(h.dateTo)}`:"";await ss({headers:s,rows:r,title:"Inventory Report",dateRange:f})}catch(s){console.error("Error exporting PDF:",s),alert("Failed to export PDF")}},Jt=async()=>{n(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],r=E.map(p=>[p.skuId||"-",p.productCategory||"-",p.itemCategory||"-",p.subCategory||"-",p.itemName||"-",p.brand||"-",p.vendor||"-",p.model||"-",p.hsnSacCode||"-",O(p.currentStock||0)]),h=M?Ne(M):null,f=h?`Date Range: ${te(h.dateFrom)} to ${te(h.dateTo)}`:"";await ts({headers:s,rows:r,title:"Inventory Report",dateRange:f})}catch(s){console.error("Error exporting Excel:",s),alert("Failed to export Excel")}},es=async()=>{n(!1);try{const s=["SKU ID","Product Category","Item Category","Sub Category","Item Name","Brand","Vendor","Model Number","HSN Code","Current Stock"],r=E.map(N=>[N.skuId||"-",N.productCategory||"-",N.itemCategory||"-",N.subCategory||"-",N.itemName||"-",N.brand||"-",N.vendor||"-",N.model||"-",N.hsnSacCode||"-",O(N.currentStock||0)]),h=[["Inventory Report"],M?[Ne(M)?`Date Range: ${te(Ne(M).dateFrom)} to ${te(Ne(M).dateTo)}`:""]:[],[],s,...r].map(N=>N.map(G=>`"${G}"`).join(",")).join(`
`),f=new Blob([h],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),k=URL.createObjectURL(f);p.setAttribute("href",k),p.setAttribute("download",`Inventory_Report_${new Date().toISOString().split("T")[0]}.csv`),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p)}catch(s){console.error("Error exporting CSV:",s),alert("Failed to export CSV")}};return e.jsxs("div",{className:"p-4 space-y-4",style:{transform:"scale(0.8)",transformOrigin:"top left",width:"125%",height:"125%"},children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory"})}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>o("all"),className:`py-4 px-1 border-b-2 font-medium text-sm ${t==="all"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"All Inventory"}),e.jsx("button",{onClick:()=>o("incoming"),className:`py-4 px-1 border-b-2 font-medium text-sm ${t==="incoming"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Incoming Records"}),e.jsx("button",{onClick:()=>o("outgoing"),className:`py-4 px-1 border-b-2 font-medium text-sm ${t==="outgoing"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Outgoing Records"})]})}),t==="all"&&e.jsxs(e.Fragment,{children:[e.jsx(cs,{search:Q,productCategory:_,itemCategory:q,subCategory:re,brand:g,stockStatus:b,datePreset:M,customDateFrom:ne,customDateTo:ce,showCustomDatePicker:W,productCategories:Le,itemCategories:_e,subCategories:z,brands:he,onSearchChange:K,onProductCategoryChange:R,onItemCategoryChange:d,onSubCategoryChange:ae,onBrandChange:Y,onStockStatusChange:oe,onDatePresetChange:zt,onCustomDateFromChange:c,onCustomDateToChange:je,onClearDateFilter:()=>{$(""),c(""),je(""),ve(!1)},showExportDropdown:a,onExportDropdownToggle:()=>n(!a),onExportPDF:Zt,onExportExcel:Jt,onExportCSV:es,exportDropdownRef:P,loading:V}),e.jsx(ms,{inventory:E,loading:V,expandedRows:x,onToggleRow:Yt,onDeleteItem:Ot,sortBy:v,sortOrder:me,onSort:At,SortIcon:Qt})]}),t==="incoming"&&e.jsxs(e.Fragment,{children:[e.jsx(is,{search:Te,vendor:fe,status:Pe,datePreset:Se,customDateFrom:H,customDateTo:be,showCustomDatePicker:$e,vendors:Re,onSearchChange:Oe,onVendorChange:Ee,onStatusChange:ze,onDatePresetChange:Bt,onCustomDateFromChange:pe,onCustomDateToChange:ke,onClearDateFilter:()=>{qe(""),pe(""),ke(""),De(!1)}}),e.jsx(hs,{records:A,loading:V,expandedRows:S,recordItems:j,onToggleRow:Ht,onEditRejectedShort:Wt,onItemsUpdate:Gt,sortBy:de,sortOrder:we,onSort:Lt,SortIcon:Mt,search:Te})]}),t==="outgoing"&&e.jsxs(e.Fragment,{children:[e.jsx(ds,{destination:We,status:Xe,datePreset:Ie,customDateFrom:Ye,customDateTo:He,showCustomDatePicker:Tt,customers:Me,vendors:Re,onDestinationChange:$t,onStatusChange:Et,onDatePresetChange:Ut,onCustomDateFromChange:tt,onCustomDateToChange:st,onClearDateFilter:()=>{mt(""),tt(""),st(""),at(!1)}}),e.jsx(ys,{records:w,loading:V,expandedRows:T,recordItems:u,onToggleRow:qt})]}),e.jsx(js,{isOpen:Pt,record:Ve,items:nt,selectedItemId:Ue,formData:ye,updating:Vt,onClose:()=>{Ge(!1),rt(null),Be([]),Ae(null)},onItemSelect:s=>{Ae(s);const r=nt.find(h=>(h.itemId||h.item_id||h.id)===s);r&&Ke(h=>({...h,rejected:r.rejected||0,short:r.short||0}))},onFormDataChange:s=>{Ke(r=>({...r,...s}))},onUpdate:Xt})]})};export{Ls as default};
