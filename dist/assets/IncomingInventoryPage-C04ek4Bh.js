import{c as de,j as e,u as $,r as g,X as L,R as _e}from"./index-v4UyLoar.js";import{i as E}from"./inventoryService-3mhiX-ga.js";import{l as F}from"./libraryService-BqxRzzIS.js";import{s as Ae}from"./skuService-CD47JNeC.js";import{P as K}from"./plus-DkwEl8bK.js";import{C as oe}from"./chevron-down-DTzR0Snc.js";import{A as ne}from"./alert-circle-DtAct9_U.js";import{S as ce}from"./save-4D8tpIMf.js";import{a as R,b as M}from"./formatters-ptPrPoGe.js";import{C as Be}from"./chevron-right-DasLtTte.js";import{E as Re}from"./eye-TdPdDtr5.js";import{D as Ve}from"./download-WG4FeSf0.js";import{P as De}from"./pen-square-DBTKvIVg.js";import{A as Qe}from"./arrow-left-CQGXFyIF.js";import"./api-VNhYhLPD.js";import"./cachedApi-CKq13PPM.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=de("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=de("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),qe=({activeTab:s,onTabChange:o})=>e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>o("add"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="add"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Add New"}),e.jsx("button",{onClick:()=>o("history"),className:`py-4 px-1 border-b-2 font-medium text-sm ${s==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"History"})]})}),Oe=({formData:s,vendors:o,customers:i,brands:b,onFormDataChange:n})=>{const j=$(),t=()=>s.documentType==="bill"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:s.documentSubType,onChange:l=>{const v=l.target.value;n(v==="from_vendor"?{documentSubType:v,vendorSubType:"purchase_receipt",vendorId:"",brandId:"",destinationId:""}:{documentSubType:v,vendorSubType:"",vendorId:"",brandId:"",destinationId:""})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"from_vendor",children:"From Vendor"}),e.jsx("option",{value:"from_customer",children:"From Customer"})]})]}):s.documentType==="delivery_challan"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Type"}),e.jsxs("select",{value:s.documentSubType,onChange:l=>n({documentSubType:l.target.value,deliveryChallanSubType:""}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"sample",children:"Sample"}),e.jsx("option",{value:"replace",children:"Replace"})]})]}):s.documentType==="transfer_note"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Transfer Type"}),e.jsx("input",{type:"text",value:"Factory to Store",readOnly:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}):null,d=()=>s.documentType==="bill"&&s.documentSubType==="from_vendor"?e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor Type"}),e.jsxs("select",{value:s.vendorSubType,onChange:l=>n({vendorSubType:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"purchase_receipt",children:"Purchase Receipt"})]})]}):null,T=()=>s.documentType==="delivery_challan"&&s.documentSubType==="sample"?e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sample Type"}),e.jsxs("select",{value:s.deliveryChallanSubType,onChange:l=>n({deliveryChallanSubType:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"vendor",children:"Vendor"}),e.jsx("option",{value:"customer",children:"Customer"})]})]}):null,c=()=>s.documentType==="bill"&&s.documentSubType==="from_vendor"?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Vendor & Brand"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Select Vendor ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.vendorId,onChange:l=>n({vendorId:l.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Vendor"}),o.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx("button",{type:"button",onClick:()=>j("/app/library?tab=vendors"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Brand ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.brandId,onChange:l=>n({brandId:l.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Brand"}),b.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsx("button",{type:"button",onClick:()=>j("/app/library?tab=brands"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warranty"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"number",min:"0",value:s.warranty,onChange:l=>n({warranty:parseInt(l.target.value)||0}),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"0"}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{type:"button",onClick:()=>n({warrantyUnit:"months"}),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s.warrantyUnit==="months"?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-200"}`,children:"Months"}),e.jsx("button",{type:"button",onClick:()=>n({warrantyUnit:"year"}),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${s.warrantyUnit==="year"?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-200"}`,children:"Year"})]})]})]})]})]}):null,p=()=>s.documentType==="bill"&&s.documentSubType==="from_customer"?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Customer"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Customer ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:s.destinationId,onChange:l=>n({destinationId:l.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Customer"}),i.map(l=>e.jsx("option",{value:l.id,children:l.customerName||l.name},l.id))]})]})]}):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Document Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>n({documentType:"bill"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"bill",checked:s.documentType==="bill",onChange:l=>n({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Bill"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>n({documentType:"delivery_challan"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"delivery_challan",checked:s.documentType==="delivery_challan",onChange:l=>n({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Delivery Challan"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition-colors",onClick:()=>n({documentType:"transfer_note"}),children:[e.jsx("input",{type:"radio",name:"documentType",value:"transfer_note",checked:s.documentType==="transfer_note",onChange:l=>n({documentType:l.target.value}),className:"text-blue-600 cursor-pointer"}),e.jsx("span",{className:"cursor-pointer",children:"Transfer Note"})]})]})]}),e.jsxs("div",{children:[t(),d(),T()]})]})]}),c(),p()]})},He=({formData:s,onFormDataChange:o})=>{const i=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Invoice/Challan Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Invoice/Challan Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:s.invoiceDate,max:i,onChange:b=>o({invoiceDate:b.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Invoice/Challan Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.invoiceNumber,onChange:b=>o({invoiceNumber:b.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter invoice number",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Docket Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.docketNumber,onChange:b=>o({docketNumber:b.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter docket number",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Transportor Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.transportorName,onChange:b=>o({transportorName:b.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter transportor name",required:!0})]})]})]})},Fe=({formData:s,onFormDataChange:o})=>{const i=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Receiving Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Receiving Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:s.useCurrentDate,onChange:()=>o({useCurrentDate:!0}),className:"text-blue-600",required:!0}),e.jsx("span",{children:"Current Date"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:!s.useCurrentDate,onChange:()=>o({useCurrentDate:!1}),className:"text-blue-600",required:!0}),e.jsx("span",{children:"Select Date:"})]}),!s.useCurrentDate&&e.jsx("input",{type:"date",value:s.receivingDate,max:i,onChange:b=>o({receivingDate:b.target.value}),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0})]})]})})]})},Me=({itemId:s,skuId:o,skus:i,onSkuChange:b,onClear:n})=>{const[j,t]=g.useState(""),[d,T]=g.useState(!1),[c,p]=g.useState(!1),l=g.useRef(null);g.useEffect(()=>{const y=k=>{const f=k.target;if(l.current&&!l.current.contains(f))if(T(!1),p(!1),!o)t("");else{const A=i.find(I=>I.id.toString()===o);t((A==null?void 0:A.skuId)||"")}};return document.addEventListener("mousedown",y),()=>{document.removeEventListener("mousedown",y)}},[o,i]);const v=i.find(y=>y.id.toString()===o),h=j||(v==null?void 0:v.skuId)||"",_=j?i.filter(y=>{var k,f;return((k=y.skuId)==null?void 0:k.toLowerCase().includes(j.toLowerCase()))||((f=y.itemName)==null?void 0:f.toLowerCase().includes(j.toLowerCase()))}):i;return e.jsxs("div",{ref:l,className:"flex-1 relative sku-dropdown-container min-w-[200px]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("div",{className:"flex gap-1.5 items-start",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:h,onChange:y=>{p(!0),t(y.target.value),T(!1),y.target.value||(n(),p(!1))},onFocus:()=>{},onBlur:()=>{p(!1)},placeholder:"Search SKU...",className:"w-full px-2.5 py-1.5 pr-8 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500"}),(j||o)&&e.jsx("button",{type:"button",onClick:y=>{y.stopPropagation(),t(""),n(),T(!1)},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(L,{className:"w-3 h-3"})})]}),e.jsx("button",{type:"button",onClick:y=>{y.stopPropagation(),T(k=>!k),t(""),p(!1)},className:"px-2 py-1.5 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 border border-gray-300",title:"Show all SKUs",children:e.jsx(oe,{className:`w-3.5 h-3.5 transition-transform ${d?"rotate-180":""}`})})]}),c&&j&&j.length>0&&!d&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:[_.slice(0,10).map(y=>e.jsxs("div",{onClick:k=>{k.stopPropagation(),b(y.id.toString()),t(""),T(!1)},className:"px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:y.skuId}),y.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:y.itemName})]},y.id)),_.length===0&&e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs found"})]}),d&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:i.length===0?e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No SKUs available"}):i.map(y=>e.jsxs("div",{onClick:k=>{k.stopPropagation(),b(y.id.toString()),t(""),T(!1),p(!1)},className:`px-3 py-2 text-xs hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 ${o===y.id.toString()?"bg-blue-50":""}`,children:[e.jsx("div",{className:"font-medium",children:y.skuId}),y.itemName&&e.jsx("div",{className:"text-gray-500 text-xs",children:y.itemName})]},y.id))})]})})]})},Ke=({item:s,index:o,skus:i,canRemove:b,isAdmin:n,hasPriceHistory:j,onRemove:t,onItemChange:d,onPriceHistoryClick:T,validateTotalQuantity:c})=>{const p=c(s);return e.jsx("div",{className:"border border-gray-200 rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 pb-1",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700 min-w-[2rem]",children:["#",o+1]}),b&&e.jsx("button",{type:"button",onClick:t,className:"text-red-600 hover:text-red-800",title:"Remove Item",children:e.jsx(L,{className:"w-4 h-4"})})]}),e.jsx(Me,{itemId:s.id,skuId:s.skuId,skus:i,onSkuChange:l=>{const v=i.find(h=>h.id.toString()===l);d("skuId",l),d("itemName",(v==null?void 0:v.itemName)||"")},onClear:()=>{d("skuId",""),d("itemName","")}}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-20",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Total ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",min:"0",value:s.totalQuantity,onChange:l=>{const v=parseInt(l.target.value)||0;d("totalQuantity",v);const h=Math.max(0,v-(s.received||0));d("short",h),d("total",v),d("totalValue",v*s.unitPrice)},className:`w-full px-2 py-1.5 text-xs border rounded focus:ring-1 focus:ring-blue-500 pr-6 ${s.totalQuantity>0&&!p?"border-red-500 bg-red-50":s.totalQuantity>0&&p?"border-green-500 bg-green-50":"border-gray-300"}`,placeholder:"0"}),e.jsxs("div",{className:"absolute right-1 top-1/2 transform -translate-y-1/2",children:[s.totalQuantity>0&&!p&&e.jsx(ne,{className:"w-3 h-3 text-red-500"}),s.totalQuantity>0&&p&&e.jsx(ie,{className:"w-3 h-3 text-green-500"})]})]})]}),e.jsxs("div",{className:"w-20",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Received ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"0",value:s.received,onChange:l=>{const v=parseInt(l.target.value)||0;d("received",v);const h=Math.max(0,(s.totalQuantity||0)-v);d("short",h),d("totalValue",(s.totalQuantity||0)*s.unitPrice)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0",required:!0})]}),e.jsxs("div",{className:"w-20",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Short ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:s.short,readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50",required:!0})]})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-24",children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs font-medium text-gray-700 mb-1",children:["Unit Price ",e.jsx("span",{className:"text-red-500",children:"*"}),n&&s.skuId&&j&&e.jsx("button",{type:"button",onClick:T,className:"text-blue-600 hover:text-blue-800",title:"View price history",children:e.jsx(Ue,{className:"w-3 h-3"})})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:s.unitPrice,onChange:l=>{const v=parseFloat(l.target.value)||0;d("unitPrice",v),d("totalValue",(s.totalQuantity||0)*v)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0",required:!0})]}),e.jsxs("div",{className:"w-24",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Total Price ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.totalValue.toFixed(2),readOnly:!0,className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded bg-gray-50",required:!0})]})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Boxes"}),e.jsx("input",{type:"number",min:"0",value:s.numberOfBoxes,onChange:l=>d("numberOfBoxes",parseInt(l.target.value)||0),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Received"}),e.jsx("input",{type:"number",min:"0",value:s.receivedBoxes,onChange:l=>d("receivedBoxes",parseInt(l.target.value)||0),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"0"})]})]}),e.jsxs("div",{className:"w-12 flex items-center justify-center pb-1",children:[s.totalQuantity>0&&!p&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5",title:"Total Quantity must equal sum",children:[e.jsx(ne,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-red-500 text-[10px]",children:"Invalid"})]}),s.totalQuantity>0&&p&&e.jsxs("div",{className:"flex flex-col items-center gap-0.5",title:"Validation passed",children:[e.jsx(ie,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-green-600 text-[10px]",children:"Valid"})]}),s.totalQuantity===0&&e.jsxs("span",{className:"text-xs text-gray-400",children:["Exp: ",(s.received||0)+(s.short||0)]})]})]})})},$e=({items:s,skus:o,isAdmin:i,priceHistoryMap:b,onAddItem:n,onRemoveItem:j,onItemChange:t,onPriceHistoryClick:d,validateTotalQuantity:T})=>e.jsxs("div",{className:"bg-white rounded-lg shadow p-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Item Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Add Item"]})]}),e.jsxs("div",{className:"space-y-3",children:[s.map((c,p)=>e.jsx(Ke,{item:c,index:p,skus:o,canRemove:s.length>1,isAdmin:i,hasPriceHistory:b[c.skuId]||!1,onRemove:()=>j(c.id),onItemChange:(l,v)=>t(c.id,l,v),onPriceHistoryClick:()=>d(c),validateTotalQuantity:T},c.id)),s.length>0&&e.jsx("div",{className:"border-2 border-blue-300 rounded-lg p-3 bg-blue-50",children:e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"flex items-center gap-1.5 pb-1 min-w-[2rem]",children:e.jsx("span",{className:"text-sm font-bold text-gray-900",children:"Total"})}),e.jsx("div",{className:"flex-1 relative min-w-[200px]"}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-20",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Total ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.totalQuantity||0),0)})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Received"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.received||0),0)})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Short"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.short||0),0)})]})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Unit Price"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.length>0?(s.reduce((c,p)=>c+(p.unitPrice||0),0)/s.length).toFixed(2):"0.00"})]}),e.jsxs("div",{className:"w-24",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Total Price"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.totalValue||0),0).toFixed(2)})]})]}),e.jsx("div",{className:"w-px h-12 bg-gray-300"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Boxes"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.numberOfBoxes||0),0)})]}),e.jsxs("div",{className:"w-20",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Received"}),e.jsx("div",{className:"px-2 py-1.5 text-xs border-2 border-blue-500 rounded bg-white font-bold text-gray-900",children:s.reduce((c,p)=>c+(p.receivedBoxes||0),0)})]})]}),e.jsx("div",{className:"w-12"})]})})]})]}),Le=({formData:s,teams:o,onFormDataChange:i})=>{const b=$();return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:["Additional Details ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Received By ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.receivedBy,onChange:n=>i({receivedBy:n.target.value}),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Team from Library"}),o.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]}),e.jsx("button",{type:"button",onClick:()=>b("/app/library?tab=teams"),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:e.jsx(K,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Remarks"}),e.jsx("textarea",{value:s.remarks,onChange:n=>i({remarks:n.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Enter any additional remarks"})]})]})]})},ze=({loading:s,isValid:o,hasItems:i,onSaveDraft:b,onSubmit:n})=>{const j=$();return e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>j("/app/inventory"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:b,disabled:s||!i,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save as Draft"}),e.jsx("button",{type:"button",onClick:n,disabled:s||!i||!o,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:!o&&i?"Please ensure all Total Quantity fields match their calculated sums":"",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-5 h-5"}),"Submit"]})})]})},Ye=({dateFrom:s,dateTo:o,filterVendor:i,filterSKU:b,vendors:n,onDateFromChange:j,onDateToChange:t,onFilterVendorChange:d,onFilterSKUChange:T})=>e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),e.jsx("input",{type:"date",value:s,onChange:c=>j(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),e.jsx("input",{type:"date",value:o,onChange:c=>t(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vendor"}),e.jsxs("select",{value:i,onChange:c=>d(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Vendors"}),n.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SKU"}),e.jsx("input",{type:"text",value:b,onChange:c=>T(c.target.value),placeholder:"Search SKU",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})}),Je=({loading:s,history:o,expandedRows:i,rowItems:b,editingItem:n,editFormData:j,onToggleRow:t,onEditShort:d,onSaveEdit:T,onCancelEdit:c,onMoveToRejected:p,onEditFormDataChange:l,getChallanCount:v})=>e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider w-12"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Invoice Number"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Total Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Received Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Vendor"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Receiving Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Received By"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Total Value"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})})})}):o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-8 text-center text-gray-500",children:"No history found"})}):o.map(h=>{const _=i[h.id],y=b[h.id]||[],k=v(y);return e.jsxs(_e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>t(h.id),className:"text-gray-600 hover:text-gray-900",children:_?e.jsx(oe,{className:"w-5 h-5"}):e.jsx(Be,{className:"w-5 h-5"})})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:R(h.invoice_date||h.date)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:h.invoice_number||h.invoiceNumber}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:h.total_quantity||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:h.received_quantity||0}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:h.vendor_name||h.vendor||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:R(h.receiving_date||h.date)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:h.received_by_name||"N/A"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-semibold",children:M(h.total_value||0)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${h.status==="Pending"||h.total_short>0?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:h.status==="Pending"||h.total_short>0?"Pending":"Complete"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>t(h.id),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",title:"View Details",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-green-600 hover:text-green-800 flex items-center gap-1",title:"Download",children:e.jsx(Ve,{className:"w-4 h-4"})})]})})]}),_&&e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"px-4 py-4 bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("h4",{className:"text-sm font-semibold text-gray-700",children:["Items (",y.length,") - Challans: ",k]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"SKU ID"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Item Name"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Received"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Short"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Challan Number"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"Loading items..."})}):y.map(f=>{const A=(n==null?void 0:n.inventoryId)===h.id&&(n==null?void 0:n.itemId)===(f.itemId||f.item_id);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:f.skuCode||f.sku_code||f.skuId||"N/A"}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:f.itemName||f.item_name||"N/A"}),A?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:j.received,onChange:I=>l({received:parseInt(I.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded",min:"0"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:j.short,onChange:I=>l({short:parseInt(I.target.value)||0}),className:"w-20 px-2 py-1 border border-gray-300 rounded",min:"0"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"date",value:j.challanDate,onChange:I=>l({challanDate:I.target.value}),className:"w-32 px-2 py-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"text",value:j.challanNumber,onChange:I=>l({challanNumber:I.target.value}),className:"w-32 px-2 py-1 border border-gray-300 rounded",placeholder:"Challan Number"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:T,className:"text-green-600 hover:text-green-800",title:"Save",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:c,className:"text-red-600 hover:text-red-800",title:"Cancel",children:e.jsx(L,{className:"w-4 h-4"})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-3 py-2 text-gray-900",children:f.received||0}),e.jsx("td",{className:"px-3 py-2 text-gray-900",children:f.short||0}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:f.challanDate||f.challan_date?R(f.challanDate||f.challan_date):"N/A"}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:f.challanNumber||f.challan_number||"N/A"}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[(f.short||0)>0&&e.jsx("button",{onClick:()=>p(h.id,f.itemId||f.item_id),className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 border border-orange-300 rounded hover:bg-orange-50",title:"Move to Rejected",children:"Move to Rejected"}),(f.short||0)>0&&e.jsx("button",{onClick:()=>d(h.id,f),className:"text-blue-600 hover:text-blue-800",title:"Edit",children:e.jsx(De,{className:"w-4 h-4"})})]})})]})]},f.itemId||f.item_id)})})]})})]})})})]},h.id)})})]})})}),We=({isOpen:s,loading:o,data:i,onClose:b})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-100 bg-gray-50",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Buying Price History"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-lg hover:bg-gray-100","aria-label":"Close",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:o?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):i?e.jsxs("div",{className:"space-y-4",children:[i.current&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#E8F0FE"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#1A73E8"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#1A73E8"},children:"Current Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:M(i.current.price)})," from ",e.jsx("span",{className:"font-medium",children:i.current.vendorName})," on ",e.jsx("span",{className:"font-medium",children:R(i.current.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:i.current.invoiceNumber}),")"]})]})]})}),i.previous&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#F5F5F5"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#9E9E9E"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#9E9E9E"},children:"Previously Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:M(i.previous.price)})," from ",e.jsx("span",{className:"font-medium",children:i.previous.vendorName})," on ",e.jsx("span",{className:"font-medium",children:R(i.previous.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:i.previous.invoiceNumber}),")"]})]})]})}),i.lowest&&e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm",style:{backgroundColor:"#E8F5E9"},children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1",style:{backgroundColor:"#43A047"}}),e.jsxs("div",{className:"flex-1 px-5 py-4",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wide mb-2",style:{color:"#43A047"},children:"Lowest Buying Price"}),e.jsxs("p",{className:"text-sm leading-relaxed",style:{color:"#1A1A1A"},children:[e.jsx("span",{className:"font-semibold",children:M(i.lowest.price)})," from ",e.jsx("span",{className:"font-medium",children:i.lowest.vendorName})," on ",e.jsx("span",{className:"font-medium",children:R(i.lowest.buyingDate)})," (Invoice: ",e.jsx("span",{className:"font-medium",children:i.lowest.invoiceNumber}),")"]})]})]})}),!i.current&&!i.previous&&!i.lowest&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No buying price history found for this SKU."})})]}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"Failed to load price history."})})}),e.jsx("div",{className:"flex justify-end px-6 py-4 border-t border-gray-100 bg-gray-50",children:e.jsx("button",{onClick:b,className:"px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm shadow-sm hover:shadow-md",children:"Close"})})]})}):null,mt=()=>{const s=$(),[o,i]=g.useState("add"),[b,n]=g.useState(!1),j=()=>({id:Date.now().toString(),skuId:"",itemName:"",received:0,short:0,total:0,totalQuantity:0,unitPrice:0,totalValue:0,numberOfBoxes:0,receivedBoxes:0}),[t,d]=g.useState({documentType:"bill",documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:"vendor",destinationId:"",invoiceDate:new Date().toISOString().split("T")[0],invoiceNumber:"",docketNumber:"",transportorName:"",vendorId:"",brandId:"",warranty:0,warrantyUnit:"months",receivingDate:new Date().toISOString().split("T")[0],useCurrentDate:!0,receivedBy:"",remarks:"",items:[j()]}),[T,c]=g.useState([]),[p,l]=g.useState([]),[v,h]=g.useState([]),[_,y]=g.useState([]),[k,f]=g.useState([]),[A,I]=g.useState([]),[te,se]=g.useState({}),[re,z]=g.useState({}),[V,Y]=g.useState(null),[D,J]=g.useState({received:0,short:0,challanNumber:"",challanDate:""}),[B,ue]=g.useState(null),[xe,ae]=g.useState({}),[W,Q]=g.useState({isOpen:!1,skuId:"",loading:!1,data:null}),[U,me]=g.useState(""),[q,pe]=g.useState(""),[O,he]=g.useState(""),[H,ye]=g.useState("");g.useEffect(()=>{ge(),be()},[]);const be=()=>{const r=localStorage.getItem("user")||sessionStorage.getItem("user");if(r)try{const a=JSON.parse(r);ue(a)}catch(a){console.error("Error parsing user data:",a)}},X=()=>(B==null?void 0:B.role)==="admin"||(B==null?void 0:B.role)==="super_admin";g.useEffect(()=>{(async()=>{if(!X())return;const a=t.items.filter(u=>u.skuId).map(async u=>{try{const S=await E.hasPriceHistory(u.skuId);S.success&&ae(x=>({...x,[u.skuId]:S.data.hasHistory}))}catch(S){console.error(`Error checking price history for SKU ${u.skuId}:`,S)}});await Promise.all(a)})()},[t.items,B]),g.useEffect(()=>{o==="history"&&G()},[o,U,q,O,H]),g.useEffect(()=>{t.documentType==="transfer_note"?d(r=>({...r,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:"vendor",destinationId:""})):d(r=>({...r,documentSubType:"",vendorSubType:"",deliveryChallanSubType:"",destinationType:r.documentType==="bill"?"vendor":"customer",destinationId:""}))},[t.documentType]),g.useEffect(()=>{t.documentType==="bill"?t.documentSubType==="from_vendor"?d(r=>({...r,destinationType:"vendor",destinationId:"",vendorSubType:"purchase_receipt"})):t.documentSubType==="from_customer"&&d(r=>({...r,destinationType:"customer",destinationId:"",vendorSubType:""})):t.documentType==="delivery_challan"&&(t.documentSubType==="sample"?d(r=>({...r,deliveryChallanSubType:"",destinationId:""})):t.documentSubType==="replace"&&d(r=>({...r,destinationType:"customer",deliveryChallanSubType:"",destinationId:""})))},[t.documentSubType]),g.useEffect(()=>{t.documentType==="delivery_challan"&&t.documentSubType==="sample"&&(t.deliveryChallanSubType==="vendor"?d(r=>({...r,destinationType:"vendor",destinationId:""})):t.deliveryChallanSubType==="customer"&&d(r=>({...r,destinationType:"customer",destinationId:""})))},[t.deliveryChallanSubType]);const ge=async()=>{try{const[r,a,u,S,x]=await Promise.all([F.getYourVendors(),F.getCustomers(),F.getYourBrands(),F.getTeams(),Ae.getAll({limit:1e3})]);c(Array.isArray(r)?r:(r==null?void 0:r.data)||[]),l(Array.isArray(a)?a:(a==null?void 0:a.data)||[]),h(Array.isArray(u)?u:(u==null?void 0:u.data)||[]),y(Array.isArray(S)?S:(S==null?void 0:S.data)||[]),f(Array.isArray(x)?x:(x==null?void 0:x.data)||[])}catch(r){console.error("Error loading initial data:",r)}},G=async()=>{try{n(!0);const r={};U&&(r.dateFrom=U),q&&(r.dateTo=q),O&&(r.vendor=O),H&&(r.sku=H);const a=await E.getIncomingHistory(r);I(a.data||[]),se({}),z({})}catch(r){console.error("Error loading history:",r),I([])}finally{n(!1)}},Z=async r=>{try{const a=await E.getIncomingItems(r);z(u=>({...u,[r]:a.data||[]}))}catch(a){console.error("Error loading items:",a),z(u=>({...u,[r]:[]}))}},fe=async r=>{const a=te[r];se(u=>({...u,[r]:!a})),!a&&!re[r]&&await Z(r)},ve=async(r,a)=>{var u,S;if(confirm("Are you sure you want to move this short quantity to rejected? This will update the stock."))try{n(!0),await E.moveShortToRejected(r,a),await Z(r),await G(),alert("Short quantity moved to rejected successfully. Stock has been updated.")}catch(x){console.error("Error moving to rejected:",x),alert(((S=(u=x.response)==null?void 0:u.data)==null?void 0:S.error)||"Failed to move short to rejected")}finally{n(!1)}},je=(r,a)=>{Y({inventoryId:r,itemId:a.itemId||a.item_id}),J({received:a.received||0,short:a.short||0,challanNumber:a.challanNumber||a.challan_number||"",challanDate:a.challanDate||a.challan_date||""})},Ne=async()=>{var r,a;if(V)try{n(!0),await E.updateShortItem(V.inventoryId,{itemId:V.itemId,received:D.received,short:D.short,challanNumber:D.challanNumber,challanDate:D.challanDate}),await Z(V.inventoryId),await G(),Y(null),alert("Short item updated successfully. Stock has been updated.")}catch(u){console.error("Error updating short item:",u),alert(((a=(r=u.response)==null?void 0:r.data)==null?void 0:a.error)||"Failed to update short item")}finally{n(!1)}},we=()=>{Y(null),J({received:0,short:0,challanNumber:"",challanDate:""})},Se=r=>r?new Set(r.filter(u=>u.challanNumber||u.challan_number).map(u=>u.challanNumber||u.challan_number)).size:0,Te=()=>{const r=j();d(a=>({...a,items:[...a.items,r]}))},ke=r=>{d(a=>{const u=a.items.filter(S=>S.id!==r);return u.length===0?{...a,items:[j()]}:{...a,items:u}})},Ie=(r,a,u)=>{d(S=>({...S,items:S.items.map(x=>{if(x.id===r){const w={...x,[a]:u};if(a==="skuId"){const C=k.find(m=>m.id.toString()===u);w.itemName=(C==null?void 0:C.itemName)||""}return(a==="received"||a==="totalQuantity")&&(w.short=Math.max(0,(w.totalQuantity||0)-(w.received||0)),w.total=w.totalQuantity||0,w.totalValue=(w.totalQuantity||0)*w.unitPrice),a==="unitPrice"&&(w.totalValue=(w.totalQuantity||0)*w.unitPrice),w}return x})}))},ee=r=>{const a=(r.received||0)+(r.short||0);return r.totalQuantity===a},Ce=()=>!t.documentType||t.documentType==="bill"&&!t.documentSubType||t.documentType==="delivery_challan"&&!t.documentSubType||!t.invoiceDate||!t.invoiceNumber.trim()||!t.docketNumber.trim()||!t.transportorName.trim()||!t.receivingDate||t.documentType==="bill"&&t.documentSubType==="from_vendor"&&(!t.vendorId||!t.brandId)||t.documentType==="bill"&&t.documentSubType==="from_customer"&&!t.destinationId||!t.receivedBy||t.items.length===0?!1:t.items.every(a=>!a.skuId||a.received===void 0||a.received===null||a.short===void 0||a.short===null||a.unitPrice===void 0||a.unitPrice===null||a.unitPrice===0||a.totalValue===void 0||a.totalValue===null||a.totalValue===0?!1:ee(a)),le=async(r=!1)=>{var a,u,S;if(!r){if(!t.documentType){alert("Please select Document Type.");return}if(t.documentType==="bill"&&!t.documentSubType){alert("Please select Type (From Vendor or From Customer).");return}if(!t.invoiceDate){alert("Please enter Invoice/Challan Date.");return}if(!t.invoiceNumber.trim()){alert("Please enter Invoice/Challan Number.");return}if(!t.docketNumber.trim()){alert("Please enter Docket Number.");return}if(!t.transportorName.trim()){alert("Please enter Transportor Name.");return}if(!t.receivingDate){alert("Please select Receiving Date.");return}if(t.documentType==="bill"&&t.documentSubType==="from_vendor"){if(!t.vendorId){alert("Please select a Vendor.");return}if(!t.brandId){alert("Please select a Brand.");return}}if(t.documentType==="bill"&&t.documentSubType==="from_customer"&&!t.destinationId){alert("Please select a Customer.");return}if(!t.receivedBy){alert("Please select Received By.");return}if(t.items.length===0){alert("Please add at least one item.");return}for(const x of t.items){if(!x.skuId){alert("Please select SKU for all items.");return}if(x.received===void 0||x.received===null){alert("Please enter Received quantity for all items.");return}if(x.short===void 0||x.short===null){alert("Please ensure Short quantity is calculated for all items.");return}if(x.unitPrice===void 0||x.unitPrice===null||x.unitPrice===0){alert("Please enter Unit Price for all items.");return}if(x.totalValue===void 0||x.totalValue===null||x.totalValue===0){alert("Please ensure Total Price is calculated for all items.");return}if(!ee(x)){alert("Please ensure all Total Quantity fields match their calculated sums (Received + Short).");return}}}try{n(!0);const x=m=>m==null||typeof m=="string"&&m.trim()===""?null:m,w={invoiceDate:t.invoiceDate,invoiceNumber:t.invoiceNumber,docketNumber:x(t.docketNumber),transportorName:x(t.transportorName),vendorId:t.vendorId?typeof t.vendorId=="string"?parseInt(t.vendorId,10):t.vendorId:null,brandId:t.brandId?typeof t.brandId=="string"?parseInt(t.brandId,10):t.brandId:null,warranty:t.warranty?typeof t.warranty=="string"?parseInt(t.warranty,10):t.warranty:0,warrantyUnit:t.warrantyUnit||"months",receivingDate:t.receivingDate,receivedBy:t.receivedBy?typeof t.receivedBy=="string"?parseInt(t.receivedBy,10):t.receivedBy:null,remarks:x(t.remarks),documentType:t.documentType||"bill",documentSubType:x(t.documentSubType),vendorSubType:x(t.vendorSubType),deliveryChallanSubType:x(t.deliveryChallanSubType),destinationType:x(t.destinationType),destinationId:t.destinationId?typeof t.destinationId=="string"?parseInt(t.destinationId,10):t.destinationId:null,items:t.items.map(m=>({skuId:m.skuId?typeof m.skuId=="string"?parseInt(m.skuId,10):m.skuId:null,received:m.received?typeof m.received=="string"?parseInt(m.received,10):m.received:0,short:m.short?typeof m.short=="string"?parseInt(m.short,10):m.short:0,totalQuantity:m.totalQuantity?typeof m.totalQuantity=="string"?parseInt(m.totalQuantity,10):m.totalQuantity:0,unitPrice:m.unitPrice?typeof m.unitPrice=="string"?parseFloat(m.unitPrice):m.unitPrice:0,numberOfBoxes:m.numberOfBoxes?typeof m.numberOfBoxes=="string"?parseInt(m.numberOfBoxes,10):m.numberOfBoxes:0,receivedBoxes:m.receivedBoxes?typeof m.receivedBoxes=="string"?parseInt(m.receivedBoxes,10):m.receivedBoxes:0})),status:r?"draft":"completed"};if((await E.addIncoming(w)).success&&X()){const m=t.items.filter(N=>N.skuId).map(async N=>{try{const P=await E.hasPriceHistory(N.skuId);P.success&&ae(Ee=>({...Ee,[N.skuId]:P.data.hasHistory}))}catch(P){console.error(`Error checking price history for SKU ${N.skuId}:`,P)}});await Promise.all(m)}s("/app/inventory")}catch(x){console.error("Error submitting incoming inventory:",x),console.error("Full error response:",(a=x.response)==null?void 0:a.data);let w="Failed to submit incoming inventory",C="";if((u=x.response)!=null&&u.data){const N=x.response.data;if(w=N.message||N.error||w,N.details){if(typeof N.details=="string")C=N.details;else if(typeof N.details=="object"){const P=[];N.details.originalError&&P.push(`Error: ${N.details.originalError}`),N.details.hint&&P.push(`Hint: ${N.details.hint}`),N.details.detail&&P.push(`Detail: ${N.details.detail}`),N.details.code&&P.push(`Code: ${N.details.code}`),C=P.join(`
`)}}(N.error==="DATABASE_SCHEMA_ERROR"||N.error==="DATABASE_ERROR")&&(w=N.message||"Database configuration error",(S=N.details)!=null&&S.hint&&(C=N.details.hint))}else x.message&&(w=x.message);const m=C?`${w}

${C}`:w;alert(m)}finally{n(!1)}},Pe=async r=>{Q({isOpen:!0,skuId:r.skuId,loading:!0,data:null});try{const a=await E.getPriceHistory(r.skuId);Q(u=>({...u,loading:!1,data:a.data}))}catch(a){console.error("Error loading price history:",a),Q(u=>({...u,loading:!1,data:null}))}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("style",{children:`
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type="number"] {
          -moz-appearance: textfield;
        }
      `}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/app/inventory"),className:"text-gray-600 hover:text-gray-900",children:e.jsx(Qe,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Incoming Inventory"})]}),e.jsx(qe,{activeTab:o,onTabChange:i}),o==="add"&&e.jsxs("form",{className:"space-y-6",children:[e.jsx(Oe,{formData:t,vendors:T,customers:p,brands:v,onFormDataChange:r=>d(a=>({...a,...r}))}),e.jsx(He,{formData:t,onFormDataChange:r=>d(a=>({...a,...r}))}),e.jsx(Fe,{formData:t,onFormDataChange:r=>d(a=>({...a,...r}))}),e.jsx($e,{items:t.items,skus:k,isAdmin:X(),priceHistoryMap:xe,onAddItem:Te,onRemoveItem:ke,onItemChange:Ie,onPriceHistoryClick:Pe,validateTotalQuantity:ee}),e.jsx(Le,{formData:t,teams:_,onFormDataChange:r=>d(a=>({...a,...r}))}),e.jsx(ze,{loading:b,isValid:Ce(),hasItems:t.items.length>0,onSaveDraft:()=>le(!0),onSubmit:()=>le(!1)})]}),o==="history"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ye,{dateFrom:U,dateTo:q,filterVendor:O,filterSKU:H,vendors:T,onDateFromChange:me,onDateToChange:pe,onFilterVendorChange:he,onFilterSKUChange:ye}),e.jsx(Je,{loading:b,history:A,expandedRows:te,rowItems:re,editingItem:V,editFormData:D,onToggleRow:fe,onEditShort:je,onSaveEdit:Ne,onCancelEdit:we,onMoveToRejected:ve,onEditFormDataChange:r=>J(a=>({...a,...r})),getChallanCount:Se})]}),e.jsx(We,{isOpen:W.isOpen,loading:W.loading,data:W.data,onClose:()=>Q({isOpen:!1,skuId:"",loading:!1,data:null})})]})};export{mt as default};
